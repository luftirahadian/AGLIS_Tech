var z=Object.defineProperty,Q=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var M=(n,a,r)=>a in n?z(n,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[a]=r,m=(n,a)=>{for(var r in a||(a={}))K.call(a,r)&&M(n,r,a[r]);if(E)for(var r of E(a))R.call(a,r)&&M(n,r,a[r]);return n},x=(n,a)=>Q(n,J(a));var P=(n,a,r)=>new Promise((u,y)=>{var j=o=>{try{b(r.next(o))}catch(i){y(i)}},g=o=>{try{b(r.throw(o))}catch(i){y(i)}},b=o=>o.done?u(o.value):Promise.resolve(o.value).then(j,g);b((r=r.apply(n,a)).next())});import{j as e,a as v}from"./notifications-joTign0d.js";import{r as p}from"./react-vendor-BQ7pSkNi.js";import{a as W,b as B,u as k}from"./react-query-B7OIdD7u.js";import{o as $,P as F,S as G,l as V,E as H,a6 as X,T as Y,z as h}from"./ui-vendor-C3ZQt1VJ.js";import"./charts-CREYXqqm.js";const le=()=>{const n=W(),[a,r]=p.useState(""),[u,y]=p.useState("all"),[j,g]=p.useState(!1),[b,o]=p.useState(!1),[i,N]=p.useState(null),[l,d]=p.useState({code:"",name:"",category:"ticket",description:"",template:"",variables:"{}",is_active:!0}),{data:w,isLoading:q}=B(["whatsapp-templates",u,a],()=>P(void 0,null,function*(){const s=new URLSearchParams;return u!=="all"&&s.append("category",u),a&&s.append("search",a),(yield v.get(`/whatsapp-templates?${s.toString()}`)).data}),{staleTime:6e4}),T=(w==null?void 0:w.data)||[],C=k(s=>v.post("/whatsapp-templates",s),{onSuccess:()=>{h.success("Template created successfully!"),n.invalidateQueries(["whatsapp-templates"]),g(!1),f()},onError:s=>{var t,c;h.error(((c=(t=s.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to create template")}}),S=k(({id:s,data:t})=>v.put(`/whatsapp-templates/${s}`,t),{onSuccess:()=>{h.success("Template updated successfully!"),n.invalidateQueries(["whatsapp-templates"]),g(!1),f()},onError:s=>{var t,c;h.error(((c=(t=s.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to update template")}}),O=k(s=>v.delete(`/whatsapp-templates/${s}`),{onSuccess:()=>{h.success("Template deleted successfully!"),n.invalidateQueries(["whatsapp-templates"])},onError:s=>{var t,c;h.error(((c=(t=s.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to delete template")}}),f=()=>{d({code:"",name:"",category:"ticket",description:"",template:"",variables:"{}",is_active:!0}),N(null)},D=s=>{N(s),d({code:s.code,name:s.name,category:s.category,description:s.description||"",template:s.template,variables:JSON.stringify(s.variables||{},null,2),is_active:s.is_active}),g(!0)},I=s=>{s.preventDefault();const t=x(m({},l),{variables:JSON.parse(l.variables)});i?S.mutate({id:i.id,data:t}):C.mutate(t)},L=s=>{window.confirm("Are you sure you want to delete this template?")&&O.mutate(s)},U=s=>{N(s),o(!0)},A=[{value:"all",label:"All Categories",color:"gray"},{value:"ticket",label:"Ticket",color:"blue"},{value:"payment",label:"Payment",color:"green"},{value:"customer",label:"Customer",color:"purple"},{value:"team",label:"Team",color:"orange"},{value:"marketing",label:"Marketing",color:"pink"}],_=s=>{const t=A.find(c=>c.value===s);return(t==null?void 0:t.color)||"gray"};return q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx($,{className:"h-7 w-7 mr-3 text-green-600"}),"WhatsApp Message Templates"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola template pesan WhatsApp untuk notifikasi otomatis"})]}),e.jsxs("button",{onClick:()=>{f(),g(!0)},className:"flex items-center px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors shadow-sm",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Tambah Template"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search templates...",value:a,onChange:s=>r(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-gray-500"}),A.map(s=>e.jsx("button",{onClick:()=>y(s.value),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${u===s.value?`bg-${s.color}-100 text-${s.color}-700 border border-${s.color}-300`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.label},s.value))]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:`px-3 py-1 text-xs font-semibold rounded-full bg-${_(s.category)}-100 text-${_(s.category)}-700`,children:s.category}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.is_active?"Active":"Inactive"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s.description||"No description"}),e.jsx("div",{className:"bg-gray-50 rounded p-3 mb-4",children:e.jsx("pre",{className:"text-xs text-gray-700 font-mono whitespace-pre-wrap line-clamp-4",children:s.template})}),e.jsxs("div",{className:"text-xs text-gray-500 mb-4",children:[e.jsxs("div",{children:["Code: ",e.jsx("span",{className:"font-mono font-semibold",children:s.code})]}),s.usage_count>0&&e.jsxs("div",{children:["Used: ",s.usage_count," times"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>U(s),className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Preview"]}),e.jsx("button",{onClick:()=>D(s),className:"flex items-center justify-center px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>L(s.id),className:"flex items-center justify-center px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:e.jsx(Y,{className:"h-4 w-4"})})]})]},s.id))}),T.length===0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx($,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No templates found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first WhatsApp message template"}),e.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Create Template"]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:i?"Edit Template":"Create New Template"})}),e.jsxs("form",{onSubmit:I,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Code *"}),e.jsx("input",{type:"text",value:l.code,onChange:s=>d(x(m({},l),{code:s.target.value.toUpperCase().replace(/\s/g,"_")})),placeholder:"TICKET_ASSIGNMENT",required:!0,disabled:!!i,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent disabled:bg-gray-100 font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),e.jsxs("select",{value:l.category,onChange:s=>d(x(m({},l),{category:s.target.value})),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"ticket",children:"Ticket"}),e.jsx("option",{value:"payment",children:"Payment"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"team",children:"Team"}),e.jsx("option",{value:"marketing",children:"Marketing"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Name *"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>d(x(m({},l),{name:s.target.value})),placeholder:"Ticket Assignment - Teknisi",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("input",{type:"text",value:l.description,onChange:s=>d(x(m({},l),{description:s.target.value})),placeholder:"Notifikasi assignment tiket ke teknisi",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message Template *"}),e.jsx("textarea",{value:l.template,onChange:s=>d(x(m({},l),{template:s.target.value})),placeholder:`📩 *TIKET BARU*

Ticket: #{{ticketNumber}}
Customer: {{customerName}}`,required:!0,rows:12,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Use ","{{variableName}}"," for dynamic content. Example: ","{{customerName}}, {{ticketNumber}}"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Variables (JSON)"}),e.jsx("textarea",{value:l.variables,onChange:s=>d(x(m({},l),{variables:s.target.value})),placeholder:'{"customerName": "Bapak Rizki", "ticketNumber": "TKT001"}',rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent font-mono text-xs"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JSON object dengan example values untuk testing"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:l.is_active,onChange:s=>d(x(m({},l),{is_active:s.target.checked})),className:"h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Active (template akan digunakan oleh sistem)"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),f()},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:C.isLoading||S.isLoading,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:i?"Update Template":"Create Template"})]})]})]})}),b&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Template Preview"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i.name})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mx-auto max-w-sm bg-gradient-to-b from-green-50 to-green-100 rounded-3xl p-4 shadow-lg",children:e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-inner",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold",children:"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"AGLIS Net"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Online"})]})]}),e.jsx("div",{className:"bg-green-100 rounded-lg rounded-tl-none p-3 mb-2",children:e.jsx("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-sans",children:i.template})}),e.jsx("div",{className:"text-right text-xs text-gray-500",children:new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})})]})}),i.variables&&Object.keys(i.variables).length>0&&e.jsxs("div",{className:"mt-6 bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2 text-sm",children:"Available Variables:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(i.variables).map(([s,t])=>e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-mono font-semibold text-green-600",children:`{{${s}}}`}),e.jsxs("span",{className:"text-gray-600",children:[" = ",t]})]},s))})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Close"})})]})})]})};export{le as default};
//# sourceMappingURL=WhatsAppTemplatesPage-DiKxbZhA.js.map
