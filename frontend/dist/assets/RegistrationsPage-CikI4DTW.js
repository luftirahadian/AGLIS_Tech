var Us=Object.defineProperty,zs=Object.defineProperties;var Hs=Object.getOwnPropertyDescriptors;var We=Object.getOwnPropertySymbols;var Ks=Object.prototype.hasOwnProperty,Ys=Object.prototype.propertyIsEnumerable;var Xe=(l,a,g)=>a in l?Us(l,a,{enumerable:!0,configurable:!0,writable:!0,value:g}):l[a]=g,_=(l,a)=>{for(var g in a||(a={}))Ks.call(a,g)&&Xe(l,g,a[g]);if(We)for(var g of We(a))Ys.call(a,g)&&Xe(l,g,a[g]);return l},R=(l,a)=>zs(l,Hs(a));var y=(l,a,g)=>new Promise((P,u)=>{var w=f=>{try{p(g.next(f))}catch(N){u(N)}},b=f=>{try{p(g.throw(f))}catch(N){u(N)}},p=f=>f.done?P(f.value):Promise.resolve(f.value).then(w,b);p((g=g.apply(l,a)).next())});import{a as O,j as e,C as ee}from"./notifications-Dt-KZFDl.js";import{r as c,u as qs,L as Gs}from"./react-vendor-BQ7pSkNi.js";import{a as Js,b as Ze,u as es}from"./react-query-B7OIdD7u.js";import{X as ls,C as q,a as Se,L as ns,ap as ss,W as _e,D as os,R as Ws,y as Xs,B as Zs,O as Ne,ao as ts,b as ce,ah as et,N as st,g as ke,aR as as,S as tt,v as we,d as Ce,p as at,m as rs,Q as rt,V as it,a7 as lt,z as o,Y as nt,Z as ot,_ as ct}from"./ui-vendor-Ccu0xyBn.js";import{r as $}from"./registrationService-jf9rjoT2.js";import{u as dt,s as Q,K,L as ut,h as mt,f as de,i as xt,e as ht}from"./customers-CPkOMPXe.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";import"./forms-Dmkgx8TD.js";const gt=(g,...P)=>y(void 0,[g,...P],function*(l,a={}){return(yield O.post("/bulk/registrations/verify",{ids:l,data:a})).data}),pt=(g,...P)=>y(void 0,[g,...P],function*(l,a={}){return(yield O.post("/bulk/registrations/approve",{ids:l,data:a})).data}),bt=(g,...P)=>y(void 0,[g,...P],function*(l,a={}){return(yield O.post("/bulk/registrations/reject",{ids:l,data:a})).data}),jt=(g,...P)=>y(void 0,[g,...P],function*(l,a={}){return(yield O.post("/bulk/tickets/assign",{ids:l,data:a})).data}),ft=(g,...P)=>y(void 0,[g,...P],function*(l,a={}){return(yield O.post("/bulk/tickets/update-status",{ids:l,data:a})).data}),vt=(g,...P)=>y(void 0,[g,...P],function*(l,a={}){return(yield O.post("/bulk/tickets/update-priority",{ids:l,data:a})).data}),yt=(g,...P)=>y(void 0,[g,...P],function*(l,a={}){return(yield O.post("/bulk/customers/update-status",{ids:l,data:a})).data}),Nt=l=>y(void 0,null,function*(){return(yield O.post("/bulk/customers/delete",{ids:l})).data}),is={bulkVerifyRegistrations:gt,bulkApproveRegistrations:pt,bulkRejectRegistrations:bt,bulkAssignTickets:jt,bulkUpdateTicketStatus:ft,bulkUpdateTicketPriority:vt,bulkUpdateCustomerStatus:yt,bulkDeleteCustomers:Nt},kt=({isOpen:l,total:a,processed:g,succeeded:P,failed:u,currentItem:w,operation:b,onCancel:p})=>{if(!l)return null;const f=a>0?Math.round(g/a*100):0,N=g===a;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:N?"Operation Complete":"Processing..."}),N&&e.jsx("button",{onClick:p,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ls,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:b}),e.jsxs("span",{children:[f,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 rounded-full ${N?u>0?"bg-yellow-500":"bg-green-500":"bg-blue-500 animate-pulse"}`,style:{width:`${f}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 py-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 flex items-center justify-center",children:[P,P>0&&e.jsx(q,{className:"h-4 w-4 ml-1"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Succeeded"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600 flex items-center justify-center",children:[u,u>0&&e.jsx(Se,{className:"h-4 w-4 ml-1"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]})]}),!N&&w&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 bg-gray-50 p-3 rounded-md",children:[e.jsx(ns,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsxs("span",{children:["Processing: ",w]})]}),N&&e.jsxs("div",{className:`p-4 rounded-md ${u>0?"bg-yellow-50 border border-yellow-200":"bg-green-50 border border-green-200"}`,children:[e.jsx("p",{className:`text-sm font-medium ${u>0?"text-yellow-800":"text-green-800"}`,children:u>0?`Completed with ${u} error${u>1?"s":""}`:"All operations completed successfully!"}),u>0&&e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"Click to view detailed results"})]})]}),!N&&e.jsx("div",{className:"flex justify-end gap-3 p-6 border-t bg-gray-50",children:e.jsx("button",{onClick:p,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"})})]})})},wt=({isOpen:l,results:a,onClose:g,onRetryFailed:P,operation:u})=>{const[w,b]=c.useState(!1),[p,f]=c.useState({});if(!l||!a)return null;const{total:N,succeeded:r,failed:E,results:G=[]}=a,V=G.filter(m=>!m.success),n=G.filter(m=>m.success),C=m=>{f(T=>R(_({},T),{[m]:!T[m]}))},U=()=>{const m=[["ID","Status","Error"],...G.map(B=>[B.id,B.success?"Success":"Failed",B.error||""])].map(B=>B.join(",")).join(`
`),T=new Blob([m],{type:"text/csv"}),Y=window.URL.createObjectURL(T),D=document.createElement("a");D.href=Y,D.download=`bulk-operation-results-${Date.now()}.csv`,document.body.appendChild(D),D.click(),document.body.removeChild(D),window.URL.revokeObjectURL(Y)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bulk Operation Results"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:u})]}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ls,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6 border-b bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:N}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Total Items"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 flex items-center justify-center",children:[r,e.jsx(q,{className:"h-5 w-5 ml-2"})]}),e.jsx("div",{className:"text-sm text-green-700 mt-1",children:"Succeeded"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"text-3xl font-bold text-red-600 flex items-center justify-center",children:[E,e.jsx(Se,{className:"h-5 w-5 ml-2"})]}),e.jsx("div",{className:"text-sm text-red-700 mt-1",children:"Failed"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("button",{onClick:()=>b(!w),className:"flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors",children:[w?e.jsx(ss,{className:"h-4 w-4"}):e.jsx(_e,{className:"h-4 w-4"}),w?"Hide":"Show"," Details"]}),e.jsxs("button",{onClick:U,className:"flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 transition-colors",children:[e.jsx(os,{className:"h-4 w-4"}),"Export Results"]})]}),w&&e.jsxs("div",{className:"space-y-4",children:[V.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-red-900 mb-2 flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Failed Items (",V.length,")"]}),e.jsx("div",{className:"space-y-2",children:V.map(m=>e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:[e.jsxs("button",{onClick:()=>C(m.id),className:"w-full flex items-center justify-between text-left",children:[e.jsxs("span",{className:"text-sm font-medium text-red-900",children:["ID: ",m.id]}),p[m.id]?e.jsx(ss,{className:"h-4 w-4 text-red-600"}):e.jsx(_e,{className:"h-4 w-4 text-red-600"})]}),p[m.id]&&e.jsx("div",{className:"mt-2 pt-2 border-t border-red-200",children:e.jsxs("p",{className:"text-xs text-red-700",children:[e.jsx("span",{className:"font-semibold",children:"Error:"})," ",m.error]})})]},m.id))})]}),n.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-900 mb-2 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Succeeded Items (",n.length,")"]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:n.map((m,T)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800",children:m.id},m.id))})})]})]}),!w&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:'Click "Show Details" to view individual results'})})]}),e.jsxs("div",{className:"flex justify-between items-center gap-3 p-6 border-t bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:E===0?e.jsx("span",{className:"text-green-600 font-medium",children:"✓ All operations successful"}):e.jsxs("span",{className:"text-yellow-600 font-medium",children:["⚠ ",E," operation",E>1?"s":""," failed"]})}),e.jsxs("div",{className:"flex gap-3",children:[E>0&&P&&e.jsxs("button",{onClick:()=>{P(V.map(m=>m.id)),g()},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors inline-flex items-center gap-2",children:[e.jsx(Ws,{className:"h-4 w-4"}),"Retry Failed"]}),e.jsx("button",{onClick:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Close"})]})]})]})})},Ft=()=>{var Me,Oe,Ve,Ue,ze,He,Ke,Ye,qe,Ge;const l=qs(),a=Js(),{user:g,isAdmin:P,isSupervisor:u,isCustomerService:w}=dt(),[b,p]=c.useState(1),[f,N]=c.useState(10),[r,E]=c.useState(null),[G,V]=c.useState(!1),[n,C]=c.useState(null),[U,m]=c.useState(""),[T,Y]=c.useState(""),[D,B]=c.useState(""),[J,cs]=c.useState("created_at"),[W,Re]=c.useState("DESC"),[Pe,Ae]=c.useState(!1),[j,L]=c.useState({search:"",status:"",dateFilter:""}),[k,M]=c.useState([]),[ds,z]=c.useState(!1),[us,H]=c.useState(!1),[ms,ue]=c.useState(!1),[X,se]=c.useState({total:0,processed:0,succeeded:0,failed:0,currentItem:null}),[xs,me]=c.useState(null),[Qe,Te]=c.useState(""),[xe,De]=c.useState(null),[hs,te]=c.useState(!1),[F,ae]=c.useState(null),[gs,he]=c.useState(!1),[ps,ge]=c.useState(!1),[bs,pe]=c.useState(!1),[js,be]=c.useState(!1),[h,S]=c.useState(null),[je,re]=c.useState(""),[fe,Be]=c.useState(new Date().toISOString().split("T")[0]),fs=s=>s?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s):"-",{data:d,isLoading:Fe}=Ze(["registrations",j,b,f,J,W],()=>$.getAll(R(_({},j),{page:b,limit:f,sort_by:J,sort_order:W})),{keepPreviousData:!0}),{data:vs}=Ze("registration-stats",()=>$.getStats(),{select:s=>s.data}),ve=es(({id:s,data:t})=>$.updateStatus(s,t),{onSuccess:s=>{var t;a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),C(null),m(""),Y(""),B(""),(t=s==null?void 0:s.data)!=null&&t.registration&&E(s.data.registration),o.success("Status berhasil diupdate")},onError:s=>{var t,i;o.error(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Gagal update status")}}),ie=es(s=>$.createCustomer(s),{onSuccess:s=>{a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),o.success("Customer dan ticket instalasi berhasil dibuat!"),V(!1),E(null)},onError:s=>{var t,i;o.error(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Gagal membuat customer")}}),ys=()=>{if(!r)return;let s={status:n,notes:U};if(n==="rejected"){if(!T.trim()){o.error("Alasan penolakan wajib diisi");return}s.rejection_reason=T}if(n==="survey_scheduled"){if(!D){o.error("Tanggal survey wajib diisi");return}s.survey_scheduled_date=D}if(n==="survey_completed"){if(!U.trim()){o.error("Hasil survey wajib diisi");return}s.notes=U}ve.mutate({id:r.id,data:s})},Ns=s=>{ae(s),te(!0)},ks=()=>{F&&(ie.mutate(F.id),te(!1),ae(null))},le=s=>{J===s?Re(W==="ASC"?"DESC":"ASC"):(cs(s),Re("DESC")),p(1)},ne=s=>J!==s?e.jsx(nt,{className:"h-4 w-4 text-gray-400"}):W==="ASC"?e.jsx(ot,{className:"h-4 w-4 text-blue-600"}):e.jsx(ct,{className:"h-4 w-4 text-blue-600"}),Ie=s=>{const t={pending_verification:{label:"Pending",color:"bg-yellow-100 text-yellow-800"},verified:{label:"Verified",color:"bg-blue-100 text-blue-800"},survey_scheduled:{label:"Survey Scheduled",color:"bg-indigo-100 text-indigo-800"},survey_completed:{label:"Survey Done",color:"bg-purple-100 text-purple-800"},approved:{label:"Approved",color:"bg-green-100 text-green-800"},customer_created:{label:"Customer Created",color:"bg-emerald-100 text-emerald-800"},rejected:{label:"Rejected",color:"bg-red-100 text-red-800"}},i=t[s]||t.pending_verification;return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${i.color}`,children:i.label})},ws=()=>y(void 0,null,function*(){var s;try{Ae(!0);const i=((s=(yield $.getAll(R(_({},j),{page:1,limit:1e4,sort_by:J,sort_order:W}))).data)==null?void 0:s.registrations)||[];if(i.length===0){o.error("Tidak ada data untuk di-export");return}const v=x=>({pending_verification:"Pending",verified:"Verified",survey_scheduled:"Survey Scheduled",survey_completed:"Survey Done",approved:"Approved",customer_created:"Customer Created",rejected:"Rejected",cancelled:"Cancelled"})[x]||x,A=i.map((x,Z)=>({No:Z+1,"Registration Number":x.registration_number,"Tanggal Daftar":de(x.created_at),"Nama Lengkap":x.full_name,Email:x.email||"-",WhatsApp:x.phone||"-","Alamat Lengkap":x.address||"-",Kota:x.city||"-",Package:x.package_name||"-","Harga Bulanan":xt(x.monthly_price),Status:v(x.status),"Verified Date":x.verified_at?de(x.verified_at):"-","Survey Scheduled":x.survey_scheduled_date?de(x.survey_scheduled_date):"-","Approved Date":x.approved_at?de(x.approved_at):"-","Rejection Reason":x.rejection_reason||"-","Preferred Install Date":x.preferred_installation_date?mt(x.preferred_installation_date):"-"})),oe=ht(A,"Registrations_Export","Registrations Data");o.success(`✅ ${oe.rows} registrations berhasil di-export!`)}catch(t){console.error("Export error:",t),o.error("Gagal export data. Silakan coba lagi.")}finally{Ae(!1)}}),Cs=s=>{s.target.checked?(M(Le.map(t=>t.id)),z(!0)):(M([]),z(!1))},Ss=s=>{if(k.includes(s))M(k.filter(t=>t!==s)),z(!1);else{const t=[...k,s];M(t),t.length===Le.length&&z(!0)}},_s=()=>y(void 0,null,function*(){var s,t;if(k.length===0){o.error("Pilih registration terlebih dahulu");return}if(window.confirm(`Verify ${k.length} registration yang dipilih?`)){Te("Bulk Verify Registrations"),se({total:k.length,processed:0,succeeded:0,failed:0,currentItem:"Starting..."}),H(!0);try{const i=yield is.bulkVerifyRegistrations(k,{notes:"Bulk verified"});se({total:i.total,processed:i.total,succeeded:i.succeeded,failed:i.failed,currentItem:null}),setTimeout(()=>{H(!1),me(i),ue(!0),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),M([]),z(!1),i.failed===0?o.success(`✅ ${i.succeeded} registration berhasil di-verify`):o.warning(`⚠️ ${i.succeeded} berhasil, ${i.failed} gagal`)},1e3)}catch(i){console.error("Bulk verify error:",i),H(!1),o.error(((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.message)||"Gagal verify registration")}}}),Rs=()=>y(void 0,null,function*(){var t,i;if(k.length===0){o.error("Pilih registration terlebih dahulu");return}const s=window.prompt("Alasan reject (akan diterapkan ke semua):");if(s&&window.confirm(`⚠️ Reject ${k.length} registration?`)){Te("Bulk Reject Registrations"),se({total:k.length,processed:0,succeeded:0,failed:0,currentItem:"Starting..."}),H(!0);try{const v=yield is.bulkRejectRegistrations(k,{rejection_reason:s,notes:"Bulk rejected"});se({total:v.total,processed:v.total,succeeded:v.succeeded,failed:v.failed,currentItem:null}),setTimeout(()=>{H(!1),me(v),ue(!0),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),M([]),z(!1),v.failed===0?o.success(`✅ ${v.succeeded} registration berhasil di-reject`):o.warning(`⚠️ ${v.succeeded} berhasil, ${v.failed} gagal`)},1e3)}catch(v){console.error("Bulk reject error:",v),H(!1),o.error(((i=(t=v.response)==null?void 0:t.data)==null?void 0:i.message)||"Gagal reject registration")}}}),Ps=s=>y(void 0,null,function*(){M(s)}),ye=(s,t)=>{navigator.clipboard.writeText(s).then(()=>{De(t),o.success(`${t} berhasil di-copy!`),setTimeout(()=>De(null),2e3)}).catch(i=>{o.error("Gagal copy ke clipboard"),console.error("Copy error:",i)})},As=(s,t)=>{s.stopPropagation(),S(t),he(!0)},Qs=()=>y(void 0,null,function*(){if(h)try{yield $.updateStatus(h.id,"verified",{notes:"Quick verified"}),o.success(`Registration ${h.registration_number} verified`),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),he(!1),S(null)}catch(s){o.error("Failed to verify registration"),console.error("Quick verify error:",s)}}),Ts=(s,t)=>{s.stopPropagation(),S(t),re(""),ge(!0)},Ds=()=>y(void 0,null,function*(){if(h){if(!je.trim()){o.error("Alasan reject wajib diisi");return}try{yield $.updateStatus(h.id,"rejected",{rejection_reason:je,notes:"Quick rejected"}),o.success(`Registration ${h.registration_number} rejected`),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),ge(!1),S(null),re("")}catch(s){o.error("Failed to reject registration"),console.error("Quick reject error:",s)}}}),Bs=(s,t)=>{s.stopPropagation(),window.location.href=`tel:${t}`},Fs=(s,t)=>{s.stopPropagation(),window.location.href=`mailto:${t}`},Is=(s,t)=>{s.stopPropagation(),ae(t),te(!0)},$s=(s,t)=>{s.stopPropagation(),S(t),pe(!0)},Es=()=>y(void 0,null,function*(){if(h)try{yield $.updateStatus(h.id,"approved",{notes:"Quick approved"}),o.success(`Registration ${h.registration_number} approved`),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),pe(!1),S(null)}catch(s){o.error("Failed to approve registration"),console.error("Quick approve error:",s)}}),Ls=(s,t)=>{s.stopPropagation(),S(t),Be(new Date().toISOString().split("T")[0]),be(!0)},Ms=()=>y(void 0,null,function*(){if(h){if(!fe){o.error("Tanggal survey wajib diisi");return}try{yield $.updateStatus(h.id,"survey_scheduled",{survey_date:fe,notes:"Survey scheduled via quick action"}),o.success(`Survey scheduled for ${h.registration_number}`),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),be(!1),S(null)}catch(s){o.error("Failed to schedule survey"),console.error("Quick schedule survey error:",s)}}}),Os=P||u||w,$e=P||u||w,Ee=P||u,I=vs||{},Vs=((Oe=(Me=d==null?void 0:d.data)==null?void 0:Me.pagination)==null?void 0:Oe.total)||0,Le=((Ve=d==null?void 0:d.data)==null?void 0:Ve.registrations)||[];return c.useEffect(()=>{const s=A=>{console.log("🔄 [RegistrationsPage] Registration update received:",A),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),o.success("Data registrasi telah diperbarui!")},t=A=>{var oe,x,Z,Je;console.log("✨ [RegistrationsPage] New registration event received:",A),console.log("📋 [RegistrationsPage] Registration details:",{registration_number:(oe=A.registration)==null?void 0:oe.registration_number,full_name:(x=A.registration)==null?void 0:x.full_name,phone:(Z=A.registration)==null?void 0:Z.phone}),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats"),console.log("🔄 [RegistrationsPage] Queries invalidated, data will refetch"),o.success(`🎉 Pendaftaran baru dari ${((Je=A.registration)==null?void 0:Je.full_name)||"customer"}!`,{duration:5e3,icon:"🎉",style:{background:"#10B981",color:"#fff",fontWeight:"bold"}}),console.log("🎊 [RegistrationsPage] Toast notification shown")},i=A=>{console.log("👤 [RegistrationsPage] Customer created:",A),a.invalidateQueries(["registrations"]),a.invalidateQueries("registration-stats")},v=()=>{if(!Q.isConnected){console.log("⏳ [RegistrationsPage] Socket not connected yet, waiting..."),setTimeout(v,500);return}console.log("🔌 [RegistrationsPage] Socket connected, registering listeners..."),Q.on("new_registration",t),Q.on("registration-updated",s),Q.on("registration_updated",s),Q.on("customer-created",i),Q.on("registration_status_changed",s),console.log("📡 [RegistrationsPage] Socket.IO listeners registered for registrations")};return v(),()=>{Q.off("new_registration",t),Q.off("registration-updated",s),Q.off("registration_updated",s),Q.off("customer-created",i),Q.off("registration_status_changed",s),console.log("📡 [RegistrationsPage] Socket.IO listeners cleaned up")}},[a]),Os?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pendaftaran Customer"}),e.jsx("p",{className:"text-gray-600",children:"Kelola pendaftaran customer baru dari public form"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:ws,disabled:Pe||Fe,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors inline-flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:Pe?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"Export to Excel"]})}),e.jsxs(Gs,{to:"/registration-analytics",className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(Zs,{className:"-ml-1 mr-2 h-5 w-5"}),"Analytics"]}),e.jsxs("a",{href:"/register",target:"_blank",rel:"noopener noreferrer",className:"btn-primary",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Form Pendaftaran"]})]})]}),k.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[k.length," registration dipilih"]}),e.jsx("button",{onClick:()=>{M([]),z(!1)},className:"text-sm text-blue-600 hover:text-blue-800 hover:underline",children:"Batal Pilihan"})]}),e.jsxs("div",{className:"flex gap-2",children:[$e&&e.jsxs("button",{onClick:_s,className:"px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm inline-flex items-center",children:[e.jsx(ts,{className:"h-4 w-4 mr-1"}),"Verify"]}),Ee&&e.jsxs("button",{onClick:Rs,className:"px-3 py-1.5 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm inline-flex items-center",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(K,{icon:et,title:"Total Pendaftaran",value:I.total_registrations||0,color:"blue"}),e.jsx(K,{icon:st,title:"Need Review",value:(parseInt(I.pending_verification)||0)+(parseInt(I.verified)||0),color:"yellow",onClick:()=>{const s=j.status==="pending_verification"||j.status==="verified";L(R(_({},j),{status:s?"":"pending_verification",dateFilter:""})),p(1)}}),e.jsx(K,{icon:ke,title:"Survey",value:(parseInt(I.survey_scheduled)||0)+(parseInt(I.survey_completed)||0),color:"indigo",onClick:()=>{const s=j.status==="survey_scheduled"||j.status==="survey_completed";L(R(_({},j),{status:s?"":"survey_scheduled",dateFilter:""})),p(1)}}),e.jsx(K,{icon:q,title:"Approved",value:I.approved||0,color:"green",onClick:()=>{L(R(_({},j),{status:j.status==="approved"?"":"approved",dateFilter:""})),p(1)}})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(K,{icon:as,title:"Customer Created",value:I.customer_created||0,color:"emerald",onClick:()=>{L(R(_({},j),{status:j.status==="customer_created"?"":"customer_created",dateFilter:""})),p(1)}}),e.jsx(K,{icon:ce,title:"Rejected",value:I.rejected||0,color:"red",onClick:()=>{L(R(_({},j),{status:j.status==="rejected"?"":"rejected",dateFilter:""})),p(1)}}),e.jsx(K,{icon:ke,title:"Today's New",value:I.today_registrations||0,color:"orange",onClick:()=>{L(R(_({},j),{status:"",dateFilter:j.dateFilter==="today"?"":"today"})),p(1)}})]}),e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(tt,{className:"h-4 w-4 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Cari nama, email, nomor...",className:"form-input pl-10",value:j.search,onChange:s=>L(R(_({},j),{search:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"form-input",value:j.status,onChange:s=>L(R(_({},j),{status:s.target.value})),children:[e.jsx("option",{value:"",children:"Semua Status"}),e.jsx("option",{value:"pending_verification",children:"Pending Verification"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"survey_scheduled",children:"Survey Scheduled"}),e.jsx("option",{value:"survey_completed",children:"Survey Completed"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"customer_created",children:"Customer Created"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["All Registrations",e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",Vs," total)"]})]})}),e.jsxs("div",{className:"card-body p-0",children:[Fe?e.jsx("div",{className:"py-12",children:e.jsx(ut,{className:"mx-auto"})}):((Ue=d==null?void 0:d.data)==null?void 0:Ue.registrations.length)===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ne,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Belum ada pendaftaran"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Pendaftaran akan muncul setelah customer mengisi form pendaftaran"}),e.jsxs("a",{href:"/register",target:"_blank",rel:"noopener noreferrer",className:"btn-primary inline-flex items-center",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Buka Form Pendaftaran"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-header-cell w-12",children:e.jsx("input",{type:"checkbox",checked:ds,onChange:Cs,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",title:"Pilih Semua"})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>le("registration_number"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Nomor Registrasi"}),ne("registration_number")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>le("full_name"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Customer"}),ne("full_name")]})}),e.jsx("th",{className:"table-header-cell",children:"Paket"}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>le("status"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status"}),ne("status")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>le("created_at"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Tanggal"}),ne("created_at")]})}),e.jsx("th",{className:"table-header-cell",children:"Quick Actions"})]})}),e.jsx("tbody",{className:"table-body",children:(ze=d==null?void 0:d.data)==null?void 0:ze.registrations.map(s=>e.jsxs("tr",{onClick:()=>l(`/registrations/${s.id}`),className:"group cursor-pointer hover:bg-blue-50 hover:shadow-md hover:border-l-4 hover:border-l-green-500 transition-all duration-200",title:"Klik untuk lihat detail registrasi",children:[e.jsx("td",{className:"table-cell",onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:k.includes(s.id),onChange:()=>Ss(s.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsxs("td",{className:"table-cell",children:[e.jsxs("div",{className:"font-medium text-blue-600 flex items-center gap-1",children:[e.jsx("span",{children:s.registration_number}),e.jsx("button",{onClick:t=>{t.stopPropagation(),ye(s.registration_number,"Registration Number")},className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-gray-200 rounded transition-opacity",title:"Copy Registration Number",children:xe==="Registration Number"?e.jsx(we,{className:"h-3 w-3 text-green-600"}):e.jsx(Ce,{className:"h-3 w-3 text-gray-500"})})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString("id-ID")})]}),e.jsxs("td",{className:"table-cell",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1 gap-1",children:[e.jsx(at,{className:"h-3 w-3"}),e.jsx("span",{children:s.phone}),e.jsx("button",{onClick:t=>{t.stopPropagation(),ye(s.phone,"Phone")},className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-gray-200 rounded transition-opacity",title:"Copy Phone",children:xe==="Phone"?e.jsx(we,{className:"h-3 w-3 text-green-600"}):e.jsx(Ce,{className:"h-3 w-3 text-gray-500"})})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 gap-1",children:[e.jsx(rs,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[150px]",children:s.email}),e.jsx("button",{onClick:t=>{t.stopPropagation(),ye(s.email,"Email")},className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-gray-200 rounded transition-opacity",title:"Copy Email",children:xe==="Email"?e.jsx(we,{className:"h-3 w-3 text-green-600"}):e.jsx(Ce,{className:"h-3 w-3 text-gray-500"})})]})]}),e.jsxs("td",{className:"table-cell",children:[e.jsx("div",{className:"font-medium",children:s.package_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[fs(s.monthly_price),"/bln"]})]}),e.jsx("td",{className:"table-cell",children:Ie(s.status)}),e.jsxs("td",{className:"table-cell",children:[e.jsx("div",{className:"text-sm text-gray-900",children:new Date(s.created_at).toLocaleDateString("id-ID")}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleTimeString("id-ID")})]}),e.jsx("td",{className:"table-cell",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[s.phone&&e.jsx("button",{onClick:t=>Bs(t,s.phone),className:"p-1.5 hover:bg-green-100 rounded transition-colors",title:"Call Customer",children:e.jsx(rt,{className:"h-4 w-4 text-green-600"})}),s.email&&e.jsx("button",{onClick:t=>Fs(t,s.email),className:"p-1.5 hover:bg-blue-100 rounded transition-colors",title:"Email Customer",children:e.jsx(rs,{className:"h-4 w-4 text-blue-600"})}),$e&&s.status==="pending_verification"&&e.jsx("button",{onClick:t=>As(t,s),className:"p-1.5 hover:bg-blue-100 rounded transition-colors",title:"Quick Verify",children:e.jsx(ts,{className:"h-4 w-4 text-blue-600"})}),Ee&&!["customer_created","rejected","cancelled"].includes(s.status)&&e.jsx("button",{onClick:t=>Ts(t,s),className:"p-1.5 hover:bg-red-100 rounded transition-colors",title:"Quick Reject",children:e.jsx(ce,{className:"h-4 w-4 text-red-600"})}),s.status==="verified"&&e.jsx("button",{onClick:t=>$s(t,s),className:"p-1.5 hover:bg-green-100 rounded transition-colors",title:"Quick Approve",children:e.jsx(q,{className:"h-4 w-4 text-green-600"})}),s.status==="verified"&&e.jsx("button",{onClick:t=>Ls(t,s),className:"p-1.5 hover:bg-orange-100 rounded transition-colors",title:"Quick Schedule Survey",children:e.jsx(ke,{className:"h-4 w-4 text-orange-600"})}),s.status==="approved"&&!s.customer_id&&e.jsx("button",{onClick:t=>Is(t,s),className:"p-1.5 hover:bg-purple-100 rounded transition-colors",title:"Quick Create Customer",children:e.jsx(as,{className:"h-4 w-4 text-purple-600"})})]})})]},s.id))})]})}),((Ke=(He=d==null?void 0:d.data)==null?void 0:He.registrations)==null?void 0:Ke.length)>0&&((Ye=d==null?void 0:d.data)==null?void 0:Ye.pagination)&&e.jsx("div",{className:"bg-white border-t border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>p(Math.max(1,b-1)),disabled:b===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>p(Math.min(d.data.pagination.pages,b+1)),disabled:b===d.data.pagination.pages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-700",children:"Show"}),e.jsxs("select",{value:f,onChange:s=>{N(parseInt(s.target.value)),p(1)},className:"form-input py-1 px-2 text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsx("span",{className:"text-sm text-gray-700",children:"rows"})]}),e.jsx("div",{className:"border-l border-gray-300 h-6"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(b-1)*f+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(b*f,d.data.pagination.total)})," ","of ",e.jsx("span",{className:"font-medium",children:d.data.pagination.total})," results"]})]}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>p(Math.max(1,b-1)),disabled:b===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(it,{className:"h-5 w-5"})}),Array.from({length:Math.min(d.data.pagination.pages,10)},(s,t)=>{const i=d.data.pagination.pages;return i<=10||b<=5?t+1:b>=i-4?i-9+t:b-5+t}).map(s=>e.jsx("button",{onClick:()=>p(s),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${b===s?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:s},s)),e.jsx("button",{onClick:()=>p(Math.min(d.data.pagination.pages,b+1)),disabled:b===d.data.pagination.pages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(_e,{className:"h-5 w-5"})})]})})]})]})})]}),G&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Detail Pendaftaran"}),e.jsx("button",{onClick:()=>V(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ce,{className:"h-6 w-6"})})]})}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 mt-1",children:Ie(r.status)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nomor Registrasi"}),e.jsx("p",{className:"text-lg font-bold text-blue-600 mt-1",children:r.registration_number})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Data Pribadi"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nama Lengkap"}),e.jsx("p",{className:"font-medium text-gray-900",children:r.full_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium text-gray-900",children:r.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"WhatsApp"}),e.jsxs("p",{className:"font-medium text-green-600 flex items-center",children:[r.phone,e.jsx(lt,{className:"h-4 w-4 ml-1",title:"Verified"})]})]}),r.id_card_number&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nomor KTP"}),e.jsx("p",{className:"font-medium text-gray-900",children:r.id_card_number})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Alamat"}),e.jsx("p",{className:"text-gray-900",children:r.address}),(r.rt||r.rw)&&e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["RT ",r.rt||"-"," / RW ",r.rw||"-"]}),e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:[r.kelurahan,", ",r.kecamatan,", ",r.city," ",r.postal_code]}),r.address_notes&&e.jsxs("p",{className:"text-gray-600 text-sm mt-2 italic",children:["Catatan: ",r.address_notes]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Paket"}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6 border border-blue-200",children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:r.package_name}),e.jsxs("p",{className:"text-lg text-gray-600 mt-1",children:[r.bandwidth_down," Mbps"]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:["Rp ",(qe=r.monthly_price)==null?void 0:qe.toLocaleString("id-ID"),"/bulan"]})]})]}),!["rejected"].includes(r.status)&&r.status!=="customer_created"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:r.status==="approved"&&!r.customer_id?"Create Customer":"Available Actions"}),r.status==="pending_verification"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-green-50 transition-colors",style:{borderColor:n==="verified"?"#10b981":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"verified",checked:n==="verified",onChange:s=>C(s.target.value),className:"h-4 w-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"✅ Verify - Verifikasi Data"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Data sudah diperiksa dan valid"})]})]}),e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-red-50 transition-colors",style:{borderColor:n==="rejected"?"#ef4444":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"rejected",checked:n==="rejected",onChange:s=>C(s.target.value),className:"h-4 w-4 text-red-600 focus:ring-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"❌ Reject - Tolak Pendaftaran"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Data tidak valid atau tidak memenuhi syarat"})]})]})]})}),r.status==="verified"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-green-50 transition-colors",style:{borderColor:n==="approved"?"#10b981":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"approved",checked:n==="approved",onChange:s=>C(s.target.value),className:"h-4 w-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"✅ Approve - Setujui Langsung"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Skip survey, langsung create customer (Fast Track)"})]})]}),e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-indigo-50 transition-colors",style:{borderColor:n==="survey_scheduled"?"#6366f1":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"survey_scheduled",checked:n==="survey_scheduled",onChange:s=>C(s.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"📅 Schedule Survey"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Jadwalkan survey lokasi terlebih dahulu"})]})]}),e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-red-50 transition-colors",style:{borderColor:n==="rejected"?"#ef4444":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"rejected",checked:n==="rejected",onChange:s=>C(s.target.value),className:"h-4 w-4 text-red-600 focus:ring-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"❌ Reject - Tolak Pendaftaran"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Data tidak memenuhi syarat"})]})]})]})}),r.status==="survey_scheduled"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-indigo-50 border-2 border-indigo-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-indigo-900",children:"📅 Survey Scheduled"}),e.jsx("p",{className:"text-sm text-indigo-700 mt-1",children:"Survey telah dijadwalkan. Setelah survey dilakukan, update status di bawah ini."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-green-50 transition-colors",style:{borderColor:n==="survey_completed"?"#10b981":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"survey_completed",checked:n==="survey_completed",onChange:s=>C(s.target.value),className:"h-4 w-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"✅ Survey Completed"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Survey sudah selesai, lokasi feasible untuk instalasi"})]})]}),e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-red-50 transition-colors",style:{borderColor:n==="rejected"?"#ef4444":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"rejected",checked:n==="rejected",onChange:s=>C(s.target.value),className:"h-4 w-4 text-red-600 focus:ring-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"❌ Reject - Tidak Feasible"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Lokasi tidak memungkinkan untuk instalasi"})]})]})]})]}),r.status==="survey_completed"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"✅ Survey Completed"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Survey sudah selesai. Pilih tindakan selanjutnya di bawah ini."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-green-50 transition-colors",style:{borderColor:n==="approved"?"#10b981":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"approved",checked:n==="approved",onChange:s=>C(s.target.value),className:"h-4 w-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"✅ Approve - Setujui Pendaftaran"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Lokasi feasible, siap untuk create customer"})]})]}),e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-red-50 transition-colors",style:{borderColor:n==="rejected"?"#ef4444":"#e5e7eb"},children:[e.jsx("input",{type:"radio",name:"action",value:"rejected",checked:n==="rejected",onChange:s=>C(s.target.value),className:"h-4 w-4 text-red-600 focus:ring-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"❌ Reject - Tidak Feasible"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Hasil survey menunjukkan lokasi tidak layak"})]})]})]})]}),r.status==="approved"&&!r.customer_id&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-purple-900",children:"🎉 Registration Approved!"}),e.jsx("p",{className:"text-sm text-purple-700 mt-1",children:"Pendaftaran sudah disetujui. Klik tombol di bawah untuk membuat data customer dan ticket instalasi."})]}),e.jsx("button",{onClick:()=>Ns(r),disabled:ie.isLoading,className:"w-full py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 transition-colors inline-flex items-center justify-center",children:ie.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(HomeIcon,{className:"h-5 w-5 mr-2"}),"Buat Customer & Ticket Instalasi"]})})]}),n&&r.status!=="approved"&&e.jsxs("div",{className:"mt-6 space-y-4",children:[n==="survey_scheduled"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Tanggal Survey ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"datetime-local",value:D,onChange:s=>B(s.target.value),className:"form-input",min:new Date().toISOString().slice(0,16)})]}),n==="survey_completed"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Hasil Survey ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{rows:4,value:U,onChange:s=>m(s.target.value),className:"form-input",placeholder:"Contoh: Survey completed successfully. ODP distance: 50m. Cable needed: 60m. No obstacles found. Location is feasible for installation."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"💡 Tips: Sebutkan jarak ODP, panjang kabel needed, hambatan (jika ada), dan kesimpulan kelayakan instalasi."})]}),n==="rejected"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Alasan Penolakan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{rows:3,value:T,onChange:s=>Y(s.target.value),className:"form-input",placeholder:"Jelaskan alasan penolakan secara detail..."})]}),n!=="survey_completed"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan (Opsional)"}),e.jsx("textarea",{rows:2,value:U,onChange:s=>m(s.target.value),className:"form-input",placeholder:"Tambahkan catatan tambahan..."})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx("button",{onClick:()=>{C(null),m(""),Y(""),B("")},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:"Batal"}),e.jsx("button",{onClick:ys,disabled:ve.isLoading,className:`
                              px-6 py-2 rounded-lg text-white transition-colors inline-flex items-center
                              ${n==="rejected"?"bg-red-600 hover:bg-red-700":n==="survey_scheduled"?"bg-indigo-600 hover:bg-indigo-700":"bg-green-600 hover:bg-green-700"}
                              disabled:bg-gray-400 disabled:cursor-not-allowed
                            `,children:ve.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Konfirmasi"]})})]})]})]})]})]})})]}),e.jsx(ee,{isOpen:hs,onClose:()=>{te(!1),ae(null)},onConfirm:ks,title:"🏠 Buat Customer & Ticket Instalasi",message:F?`Apakah Anda yakin ingin membuat customer dan ticket instalasi untuk "${F.full_name}"?`:"",confirmText:"Ya, Buat Customer",cancelText:"Batal",type:"success",isLoading:ie.isLoading,children:F&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-2",children:[e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Nama:"}),e.jsx("span",{className:"font-medium text-gray-900",children:F.full_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"No. HP:"}),e.jsx("span",{className:"font-medium text-gray-900",children:F.phone||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Paket:"}),e.jsx("span",{className:"font-medium text-gray-900",children:F.service_package||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Alamat:"}),e.jsxs("span",{className:"font-medium text-gray-900 text-right ml-2",children:[(Ge=F.installation_address)==null?void 0:Ge.substring(0,40),"..."]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["✅ Customer baru akan dibuat",e.jsx("br",{}),"🎫 Ticket instalasi akan otomatis dibuatkan",e.jsx("br",{}),"📧 Notifikasi akan dikirim"]})})]})}),e.jsx(ee,{isOpen:gs,onClose:()=>{he(!1),S(null)},onConfirm:Qs,title:"✅ Verifikasi Data",message:h?`Verifikasi data pendaftaran dari "${h.full_name}"?`:"",confirmText:"Ya, Verifikasi",cancelText:"Batal",type:"info",children:h&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-2",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["✅ Status akan berubah menjadi ",e.jsx("span",{className:"font-semibold text-blue-900",children:'"Verified"'}),e.jsx("br",{}),"📋 Data sudah diperiksa dan valid"]})})}),e.jsx(ee,{isOpen:bs,onClose:()=>{pe(!1),S(null)},onConfirm:Es,title:"✅ Approve Registrasi",message:h?`Setujui pendaftaran dari "${h.full_name}"?`:"",confirmText:"Ya, Approve",cancelText:"Batal",type:"success",children:h&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mt-2",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["✅ Status akan berubah menjadi ",e.jsx("span",{className:"font-semibold text-green-900",children:'"Approved"'}),e.jsx("br",{}),"🎉 Pendaftaran disetujui"]})})}),e.jsx(ee,{isOpen:js,onClose:()=>{be(!1),S(null)},onConfirm:Ms,title:"📅 Jadwalkan Survey",message:h?`Jadwalkan survey untuk "${h.full_name}"`:"",confirmText:"Ya, Jadwalkan",cancelText:"Batal",type:"warning",children:h&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tanggal Survey *"}),e.jsx("input",{type:"date",value:fe,onChange:s=>Be(s.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]})}),e.jsx(ee,{isOpen:ps,onClose:()=>{ge(!1),S(null),re("")},onConfirm:Ds,title:"❌ Reject Registrasi",message:h?`Tolak pendaftaran dari "${h.full_name}"?`:"",confirmText:"Ya, Reject",cancelText:"Batal",type:"danger",children:h&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alasan Reject *"}),e.jsx("textarea",{value:je,onChange:s=>re(s.target.value),rows:3,placeholder:"Tuliskan alasan reject...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none"})]})}),e.jsx(kt,{isOpen:us,total:X.total,processed:X.processed,succeeded:X.succeeded,failed:X.failed,currentItem:X.currentItem,operation:Qe,onCancel:()=>H(!1)}),e.jsx(wt,{isOpen:ms,results:xs,operation:Qe,onClose:()=>{ue(!1),me(null)},onRetryFailed:Ps})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96",children:[e.jsx(Xs,{className:"h-24 w-24 text-red-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access Registrations."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Required role: Admin, Supervisor, or Customer Service"})]})};export{Ft as default};
//# sourceMappingURL=RegistrationsPage-CikI4DTW.js.map
