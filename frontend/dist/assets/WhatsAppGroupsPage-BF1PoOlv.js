var c=(t,i,l)=>new Promise((v,p)=>{var m=n=>{try{h(l.next(n))}catch(a){p(a)}},y=n=>{try{h(l.throw(n))}catch(a){p(a)}},h=n=>n.done?v(n.value):Promise.resolve(n.value).then(m,y);h((l=l.apply(t,i)).next())});import{a as d,j as e}from"./notifications-joTign0d.js";import{r as g}from"./react-vendor-BQ7pSkNi.js";import{a as P,b as z,u as C}from"./react-query-B7OIdD7u.js";import{n as N,P as I,C as D,b as B,aE as _,c as F,T as G,a as Q,z as x}from"./ui-vendor-C3ZQt1VJ.js";import{L as q}from"./customers-CZBA7RtB.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";import"./forms-Dmkgx8TD.js";const w={getAll:(...i)=>c(void 0,[...i],function*(t={}){const l=new URLSearchParams(t).toString();return d.get(`/whatsapp-groups?${l}`)}),getById:t=>c(void 0,null,function*(){return d.get(`/whatsapp-groups/${t}`)}),create:t=>c(void 0,null,function*(){return d.post("/whatsapp-groups",t)}),update:(t,i)=>c(void 0,null,function*(){return d.put(`/whatsapp-groups/${t}`,i)}),delete:t=>c(void 0,null,function*(){return d.delete(`/whatsapp-groups/${t}`)}),testSend:(t,i)=>c(void 0,null,function*(){return d.post(`/whatsapp-groups/${t}/test`,{message:i})}),getLogs:(t,i=50)=>c(void 0,null,function*(){return d.get(`/whatsapp-groups/${t}/logs?limit=${i}`)})},Y=()=>{var k;const t=P(),[i,l]=g.useState(!1),[v,p]=g.useState(null),[m,y]=g.useState("all"),[h,n]=g.useState(!1),[a,T]=g.useState(null),[u,b]=g.useState(""),{data:f,isLoading:A}=z(["whatsapp-groups",m],()=>w.getAll(m!=="all"?{category:m}:{}),{onError:s=>{var r,o;x.error(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to load WhatsApp groups")}}),S=((k=f==null?void 0:f.data)==null?void 0:k.groups)||[],M=C(s=>w.delete(s),{onSuccess:()=>{x.success("WhatsApp group deleted successfully"),t.invalidateQueries(["whatsapp-groups"])},onError:s=>{var r,o;x.error(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to delete group")}}),j=C(({id:s,message:r})=>w.testSend(s,r),{onSuccess:()=>{x.success("Test message sent successfully! Check your WhatsApp group."),n(!1),b("")},onError:s=>{var r,o;x.error(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to send test message")}}),E=s=>{window.confirm(`Hapus WhatsApp group "${s.name}"?`)&&M.mutate(s.id)},$=s=>{T(s),b(`ðŸ§ª *TEST MESSAGE*

Halo ${s.name}!

Ini adalah test message dari AGLIS Management System.

Waktu: ${new Date().toLocaleString("id-ID")}

âœ… Jika Anda menerima pesan ini, grup sudah terkonfigurasi dengan benar!`),n(!0)},W=()=>{if(!u.trim()){x.error("Message cannot be empty");return}j.mutate({id:a.id,message:u})},L=s=>({technicians:"bg-blue-100 text-blue-700",supervisors:"bg-purple-100 text-purple-700",managers:"bg-indigo-100 text-indigo-700",noc:"bg-orange-100 text-orange-700",customer_service:"bg-green-100 text-green-700",all:"bg-gray-100 text-gray-700"})[s]||"bg-gray-100 text-gray-700";return A?e.jsx(q,{}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(N,{className:"h-7 w-7 mr-3 text-green-600"}),"WhatsApp Groups"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Kelola grup WhatsApp untuk notifikasi tim"})]}),e.jsxs("button",{onClick:()=>{p(null),l(!0)},className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-sm",children:[e.jsx(I,{className:"h-5 w-5 mr-2"}),"Tambah Group"]})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:["all","technicians","supervisors","managers","noc","customer_service"].map(s=>e.jsx("button",{onClick:()=>y(s),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${m===s?"bg-green-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:s==="all"?"Semua":s.replace("_"," ").charAt(0).toUpperCase()+s.slice(1).replace("_"," ")},s))})]}),S.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[e.jsx(N,{className:"h-16 w-16 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Belum ada WhatsApp group yang terdaftar"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(s=>{var r;return e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition-shadow p-5 border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(N,{className:"h-5 w-5 mr-2 text-green-600"}),s.name]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]}),e.jsxs("div",{className:"flex gap-1",children:[s.is_verified&&e.jsx(D,{className:"h-5 w-5 text-green-600",title:"Verified"}),!s.is_active&&e.jsx(B,{className:"h-5 w-5 text-red-600",title:"Inactive"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${L(s.category)}`,children:s.category.replace("_"," ")})]}),s.work_zone&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Work Zone:"}),e.jsx("span",{className:"font-medium text-gray-900 capitalize",children:s.work_zone})]}),s.phone_number&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsx("span",{className:"font-mono text-gray-900",children:s.phone_number})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Notification Types:"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[((r=s.notification_types)==null?void 0:r.length)||0," types"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>$(s),className:"flex-1 flex items-center justify-center px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors text-sm font-medium",disabled:!s.phone_number&&!s.group_chat_id,title:!s.phone_number&&!s.group_chat_id?"No phone/chat ID configured":"Send test message",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Test"]}),e.jsx("button",{onClick:()=>{p(s),l(!0)},className:"flex items-center px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm",title:"Edit group",children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>E(s),className:"flex items-center px-3 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors text-sm",title:"Delete group",children:e.jsx(G,{className:"h-4 w-4"})})]})]},s.id)})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-lg w-full p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(_,{className:"h-5 w-5 mr-2 text-green-600"}),"Test Send - ",a==null?void 0:a.name]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Message:"}),e.jsx("textarea",{value:u,onChange:s=>b(s.target.value),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 font-mono text-sm",placeholder:"Enter test message..."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx(Q,{className:"h-4 w-4 inline mr-1"}),"Pesan akan dikirim ke: ",e.jsx("strong",{children:(a==null?void 0:a.phone_number)||(a==null?void 0:a.group_chat_id)||"-"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{n(!1),b("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Batal"}),e.jsx("button",{onClick:W,disabled:j.isLoading||!u.trim(),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:j.isLoading?"Sending...":"Send Test"})]})]})})]})};export{Y as default};
//# sourceMappingURL=WhatsAppGroupsPage-BF1PoOlv.js.map
