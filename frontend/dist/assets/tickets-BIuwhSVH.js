var ms=Object.defineProperty,us=Object.defineProperties;var xs=Object.getOwnPropertyDescriptors;var He=Object.getOwnPropertySymbols;var gs=Object.prototype.hasOwnProperty,hs=Object.prototype.propertyIsEnumerable;var Ve=(a,l,i)=>l in a?ms(a,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[l]=i,v=(a,l)=>{for(var i in l||(l={}))gs.call(l,i)&&Ve(a,i,l[i]);if(He)for(var i of He(l))hs.call(l,i)&&Ve(a,i,l[i]);return a},G=(a,l)=>us(a,xs(l));var F=(a,l,i)=>new Promise((y,S)=>{var m=_=>{try{M(i.next(_))}catch(K){S(K)}},N=_=>{try{M(i.throw(_))}catch(K){S(K)}},M=_=>_.done?y(_.value):Promise.resolve(_.value).then(m,N);M((i=i.apply(a,l)).next())});import{a as Y,j as e}from"./notifications-TOkqypMs.js";import{r as A,u as ps,e as bs,L as Ye}from"./react-vendor-BQ7pSkNi.js";import{a as Ue,b as ge,u as Re}from"./react-query-B7OIdD7u.js";import{aa as rs,X as ls,a9 as Ze,K as ke,U as re,a8 as Se,N as xe,e as js,q as fs,ab as Ns,ac as Xe,C as oe,ad as ys,a as Ke,ae as Me,z as L,S as os,af as vs,x as ws,y as ks,L as _s,D as cs,P as es,O as ss,T as Ts,ag as Qe,ah as $s,ai as Ge,b as Fe,v as as,d as ts,Q as Ss,V as Cs,W as As,Y as Ps,Z as Ls,_ as Ds,aj as $e,ak as ns,al as Os,n as Ms,m as Es,g as We,F as Ee,r as Is}from"./ui-vendor-DNUUwVb4.js";import{t as le,L as Be,u as Je,K as we,T as Rs,f as Ie,e as Fs,p as Us,B as is}from"./customers-CPmtKPP6.js";import{u as Bs}from"./forms-Dmkgx8TD.js";const ds={getTechnicians:(...l)=>F(void 0,[...l],function*(a={}){const i=new URLSearchParams(a).toString();return yield Y.get(`/technicians?${i}`)}),getTechnician:a=>F(void 0,null,function*(){return yield Y.get(`/technicians/${a}`)}),createTechnician:a=>F(void 0,null,function*(){return yield Y.post("/technicians",a)}),updateTechnician:(a,l)=>F(void 0,null,function*(){return yield Y.put(`/technicians/${a}`,l)}),deleteTechnician:a=>F(void 0,null,function*(){return yield Y.delete(`/technicians/${a}`)}),updateAvailability:(a,l)=>F(void 0,null,function*(){return yield Y.patch(`/technicians/${a}/availability`,l)}),addSkill:(a,l)=>F(void 0,null,function*(){return yield Y.post(`/technicians/${a}/skills`,l)}),getTechnicianStats:()=>F(void 0,null,function*(){return yield Y.get("/technicians/stats/overview")}),getAvailableTechnicians:(...l)=>F(void 0,[...l],function*(a={}){const i=new URLSearchParams(a).toString();return yield Y.get(`/technicians/available/assignment?${i}`)}),getTechnicianPerformance:(a,l="month")=>F(void 0,null,function*(){return yield Y.get(`/technicians/${a}/performance?period=${l}`)}),updateLocation:(a,l)=>F(void 0,null,function*(){return yield Y.patch(`/technicians/${a}/location`,l)}),getTechnicianSchedule:(a,l,i)=>F(void 0,null,function*(){const y=new URLSearchParams({start_date:l,end_date:i});return yield Y.get(`/technicians/${a}/schedule?${y}`)}),updateSchedule:(a,l)=>F(void 0,null,function*(){return yield Y.put(`/technicians/${a}/schedule`,l)})},zs=({isOpen:a,onClose:l,ticket:i})=>{var E,H;const[y,S]=A.useState("auto"),[m,N]=A.useState(null),[M,_]=A.useState({force_zone:"",required_skills:[]}),K=Ue(),{data:b,isLoading:J}=ge(["assignment-recommendations",i==null?void 0:i.id],()=>le.getAssignmentRecommendations(i.id),{enabled:a&&!!(i!=null&&i.id),refetchOnWindowFocus:!1}),s=Re(d=>le.autoAssignTicket(i.id,d),{onSuccess:d=>{L.success("Ticket berhasil di-assign secara otomatis!"),K.invalidateQueries(["tickets"]),K.invalidateQueries(["ticket",i.id]),l()},onError:d=>{var w,k;L.error(((k=(w=d.response)==null?void 0:w.data)==null?void 0:k.message)||"Gagal melakukan auto assignment")}}),Z=Re(d=>le.assignTicket(i.id,d),{onSuccess:()=>{L.success("Ticket berhasil di-assign!"),K.invalidateQueries(["tickets"]),K.invalidateQueries(["ticket",i.id]),l()},onError:d=>{var w,k;L.error(((k=(w=d.response)==null?void 0:w.data)==null?void 0:k.message)||"Gagal melakukan assignment")}}),ae=()=>{s.mutate(M)},r=()=>{if(!m){L.error("Pilih teknisi terlebih dahulu");return}Z.mutate(m.id)},c=d=>{const w={available:{color:"bg-green-100 text-green-800",icon:oe,label:"Available"},unavailable:{color:"bg-red-100 text-red-800",icon:Ke,label:"Unavailable"}},k=w[d]||w.unavailable,P=k.icon;return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${k.color}`,children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),k.label]})},T=d=>{const w={available:{color:"bg-blue-100 text-blue-800",label:"Has Capacity"},full:{color:"bg-orange-100 text-orange-800",label:"At Capacity"}},k=w[d]||w.full;return e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${k.color}`,children:k.label})},z=d=>{const w={near:{color:"bg-green-100 text-green-800",icon:Me,label:"Nearby"},medium:{color:"bg-yellow-100 text-yellow-800",icon:Me,label:"Medium"},far:{color:"bg-red-100 text-red-800",icon:Me,label:"Far"},unknown:{color:"bg-gray-100 text-gray-800",icon:Me,label:"Unknown"}},k=w[d]||w.unknown,P=k.icon;return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${k.color}`,children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),k.label]})},Q=d=>{const w={junior:{color:"bg-blue-100 text-blue-800",label:"Junior"},senior:{color:"bg-purple-100 text-purple-800",label:"Senior"},expert:{color:"bg-orange-100 text-orange-800",label:"Expert"},specialist:{color:"bg-red-100 text-red-800",label:"Specialist"}},k=w[d]||w.junior;return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${k.color}`,children:[e.jsx(ys,{className:"h-3 w-3 mr-1"}),k.label]})};if(!a)return null;const u=((E=b==null?void 0:b.data)==null?void 0:E.recommendations)||[],g=((H=b==null?void 0:b.data)==null?void 0:H.ticket)||i;return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:l}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full",children:[e.jsxs("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(rs,{className:"h-6 w-6 text-blue-600 mr-2"}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Smart Assignment - Ticket #",g==null?void 0:g.ticket_number]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ls,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Customer"}),e.jsx("p",{className:"text-sm text-gray-900",children:g==null?void 0:g.customer_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Service Type"}),e.jsx("p",{className:"text-sm text-gray-900",children:(g==null?void 0:g.service_type)||"General"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Priority"}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${(g==null?void 0:g.priority)==="high"?"bg-red-100 text-red-800":(g==null?void 0:g.priority)==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:(g==null?void 0:g.priority)||"low"})]})]})}),e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsxs("button",{onClick:()=>S("auto"),className:`flex items-center px-4 py-2 rounded-lg font-medium ${y==="auto"?"bg-blue-100 text-blue-700 border-2 border-blue-200":"bg-gray-100 text-gray-700 border-2 border-transparent hover:bg-gray-200"}`,children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Auto Assignment"]}),e.jsxs("button",{onClick:()=>S("manual"),className:`flex items-center px-4 py-2 rounded-lg font-medium ${y==="manual"?"bg-blue-100 text-blue-700 border-2 border-blue-200":"bg-gray-100 text-gray-700 border-2 border-transparent hover:bg-gray-200"}`,children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Manual Selection"]})]}),y==="auto"&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"Assignment Options"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-1",children:"Force Work Zone"}),e.jsxs("select",{className:"form-input text-sm",value:M.force_zone,onChange:d=>_(w=>G(v({},w),{force_zone:d.target.value})),children:[e.jsx("option",{value:"",children:"Any Zone"}),e.jsx("option",{value:"Jakarta_Pusat",children:"Jakarta Pusat"}),e.jsx("option",{value:"Jakarta_Selatan",children:"Jakarta Selatan"}),e.jsx("option",{value:"Jakarta_Utara",children:"Jakarta Utara"}),e.jsx("option",{value:"Jakarta_Timur",children:"Jakarta Timur"}),e.jsx("option",{value:"Jakarta_Barat",children:"Jakarta Barat"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-1",children:"Required Skills"}),e.jsxs("select",{className:"form-input text-sm",multiple:!0,value:M.required_skills,onChange:d=>{const w=Array.from(d.target.selectedOptions,k=>k.value);_(k=>G(v({},k),{required_skills:w}))},children:[e.jsx("option",{value:"fiber_optic",children:"Fiber Optic"}),e.jsx("option",{value:"wireless",children:"Wireless"}),e.jsx("option",{value:"networking",children:"Networking"}),e.jsx("option",{value:"installation",children:"Installation"}),e.jsx("option",{value:"troubleshooting",children:"Troubleshooting"})]})]})]})]}),J&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Be,{size:"lg"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading recommendations..."})]}),!J&&u.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:y==="auto"?"Top Matches":"Available Technicians"}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:u.slice(0,y==="auto"?3:10).map(d=>{var w;return e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${y==="manual"&&(m==null?void 0:m.id)===d.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>y==="manual"&&N(d),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(re,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900",children:d.full_name}),Q(d.skill_level)]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["ID: ",d.employee_id]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[c(d.availability_status),T(d.capacity_status),z(d.distance_status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"h-3 w-3 text-yellow-400 mr-1"}),e.jsx("span",{children:d.avg_rating?parseFloat(d.avg_rating).toFixed(1):"N/A"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(xe,{className:"h-3 w-3 text-blue-400 mr-1"}),e.jsxs("span",{children:[d.current_tickets,"/",d.max_daily_tickets]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(js,{className:"h-3 w-3 text-green-400 mr-1"}),e.jsxs("span",{children:[d.avg_sla?parseFloat(d.avg_sla).toFixed(1):"N/A","%"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(fs,{className:"h-3 w-3 text-purple-400 mr-1"}),e.jsx("span",{children:(w=d.work_zone)==null?void 0:w.replace("_"," ")})]})]}),d.specializations&&d.specializations.length>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[d.specializations.slice(0,3).map((k,P)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(Ns,{className:"h-3 w-3 mr-1"}),k.replace("_"," ")]},P)),d.specializations.length>3&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",d.specializations.length-3," more"]})]})})]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:d.recommendation_score||0}),e.jsx("div",{className:"text-xs text-gray-500",children:"Score"})]})]})},d.id)})})]}),!J&&u.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No technicians available"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No technicians match the current criteria."})]})]}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[y==="auto"?e.jsx("button",{onClick:ae,disabled:s.isLoading||u.length===0,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:s.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"animate-spin h-4 w-4 mr-2"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Auto Assign"]})}):e.jsx("button",{onClick:r,disabled:Z.isLoading||!m,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:Z.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"animate-spin h-4 w-4 mr-2"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Assign Selected"]})}),e.jsx("button",{onClick:l,className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancel"})]})]})]})})},qs=({availableTechnicians:a=[],selectedTechnicians:l=[],leadTechnicianId:i=null,onChange:y,onLeadChange:S})=>{var ae;const[m,N]=A.useState(""),M=a.filter(r=>{var c;return r.full_name.toLowerCase().includes(m.toLowerCase())||((c=r.specialization)==null?void 0:c.toLowerCase().includes(m.toLowerCase()))}),_=r=>{if(l.some(T=>T.technician_id===r.id)){const T=l.filter(z=>z.technician_id!==r.id);y(T),i===r.id&&S(null)}else{const T={technician_id:r.id,role:"member"};y([...l,T])}},K=r=>{const c=l.map(T=>G(v({},T),{role:T.technician_id===r?"lead":T.role==="support"?"support":"member"}));y(c),S(r)},b=(r,c)=>{const T=l.map(z=>z.technician_id===r?G(v({},z),{role:c}):z);y(T)},J=r=>r.current_workload||0,s=r=>l.some(c=>c.technician_id===r),Z=r=>{const c=l.find(T=>T.technician_id===r);return(c==null?void 0:c.role)||"member"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:m,onChange:r=>N(r.target.value),placeholder:"Cari teknisi...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),l.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsxs("strong",{children:[l.length," teknisi"]})," dipilih",i&&e.jsxs("span",{className:"ml-2",children:["â€¢ Lead: ",(ae=a.find(r=>r.id===i))==null?void 0:ae.full_name]})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:M.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Tidak ada teknisi tersedia"}):M.map(r=>{const c=s(r.id),T=Z(r.id),z=i===r.id,Q=J(r);return e.jsx("div",{className:`border rounded-lg p-4 transition-all ${c?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:()=>_(r),className:"mt-1 h-5 w-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:r.full_name}),z&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),"LEAD"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[r.specialization&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(vs,{className:"h-3 w-3 mr-1"}),r.specialization]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ws,{className:"h-3 w-3 mr-1"}),Q," active tickets"]})]}),c&&e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role:"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{type:"button",onClick:()=>K(r.id),className:`px-3 py-1 text-xs rounded-lg transition-colors ${z?"bg-yellow-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Se,{className:"h-3 w-3 inline mr-1"}),"Lead"]}),e.jsx("button",{type:"button",onClick:()=>b(r.id,"member"),className:`px-3 py-1 text-xs rounded-lg transition-colors ${c&&T==="member"&&!z?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Member"}),e.jsx("button",{type:"button",onClick:()=>b(r.id,"support"),className:`px-3 py-1 text-xs rounded-lg transition-colors ${T==="support"?"bg-purple-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Support"})]})]})]})]})},r.id)})}),l.length>0&&!i&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-700",children:["âš ï¸ Pilih satu teknisi sebagai ",e.jsx("strong",{children:"Lead"})]})})]})},Ws=({isOpen:a,onClose:l,ticket:i})=>{const y=Ue(),[S,m]=A.useState([]),[N,M]=A.useState(null),{data:_,isLoading:K}=ge("technicians-active",()=>ds.getTechnicians({status:"active"}),{enabled:a}),b=Re(()=>F(void 0,null,function*(){return yield Y.put(`/tickets/${i.id}/assign-team`,{technicians:S})}),{onSuccess:()=>{L.success("Tim berhasil di-assign!"),y.invalidateQueries(["tickets"]),y.invalidateQueries(["ticket",i.id]),l(),m([]),M(null)},onError:Z=>{var ae,r;L.error(((r=(ae=Z.response)==null?void 0:ae.data)==null?void 0:r.message)||"Gagal assign tim")}}),J=(_==null?void 0:_.data)||_||[],s=Z=>{if(Z.preventDefault(),S.length===0){L.error("Pilih minimal 1 teknisi");return}if(!N){L.error("Tentukan lead technician");return}b.mutate()};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ke,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Assign Technician Team"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Ticket #",i==null?void 0:i.ticket_number," - ",i==null?void 0:i.title]})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ls,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:K?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent"})}):e.jsxs("form",{onSubmit:s,id:"team-assignment-form",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Teknisi (bisa lebih dari 1)"}),e.jsx(qs,{availableTechnicians:J,selectedTechnicians:S,leadTechnicianId:N,onChange:m,onLeadChange:M})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:[e.jsx("p",{className:"text-sm text-blue-700",children:e.jsx("strong",{children:"ðŸ’¡ Catatan:"})}),e.jsxs("ul",{className:"text-sm text-blue-700 mt-2 space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"Pilih minimal 1 teknisi (untuk single assignment)"}),e.jsx("li",{children:"Untuk tim, pilih 2+ teknisi"}),e.jsxs("li",{children:["Tentukan 1 teknisi sebagai ",e.jsx("strong",{children:"Lead"})," (koordinator)"]}),e.jsx("li",{children:"Lead bertanggung jawab untuk koordinasi & update"}),e.jsx("li",{children:"Semua anggota tim akan menerima notifikasi WhatsApp"})]})]})]})}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:S.length>0&&e.jsx("p",{className:"text-sm text-gray-600",children:S.length===1?e.jsxs("span",{children:[e.jsx(oe,{className:"inline h-4 w-4 text-green-600 mr-1"}),"Single assignment ready"]}):e.jsxs("span",{children:[e.jsx(ke,{className:"inline h-4 w-4 text-blue-600 mr-1"}),S.length," teknisi dalam tim"]})})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),e.jsx("button",{type:"submit",form:"team-assignment-form",disabled:b.isLoading||S.length===0||!N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:b.isLoading?"Assigning...":S.length===1?"Assign Technician":`Assign Team (${S.length})`})]})]})})]})}):null},Ks=()=>{var Le,De,Te,je,ne;const a=ps(),l=Ue(),{user:i,isAdmin:y,isSupervisor:S,isTechnician:m,isCustomerService:N}=Je(),[M,_]=A.useState(!1),[K,b]=A.useState(!1),[J,s]=A.useState(!1),[Z,ae]=A.useState(null),[r,c]=A.useState(1),[T,z]=A.useState(10),[Q,u]=A.useState("created_at"),[g,E]=A.useState("DESC"),[H,d]=A.useState(!1),[w,k]=A.useState("my-tickets"),[P,D]=A.useState({search:"",status:"",type:"",priority:""}),[ee,$]=A.useState([]),[ve,B]=A.useState(!1),[_e,de]=A.useState(null),Ce=n=>({installation:"Installation",repair:"Repair",maintenance:"Maintenance",upgrade:"Upgrade",downgrade:"Downgrade",wifi_setup:"WiFi Setup",dismantle:"Dismantle",speed_test:"Speed Test",bandwidth_upgrade:"Bandwidth Upgrade",redundancy_setup:"Redundancy Setup",network_config:"Network Config",security_audit:"Security Audit"})[n]||n,{data:U,isLoading:ze,refetch:he}=ge(["tickets",P,r,T,Q,g],()=>le.getTickets(G(v({},P),{page:r,limit:T,sort_by:Q,sort_order:g})),{keepPreviousData:!1,refetchOnMount:!0}),{data:Ne}=ge("ticket-stats",()=>le.getTicketStats(),{refetchOnWindowFocus:!0,refetchOnMount:"always"});A.useEffect(()=>{const n=()=>{l.invalidateQueries(["tickets"]),l.invalidateQueries("ticket-stats"),console.log("ðŸŽ« Ticket list & stats refreshed due to ticket update")};return window.addEventListener("ticket-updated",n),window.addEventListener("ticket-created",n),window.addEventListener("ticket-assigned",n),window.addEventListener("ticket-completed",n),()=>{window.removeEventListener("ticket-updated",n),window.removeEventListener("ticket-created",n),window.removeEventListener("ticket-assigned",n),window.removeEventListener("ticket-completed",n)}},[l]);const qe=()=>{c(1),he()},pe=n=>{Q===n?E(g==="ASC"?"DESC":"ASC"):(u(n),E("DESC")),c(1),l.invalidateQueries(["tickets"])},be=n=>Q!==n?e.jsx(Ps,{className:"h-4 w-4 text-gray-400"}):g==="ASC"?e.jsx(Ls,{className:"h-4 w-4 text-blue-600"}):e.jsx(Ds,{className:"h-4 w-4 text-blue-600"}),Ae=()=>F(void 0,null,function*(){try{d(!0);const o=(yield le.getTickets(G(v({},P),{page:1,limit:1e4,sort_by:Q,sort_order:g}))).data.tickets||[];if(o.length===0){L.error("Tidak ada data untuk di-export");return}const x=o.map((C,ie)=>{var ye,fe;return{No:ie+1,"Ticket Number":C.ticket_number,"Tanggal Dibuat":Ie(C.created_at),Type:Ce(C.type),Status:((ye=C.status)==null?void 0:ye.toUpperCase())||"-",Priority:((fe=C.priority)==null?void 0:fe.toUpperCase())||"-",Customer:C.customer_name||"-","Customer Code":C.customer_code||"-",Teknisi:C.technician_name||"Unassigned",Judul:C.title,Category:C.category||"-","SLA Due Date":Ie(C.sla_due_date),"Completed Date":C.completed_at?Ie(C.completed_at):"-","Scheduled Date":C.scheduled_date?Ie(C.scheduled_date):"-","Estimated Duration (min)":C.estimated_duration||"-"}}),R=Fs(x,"Tickets_Export","Tickets Data");L.success(`âœ… ${R.rows} tickets berhasil di-export!`)}catch(n){console.error("Export error:",n),L.error("Gagal export data. Silakan coba lagi.")}finally{d(!1)}}),t=()=>{b(!1),ae(null)},h=n=>{const o={open:{class:"badge-info",label:"Open"},assigned:{class:"badge-warning",label:"Assigned"},in_progress:{class:"badge-warning",label:"In Progress"},completed:{class:"badge-success",label:"Completed"},cancelled:{class:"badge-gray",label:"Cancelled"},on_hold:{class:"badge-gray",label:"On Hold"}},x=o[n]||o.open;return e.jsx("span",{className:`badge ${x.class}`,children:x.label})},I=n=>{const o={low:{class:"badge-gray",label:"Low"},normal:{class:"badge-info",label:"Normal"},high:{class:"badge-warning",label:"High"},critical:{class:"badge-danger",label:"Critical"}},x=o[n]||o.normal;return e.jsx("span",{className:`badge ${x.class}`,children:x.label})},j=n=>{n.target.checked?($(tickets.map(o=>o.id)),B(!0)):($([]),B(!1))},p=n=>{if(ee.includes(n))$(ee.filter(o=>o!==n)),B(!1);else{const o=[...ee,n];$(o),o.length===tickets.length&&B(!0)}},f=()=>F(void 0,null,function*(){if(ee.length===0){L.error("Pilih ticket terlebih dahulu");return}if(window.confirm(`Close ${ee.length} ticket yang dipilih?`))try{let n=0,o=0;for(const x of ee)try{yield le.updateTicket(x,{status:"completed"}),n++}catch(R){o++,console.error(`Failed to close ticket ${x}:`,R)}n>0?(L.success(`âœ… ${n} ticket berhasil di-close${o>0?`, ${o} gagal`:""}`),he(),$([]),B(!1)):L.error("Gagal close ticket")}catch(n){console.error("Bulk close error:",n),L.error("Terjadi kesalahan saat close ticket")}}),X=()=>F(void 0,null,function*(){if(ee.length===0){L.error("Pilih ticket terlebih dahulu");return}if(window.confirm(`âš ï¸ PERINGATAN: Hapus ${ee.length} ticket yang dipilih?`))try{let n=0,o=0;for(const x of ee)try{yield le.deleteTicket(x),n++}catch(R){o++,console.error(`Failed to delete ticket ${x}:`,R)}n>0?(L.success(`âœ… ${n} ticket berhasil dihapus${o>0?`, ${o} gagal`:""}`),he(),$([]),B(!1)):L.error("Gagal hapus ticket")}catch(n){console.error("Bulk delete error:",n),L.error("Terjadi kesalahan saat hapus ticket")}}),q=(n,o)=>{navigator.clipboard.writeText(n).then(()=>{de(o),L.success(`${o} berhasil di-copy!`),setTimeout(()=>de(null),2e3)}).catch(x=>{L.error("Gagal copy ke clipboard"),console.error("Copy error:",x)})},me=(n,o)=>{n.stopPropagation(),ae(o),b(!0)},V=(n,o)=>{n.stopPropagation(),ae(o),s(!0)},ue=(n,o)=>F(void 0,null,function*(){if(n.stopPropagation(),!!window.confirm(`Mark ticket ${o.ticket_number} as completed?`))try{yield le.updateTicket(o.id,{status:"completed"}),L.success(`Ticket ${o.ticket_number} marked as completed`),he()}catch(x){L.error("Failed to complete ticket"),console.error("Quick complete error:",x)}}),ce=(n,o)=>{n.stopPropagation(),window.location.href=`tel:${o}`},se=y||S||m||N,Pe=y||S||N,W=y,O=y||S,te=(Ne==null?void 0:Ne.data)||{};return se?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tickets"}),e.jsx("p",{className:"text-gray-600",children:"Manage service requests and work orders"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Ae,disabled:H||ze,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors inline-flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:H?e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Export to Excel"]})}),Pe&&e.jsxs("button",{onClick:()=>_(!0),className:"btn-primary",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"New Ticket"]})]})]}),ee.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[ee.length," ticket dipilih"]}),e.jsx("button",{onClick:()=>{$([]),B(!1)},className:"text-sm text-blue-600 hover:text-blue-800 hover:underline",children:"Batal Pilihan"})]}),e.jsxs("div",{className:"flex gap-2",children:[O&&e.jsxs("button",{onClick:()=>{if(ee.length===1){const n=tickets.find(o=>o.id===ee[0]);me({stopPropagation:()=>{}},n)}else L.info("Bulk assign coming soon!")},className:"px-3 py-1.5 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors text-sm inline-flex items-center",children:[e.jsx(ss,{className:"h-4 w-4 mr-1"}),"Assign"]}),e.jsxs("button",{onClick:f,className:"px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm inline-flex items-center",children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Close"]}),W&&e.jsxs("button",{onClick:X,className:"px-3 py-1.5 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm inline-flex items-center",children:[e.jsx(Ts,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})}),m&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(rs,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"View Mode:"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{k("my-tickets"),D(G(v({},P),{status:""}))},className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${w==="my-tickets"?"bg-blue-600 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"ðŸ“‹ My Tickets"}),e.jsx("button",{onClick:()=>{k("available"),D(G(v({},P),{status:"open"}))},className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${w==="available"?"bg-green-600 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"ðŸ†“ Available Tickets"})]})]}),e.jsx("div",{className:"mt-3 text-xs text-gray-600",children:w==="my-tickets"?"ðŸ“Œ Showing tickets assigned to you":"ðŸŽ¯ Showing unassigned tickets you can claim"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(we,{icon:Qe,title:"Total Tickets",value:te.total_tickets||0,color:"blue",onClick:()=>{D({search:"",status:"",type:"",priority:""}),c(1)}}),e.jsx(we,{icon:$s,title:"Open",value:te.open_tickets||0,color:"indigo",onClick:()=>{D(G(v({},P),{status:P.status==="open"?"":"open"})),c(1)}}),e.jsx(we,{icon:ke,title:"Assigned",value:te.assigned_tickets||0,color:"purple",onClick:()=>{D(G(v({},P),{status:P.status==="assigned"?"":"assigned"})),c(1)}}),e.jsx(we,{icon:Ge,title:"In Progress",value:te.in_progress_tickets||0,color:"yellow",onClick:()=>{D(G(v({},P),{status:P.status==="in_progress"?"":"in_progress"})),c(1)}})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(we,{icon:oe,title:"Completed",value:te.completed_tickets||0,color:"green",onClick:()=>{D(G(v({},P),{status:P.status==="completed"?"":"completed"})),c(1)}}),e.jsx(we,{icon:Fe,title:"Cancelled",value:te.cancelled_tickets||0,color:"red",onClick:()=>{D(G(v({},P),{status:P.status==="cancelled"?"":"cancelled"})),c(1)}})]})]}),e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(os,{className:"h-4 w-4 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",className:"form-input pl-10",placeholder:"Cari tiket...",value:P.search,onChange:n=>D(G(v({},P),{search:n.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"form-input",value:P.status,onChange:n=>D(G(v({},P),{status:n.target.value})),children:[e.jsx("option",{value:"",children:"Semua Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipe"}),e.jsxs("select",{className:"form-input",value:P.type,onChange:n=>D(G(v({},P),{type:n.target.value})),children:[e.jsx("option",{value:"",children:"Semua Tipe"}),e.jsx("option",{value:"installation",children:"Installation"}),e.jsx("option",{value:"repair",children:"Repair"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"upgrade",children:"Upgrade"}),e.jsx("option",{value:"downgrade",children:"Downgrade"}),e.jsx("option",{value:"wifi_setup",children:"WiFi Setup"}),e.jsx("option",{value:"dismantle",children:"Dismantle"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioritas"}),e.jsxs("select",{className:"form-input",value:P.priority,onChange:n=>D(G(v({},P),{priority:n.target.value})),children:[e.jsx("option",{value:"",children:"Semua Prioritas"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["All Tickets",(U==null?void 0:U.data)&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",U.data.pagination.total," total)"]})]})}),e.jsx("div",{className:"card-body p-0",children:ze?e.jsx("div",{className:"py-12",children:e.jsx(Be,{className:"mx-auto"})}):((De=(Le=U==null?void 0:U.data)==null?void 0:Le.tickets)==null?void 0:De.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",style:{tableLayout:"fixed",minWidth:"1200px"},children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-header-cell",style:{width:"50px"},children:e.jsx("input",{type:"checkbox",checked:ve,onChange:j,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",title:"Pilih Semua"})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>pe("ticket_number"),style:{width:"200px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Ticket"}),be("ticket_number")]})}),e.jsx("th",{className:"table-header-cell",style:{width:"160px"},children:"Customer"}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>pe("type"),style:{width:"110px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Type"}),be("type")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>pe("priority"),style:{width:"90px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Priority"}),be("priority")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>pe("status"),style:{width:"110px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status"}),be("status")]})}),e.jsx("th",{className:"table-header-cell",style:{width:"140px"},children:"Technician"}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>pe("created_at"),style:{width:"110px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Created"}),be("created_at")]})}),e.jsx("th",{className:"table-header-cell",style:{width:"120px"},children:"Quick Actions"})]})}),e.jsx("tbody",{className:"table-body",children:U.data.tickets.map(n=>e.jsxs("tr",{onClick:()=>a(`/tickets/${n.id}`),className:"group cursor-pointer hover:bg-blue-50 hover:shadow-md hover:border-l-4 hover:border-l-blue-500 transition-all duration-200",title:"Klik untuk lihat detail ticket",children:[e.jsx("td",{className:"table-cell",onClick:o=>o.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:ee.includes(n.id),onChange:()=>p(n.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-1",children:[e.jsx("span",{children:n.ticket_number}),e.jsx("button",{onClick:o=>{o.stopPropagation(),q(n.ticket_number,"Ticket Number")},className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-gray-200 rounded transition-opacity",title:"Copy Ticket Number",children:_e==="Ticket Number"?e.jsx(as,{className:"h-3 w-3 text-green-600"}):e.jsx(ts,{className:"h-3 w-3 text-gray-500"})})]}),e.jsx("div",{className:"text-sm text-gray-500 truncate",title:n.title,children:n.title})]})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",title:n.customer_name,children:n.customer_name}),e.jsxs("div",{className:"text-sm text-gray-500 truncate flex items-center gap-1",children:[e.jsx("span",{children:n.customer_phone}),e.jsx("button",{onClick:o=>{o.stopPropagation(),q(n.customer_phone,"Phone")},className:"opacity-0 group-hover:opacity-100 p-0.5 hover:bg-gray-200 rounded transition-opacity",title:"Copy Phone",children:_e==="Phone"?e.jsx(as,{className:"h-3 w-3 text-green-600"}):e.jsx(ts,{className:"h-3 w-3 text-gray-500"})})]})]})}),e.jsx("td",{className:"table-cell whitespace-nowrap",style:{width:"110px"},children:e.jsx("span",{className:"capitalize",children:Ce(n.type)})}),e.jsx("td",{className:"table-cell whitespace-nowrap",children:I(n.priority)}),e.jsx("td",{className:"table-cell whitespace-nowrap",children:h(n.status)}),e.jsx("td",{className:"table-cell",children:n.technician_name?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",title:n.technician_name,children:n.technician_name}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:n.employee_id})]}):e.jsx("span",{className:"text-gray-400",children:"Unassigned"})}),e.jsxs("td",{className:"table-cell whitespace-nowrap",style:{width:"110px"},children:[e.jsx("div",{className:"text-sm text-gray-900",children:new Date(n.created_at).toLocaleDateString()}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(n.created_at).toLocaleTimeString()})]}),e.jsx("td",{className:"table-cell",onClick:o=>o.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.customer_phone&&e.jsx("button",{onClick:o=>ce(o,n.customer_phone),className:"p-1.5 hover:bg-green-100 rounded transition-colors",title:"Call Customer",children:e.jsx(Ss,{className:"h-4 w-4 text-green-600"})}),O&&n.status!=="completed"&&n.status!=="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>me(o,n),className:"p-1.5 hover:bg-purple-100 rounded transition-colors",title:"Assign Single Technician",children:e.jsx(ss,{className:"h-4 w-4 text-purple-600"})}),e.jsx("button",{onClick:o=>V(o,n),className:"p-1.5 hover:bg-blue-100 rounded transition-colors",title:"Assign Team (Multiple Technicians)",children:e.jsx(ke,{className:"h-4 w-4 text-blue-600"})})]}),m&&n.status==="open"&&!n.assigned_technician_id&&e.jsx("button",{onClick:o=>F(void 0,null,function*(){var x,R,C,ie;o.stopPropagation();try{const fe=yield(yield fetch(`/api/technicians?user_id=${i.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),Oe=(R=(x=fe==null?void 0:fe.data)==null?void 0:x.technicians)==null?void 0:R[0];if(!Oe){L.error("Technician profile not found");return}yield le.assignTicket(n.id,Oe.id),L.success("Ticket assigned to you!"),he()}catch(ye){L.error(((ie=(C=ye.response)==null?void 0:C.data)==null?void 0:ie.message)||"Failed to assign ticket")}}),className:"p-1.5 hover:bg-blue-100 rounded transition-colors",title:"Assign to Me",children:e.jsx(re,{className:"h-4 w-4 text-blue-600"})}),n.status!=="completed"&&n.status!=="cancelled"&&e.jsx("button",{onClick:o=>ue(o,n),className:"p-1.5 hover:bg-green-100 rounded transition-colors",title:"Mark as Completed",children:e.jsx(oe,{className:"h-4 w-4 text-green-600"})})]})})]},n.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Qe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tickets found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first ticket."}),e.jsxs("button",{onClick:()=>_(!0),className:"btn-primary",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Create First Ticket"]})]})}),((je=(Te=U==null?void 0:U.data)==null?void 0:Te.tickets)==null?void 0:je.length)>0&&((ne=U==null?void 0:U.data)==null?void 0:ne.pagination)&&e.jsx("div",{className:"bg-white border-t border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>c(Math.max(1,r-1)),disabled:r===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>c(Math.min(U.data.pagination.pages,r+1)),disabled:r===U.data.pagination.pages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-700",children:"Show"}),e.jsxs("select",{value:T,onChange:n=>{z(parseInt(n.target.value)),c(1)},className:"form-input py-1 px-2 text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsx("span",{className:"text-sm text-gray-700",children:"rows"})]}),e.jsx("div",{className:"border-l border-gray-300 h-6"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(r-1)*T+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(r*T,U.data.pagination.total)})," ","of ",e.jsx("span",{className:"font-medium",children:U.data.pagination.total})," results"]})]}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>c(Math.max(1,r-1)),disabled:r===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Cs,{className:"h-5 w-5"})}),Array.from({length:Math.min(U.data.pagination.pages,10)},(n,o)=>{const x=U.data.pagination.pages;return x<=10||r<=5?o+1:r>=x-4?x-9+o:r-5+o}).map(n=>e.jsx("button",{onClick:()=>c(n),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${r===n?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:n},n)),e.jsx("button",{onClick:()=>c(Math.min(U.data.pagination.pages,r+1)),disabled:r===U.data.pagination.pages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(As,{className:"h-5 w-5"})})]})})]})]})})]}),e.jsx(Rs,{isOpen:M,onClose:()=>_(!1),onSuccess:qe}),e.jsx(zs,{isOpen:K,onClose:t,ticket:Z}),e.jsx(Ws,{isOpen:J,onClose:()=>{s(!1),ae(null)},ticket:Z})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96",children:[e.jsx(ks,{className:"h-24 w-24 text-red-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access Tickets."}),e.jsx("p",{className:"text-sm text-gray-500",children:"This page is for staff only."})]})},ta=Object.freeze(Object.defineProperty({__proto__:null,default:Ks},Symbol.toStringTag,{value:"Module"})),Qs={getAll:(...l)=>F(void 0,[...l],function*(a={}){try{const i=new URLSearchParams;a.status&&i.append("status",a.status),a.area&&i.append("area",a.area),a.search&&i.append("search",a.search),a.page&&i.append("page",a.page),a.limit&&i.append("limit",a.limit),a.sort_by&&i.append("sort_by",a.sort_by),a.sort_order&&i.append("sort_order",a.sort_order);const y=i.toString();return yield Y.get(`/odp${y?"?"+y:""}`)}catch(i){return console.error("âŒ ODPService error:",i),{data:[],pagination:{}}}}),getById:a=>F(void 0,null,function*(){return yield Y.get(`/odp/${a}`)}),create:a=>F(void 0,null,function*(){return yield Y.post("/odp",a)}),update:(a,l)=>F(void 0,null,function*(){return yield Y.put(`/odp/${a}`,l)}),delete:a=>F(void 0,null,function*(){return yield Y.delete(`/odp/${a}`)})},Gs=({ticket:a,onUpdate:l,isLoading:i,preSelectedStatus:y,onStatusPreSelected:S})=>{var be,Ae;const{user:m}=Je(),[N,M]=A.useState(a.status),[_,K]=A.useState(a.assigned_technician_id||"");A.useEffect(()=>{y&&(M(y),S&&S())},[y,S]);const{register:b,handleSubmit:J,formState:{errors:s},reset:Z,watch:ae,setValue:r}=Bs(),{data:c,isLoading:T,error:z}=ge("odp-active",()=>Qs.getAll(),{refetchOnWindowFocus:!1,select:t=>{console.log("ðŸ” ODP API Response:",t);const h=Array.isArray(t==null?void 0:t.data)?t.data:[];console.log("ðŸ“¦ ODP Array:",h);const I=h.filter(j=>j.status==="active");return console.log("âœ… Active ODPs:",I),I}}),{data:Q,isLoading:u,error:g}=ge("packages-active",()=>Us.getAll(),{refetchOnWindowFocus:!1,enabled:a.type==="upgrade"||a.type==="downgrade",select:t=>Array.isArray(t)?t:[]}),[E,H]=A.useState(null),[d,w]=A.useState(null),[k,P]=A.useState(null),[D,ee]=A.useState(null),[$,ve]=A.useState(null),[B,_e]=A.useState(null);A.useEffect(()=>{if(N==="completed"){const t=new Date,h=t.getFullYear(),I=String(t.getMonth()+1).padStart(2,"0"),j=String(t.getDate()).padStart(2,"0"),p=String(t.getHours()).padStart(2,"0"),f=String(t.getMinutes()).padStart(2,"0"),X=`${h}-${I}-${j}T${p}:${f}`;a.type==="installation"&&r("activation_date",X),(a.type==="repair"||a.type==="maintenance")&&r("repair_date",X)}},[N,a.type,r]);const{data:de,isLoading:Ce}=ge("available-technicians",()=>ds.getAvailableTechnicians(),{enabled:N==="assigned"}),U=[{value:"open",label:"Open",icon:xe,color:"text-blue-600",bgColor:"bg-blue-100",description:"Ticket is open and waiting for assignment"},{value:"assigned",label:"Assigned",icon:ns,color:"text-yellow-600",bgColor:"bg-yellow-100",description:"Ticket has been assigned to a technician"},{value:"in_progress",label:"In Progress",icon:ns,color:"text-orange-600",bgColor:"bg-orange-100",description:"Work is currently being performed"},{value:"completed",label:"Completed",icon:oe,color:"text-green-600",bgColor:"bg-green-100",description:"Work has been completed successfully"},{value:"on_hold",label:"On Hold",icon:Os,color:"text-gray-600",bgColor:"bg-gray-100",description:"Work is temporarily paused"},{value:"cancelled",label:"Cancelled",icon:Fe,color:"text-red-600",bgColor:"bg-red-100",description:"Ticket has been cancelled"}],he=(()=>{const t=a.status,h=m==null?void 0:m.role;a.assigned_technician_id;let j={open:["assigned","cancelled"],assigned:["in_progress","on_hold","cancelled"],in_progress:["completed","on_hold","cancelled"],on_hold:["in_progress","cancelled"],completed:[],cancelled:[]}[t]||[];return t!=="in_progress"&&t!=="on_hold"&&(j=j.filter(p=>p!=="completed")),h==="admin"||h==="supervisor"?U.filter(p=>p.value===t?!0:t==="completed"||t==="cancelled"||p.value==="open"?!1:j.includes(p.value)):h==="technician"?U.filter(p=>p.value===t||j.includes(p.value)):h==="customer_service"?U.filter(p=>p.value===t||j.includes(p.value)):U.filter(p=>p.value===t||j.includes(p.value))})(),Ne=t=>new Promise((h,I)=>{const j=new FileReader;j.readAsDataURL(t),j.onload=()=>h(j.result),j.onerror=p=>I(p)}),qe=t=>F(void 0,null,function*(){if(console.log("=== FORM SUBMIT STARTED ==="),console.log("Form data:",t),console.log("Selected status:",N),N==="completed"&&a.type==="installation"){if(console.log("ðŸ” [VALIDATION] Checking required files..."),console.log("ðŸ” [VALIDATION] otdrFile:",D),console.log("ðŸ” [VALIDATION] attenuationFile:",$),console.log("ðŸ” [VALIDATION] modemSnFile:",B),console.log("ðŸ” [VALIDATION] data.otdr_photo:",t.otdr_photo),console.log("ðŸ” [VALIDATION] data.attenuation_photo:",t.attenuation_photo),console.log("ðŸ” [VALIDATION] data.modem_sn_photo:",t.modem_sn_photo),!D){console.log("âŒ [VALIDATION] OTDR file missing!"),alert("Foto OTDR is required");return}if(!$){console.log("âŒ [VALIDATION] Attenuation file missing!"),alert("Foto Redaman Terakhir is required");return}if(!B){console.log("âŒ [VALIDATION] Modem SN file missing!"),alert("Foto SN Modem is required");return}console.log("âœ… All required files validated:",{otdr:D.name,attenuation:$.name,modemSn:B.name})}if(N==="assigned"&&a.status==="open"&&!_){alert("Please select a technician when assigning the ticket for the first time");return}const h=()=>{var n,o;if(console.log("ðŸ“ [AUTO-NOTES] Starting auto-generation..."),console.log("ðŸ“ [AUTO-NOTES] Custom notes provided?",!!((n=t.notes)!=null&&n.trim())),t.notes&&t.notes.trim())return console.log("ðŸ“ [AUTO-NOTES] Using custom notes"),t.notes;const p=a.customer_name||"Customer",f=a.customer_code||a.customer_id||"",X=a.type||"general",q=a.type_name||a.type||"Ticket",me=a.ticket_number||a.id,V=a.status,ue=N;console.log("ðŸ“ [AUTO-NOTES] Context:",{customerName:p,ticketType:X,oldStatus:V,newStatus:ue,ticketId:me});const ce=a.customer_address||"",se=a.package_name||"",Pe=a.bandwidth_down||a.bandwidth_up||"";let W="",O="";if(_&&((o=de==null?void 0:de.data)!=null&&o.technicians)){console.log("ðŸ“ [AUTO-NOTES] Looking up technician, selectedTechnician:",_),console.log("ðŸ“ [AUTO-NOTES] Available technicians:",de.data.technicians.length);const x=de.data.technicians.find(R=>R.id===parseInt(_));x?(W=x.full_name,O=x.employee_id,console.log("ðŸ“ [AUTO-NOTES] Found technician:",W)):console.log("ðŸ“ [AUTO-NOTES] Technician not found in list")}!W&&a.technician_name&&(W=a.technician_name,O=a.technician_employee_id||"",console.log("ðŸ“ [AUTO-NOTES] Using ticket technician:",W));const te=x=>{const R=new Date(x),C=String(R.getDate()).padStart(2,"0"),ie=String(R.getMonth()+1).padStart(2,"0"),ye=R.getFullYear(),fe=String(R.getHours()).padStart(2,"0"),Oe=String(R.getMinutes()).padStart(2,"0");return`${C}/${ie}/${ye} ${fe}:${Oe}`},Le=x=>{const R=new Date,C=new Date(R.getTime()+x*6e4);return te(C)},De=x=>({installation:"Dropcore fiber 50m, ONU/ONT, Patchcord LC-SC 3m, Rosette, Cable ties, Weatherproofing kit",maintenance:"OTDR, Power meter, Spare connectors, Cleaning kit, Patchcords",upgrade:"ONU (jika diperlukan), Configuration tools",downgrade:"Configuration tools, Billing system access",relocation:"Dropcore fiber, Patchcords, Cable management tools",troubleshooting:"OTDR, Power meter, Signal tester, Spare parts"})[x]||"Standard technician toolkit",Te=x=>({installation:120,maintenance:90,upgrade:45,downgrade:30,relocation:180,troubleshooting:60})[x]||60,je=()=>{if(a.sla_due_date){const x=new Date(a.sla_due_date),C=Math.floor((x-new Date)/(1e3*60*60)),ie=Math.floor(C/24);return ie>1?`${te(x)} (${ie} hari lagi)`:C>0?`${te(x)} (${C} jam lagi)`:`${te(x)} (âš ï¸ URGENT)`}return"Not set"},ne=X.toLowerCase();if(ue==="assigned"){if(console.log("ðŸ“ [AUTO-NOTES] Generating ASSIGNED notes, technicianName:",W),V==="open"&&W){const x=`ðŸ“‹ TICKET ASSIGNMENT

Tiket ${q} (${me}) berhasil di-assign.

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}${ce?`
Lokasi: ${ce}`:""}${se?`
Package: ${se}`:""}

Status berubah: "${V}" â†’ "Assigned"

Teknisi akan segera menghubungi customer untuk koordinasi jadwal pekerjaan. Estimasi penyelesaian: ${Te(ne)} menit setelah mulai dikerjakan.`;return console.log("ðŸ“ [AUTO-NOTES] Generated:",x.substring(0,100)+"..."),x}else if(W)return`ðŸ”„ RE-ASSIGNMENT

Tiket ${q} (${me}) di-assign ulang.

Teknisi Baru: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}

Status: "${V}" â†’ "Assigned"

Proses penanganan akan dilanjutkan oleh teknisi yang baru. Koordinasi dengan customer akan segera dilakukan.`}if(ue==="in_progress"){console.log("ðŸ“ [AUTO-NOTES] Generating IN_PROGRESS notes, ticketType:",ne);const x=te(new Date),R=Te(ne),C=Le(R),ie=De(ne);return ne==="installation"?`ðŸ”§ INSTALLATION DIMULAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}${ce?`
Lokasi: ${ce}`:""}${se&&Pe?`
Package: ${se} (${Pe} Mbps)`:se?`
Package: ${se}`:""}

Equipment: ${ie}

Timeline:
- Mulai: ${x}
- Target selesai: ${C} (estimasi ${R} menit)
- SLA Deadline: ${je()}

Status: "${V}" â†’ "In Progress"

Pekerjaan pemasangan fiber optic sedang berlangsung. Teknisi sedang melakukan routing kabel dan instalasi perangkat dengan monitoring signal quality.`:ne==="maintenance"?`ðŸ”§ MAINTENANCE DIMULAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}${ce?`
Lokasi: ${ce}`:""}
Issue: ${a.category_name||"Maintenance diperlukan"}

Diagnostic Tools: ${ie}

Timeline:
- Mulai: ${x}
- Target resolusi: ${C} (estimasi ${R} menit)
- SLA Deadline: ${je()}

Status: "${V}" â†’ "In Progress"

Teknisi sedang melakukan troubleshooting dan diagnosis untuk identifikasi akar masalah. Signal testing dan measurement sedang berlangsung.`:ne==="upgrade"?`ðŸ“ˆ UPGRADE SERVICE DIMULAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}${se?`
New Package: ${se}`:""}

Configuration Tools: ${ie}

Timeline:
- Mulai: ${x}
- Target selesai: ${C} (estimasi ${R} menit)
- SLA Deadline: ${je()}

Status: "${V}" â†’ "In Progress"

Teknisi sedang melakukan rekonfigurasi bandwidth dan update service plan. Perubahan konfigurasi di ONU dan core network sedang berlangsung.`:ne==="downgrade"?`ðŸ“‰ DOWNGRADE SERVICE DIMULAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}${se?`
New Package: ${se}`:""}

Timeline:
- Mulai: ${x}
- Target selesai: ${C} (estimasi ${R} menit)

Status: "${V}" â†’ "In Progress"

Teknisi sedang melakukan adjustment bandwidth sesuai package baru. Konfigurasi service plan sedang diupdate di system.`:`ðŸ”§ PEKERJAAN DIMULAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}${ce?`
Lokasi: ${ce}`:""}
Tipe: ${q}

Equipment: ${ie}

Timeline:
- Mulai: ${x}
- Target selesai: ${C} (estimasi ${R} menit)
- SLA Deadline: ${je()}

Status: "${V}" â†’ "In Progress"

Pekerjaan ${q} sedang berlangsung. Teknisi sedang aktif di lokasi customer.`}if(ue==="completed"){const x=te(new Date);return ne==="installation"?`âœ… INSTALLATION SELESAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}
Completion: ${x}

Installation Summary:
âœ“ Fiber optic installed & terminated
âœ“ ONU configured & activated${se?`
âœ“ Service: ${se}`:""}
âœ“ Signal testing completed
âœ“ Speed test passed
âœ“ Customer demo & acceptance completed

Status: "${V}" â†’ "Completed"

Instalasi telah selesai dengan sukses. Layanan internet sudah aktif dan customer telah menerima demo penggunaan. Ticket ditutup.`:ne==="maintenance"?`âœ… MAINTENANCE SELESAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}
Completion: ${x}

Resolution Summary:
âœ“ Problem identified & resolved
âœ“ Signal strength restored to normal
âœ“ Service testing completed
âœ“ Connectivity stable
âœ“ Customer confirmation received

Status: "${V}" â†’ "Completed"

Masalah berhasil diselesaikan. Service kembali normal dan customer confirm satisfied. Ticket ditutup.`:ne==="upgrade"?`âœ… UPGRADE SELESAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}
Completion: ${x}

Upgrade Summary:
âœ“ Bandwidth reconfigured${se?`
âœ“ New package: ${se}`:""}
âœ“ Speed test passed
âœ“ Billing system synced
âœ“ Customer notified

Status: "${V}" â†’ "Completed"

Upgrade service berhasil diselesaikan. Package baru sudah aktif dan speed sesuai target. Ticket ditutup.`:`âœ… PEKERJAAN SELESAI

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}
Tipe: ${q}
Completion: ${x}

Status: "${V}" â†’ "Completed"

${q} untuk ${p} telah selesai dikerjakan dengan baik. Semua pekerjaan telah diselesaikan sesuai SLA. Ticket ditutup.`}return ue==="on_hold"?`â¸ï¸ PEKERJAAN DITUNDA

Teknisi: ${W}${O?` (${O})`:""}
Customer: ${p}${f?` (${f})`:""}
Tipe: ${q}

Status: "${V}" â†’ "On Hold"

Pekerjaan ${q} ditunda sementara. Menunggu:
- Informasi tambahan dari customer, atau
- Material/equipment yang diperlukan, atau
- Konfirmasi dari dispatcher/management

Pekerjaan akan dilanjutkan setelah requirement terpenuhi. Ticket tetap di-monitor.`:ue==="cancelled"?`âŒ TICKET DIBATALKAN

Tiket: ${q} (${me})
Customer: ${p}${f?` (${f})`:""}
Cancelled: ${te(new Date)}

Status: "${V}" â†’ "Cancelled"

Tiket dibatalkan karena:
- Request dari customer, atau
- Tidak feasible secara teknis, atau
- Duplicate ticket, atau
- Alasan lainnya

Mohon hubungi dispatcher untuk informasi lebih lanjut jika diperlukan.`:ue==="open"?`ðŸ“‹ TICKET DIBUKA KEMBALI

Tiket: ${q} (${me})
Customer: ${p}${f?` (${f})`:""}${ce?`
Lokasi: ${ce}`:""}

Status: "${V}" â†’ "Open"

Tiket dibuka kembali dan menunggu assignment ke teknisi. Perlu tindak lanjut segera.
SLA Deadline: ${je()}`:`ðŸ“ STATUS UPDATE

Tiket: ${q} (${me})
Customer: ${p}${f?` (${f})`:""}

Status berubah: "${V}" â†’ "${ue}"

${W?`Teknisi: ${W}${O?` (${O})`:""}
`:""}Update pada: ${te(new Date)}`},I=()=>{if(t.resolution_notes&&t.resolution_notes.trim())return t.resolution_notes;if(N!=="completed")return;const p=(a.type||"general").toLowerCase(),f=a.customer_name||"Customer",X=a.package_name||"",q=a.bandwidth_down||a.bandwidth_up||"";switch(a.technician_name,p){case"installation":return`Installation untuk ${f} telah selesai dengan sukses. Fiber optic telah terpasang dengan baik dan signal quality dalam kondisi optimal. ONU telah dikonfigurasi${X?` untuk package ${X}`:""}${q?` dengan bandwidth ${q} Mbps`:""}. Speed test menunjukkan hasil sesuai spesifikasi. Customer telah menerima perangkat dalam kondisi baik, menerima demo penggunaan layanan, dan menandatangani berita acara serah terima. Layanan internet sudah aktif dan berjalan normal. Tidak ada issue yang ditemukan. Ticket ditutup dengan status completed.`;case"maintenance":case"troubleshooting":return`Issue pada layanan ${f} berhasil diselesaikan. Root cause telah diidentifikasi dan diperbaiki. Signal strength telah kembali normal dan koneksi stabil. Testing dilakukan untuk memastikan tidak ada packet loss atau latency berlebih. Service telah berjalan dengan baik dan customer confirm bahwa masalah sudah teratasi. Pekerjaan maintenance selesai tanpa kendala. Ticket ditutup dengan status resolved.`;case"upgrade":return`Upgrade package untuk ${f} berhasil diselesaikan.${X?` New package ${X}`:" Package baru"}${q?` dengan bandwidth ${q} Mbps`:""} telah aktif dan berjalan normal. Rekonfigurasi bandwidth dilakukan di ONU dan core network. Speed test menunjukkan hasil sesuai dengan package baru. Billing system telah disinkronisasi dengan perubahan package. Customer telah diberitahu tentang perubahan layanan dan menerima konfirmasi aktivasi. Ticket ditutup dengan status completed.`;case"downgrade":return`Downgrade package untuk ${f} berhasil diproses.${X?` New package ${X}`:" Package baru"}${q?` dengan bandwidth ${q} Mbps`:""} telah aktif. Adjustment bandwidth dilakukan sesuai permintaan customer. Service plan telah diupdate di system dan billing. Layanan berjalan normal dengan konfigurasi baru. Customer confirm perubahan package sesuai dengan yang diinginkan. Ticket ditutup dengan status completed.`;case"relocation":return`Relokasi layanan untuk ${f} telah selesai. Perangkat telah dipindahkan ke lokasi baru dengan sukses. Fiber optic di-routing ulang dan koneksi telah di-establish dengan baik. Signal quality optimal di lokasi baru. Testing dilakukan dan semua berjalan normal. Customer confirm layanan sudah aktif di lokasi baru dan berfungsi dengan baik. Ticket ditutup dengan status completed.`;default:return`Ticket ${a.type_name||p} untuk ${f} telah diselesaikan dengan baik. Semua pekerjaan yang diperlukan telah dikerjakan sesuai SLA. Testing telah dilakukan dan hasilnya memuaskan. Customer confirm satisfied dengan hasil pekerjaan. Tidak ada outstanding issue. Ticket ditutup dengan status completed.`}},j={status:N,notes:h(),work_notes:t.work_notes||void 0,resolution_notes:I(),customer_rating:t.customer_rating||void 0,customer_feedback:t.customer_feedback||void 0};if(N==="assigned"&&_&&(j.assigned_technician_id=parseInt(_,10),console.log("=== FRONTEND: Sending technician assignment ==="),console.log("Selected Technician:",_),console.log("Parsed Technician ID:",j.assigned_technician_id),console.log("Ticket Current Status:",a.status),console.log("New Status:",N)),console.log("=== FRONTEND: Final Update Data ==="),console.log(JSON.stringify(j,null,2)),N==="completed"){console.log("ðŸ”„ [SUBMIT] Converting files to base64...");const p=D?yield Ne(D):null,f=$?yield Ne($):null,X=B?yield Ne(B):null;console.log("ðŸ”„ [SUBMIT] Files converted:",{otdr:p?"OK":"None",attenuation:f?"OK":"None",modemSn:X?"OK":"None"});const q=c==null?void 0:c.find(me=>me.name===t.odp_location);j.completion_data={odp_location:t.odp_location,odp_id:(q==null?void 0:q.id)||null,odp_distance:t.odp_distance,otdr_photo:p?{filename:D.name,data:p}:null,final_attenuation:t.final_attenuation,attenuation_photo:f?{filename:$.name,data:f}:null,wifi_name:t.wifi_name,wifi_password:t.wifi_password,activation_date:t.activation_date,modem_sn_photo:X?{filename:B.name,data:X}:null,repair_date:t.repair_date,new_category:t.new_category,new_package:t.new_package,upgrade_notes:t.upgrade_notes,downgrade_notes:t.downgrade_notes},console.log("=== FILE UPLOADS ==="),D&&console.log("OTDR Photo:",D.name,D.size,"bytes"),$&&console.log("Attenuation Photo:",$.name,$.size,"bytes"),B&&console.log("Modem SN Photo:",B.name,B.size,"bytes")}yield l(j),Z()}),pe=he.length>1;return a.status==="completed"?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Status"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ticket Completed"}),e.jsx("p",{className:"text-gray-600",children:"This ticket has been marked as completed and cannot be modified."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Completed on: ",new Date(a.completed_at).toLocaleString()]})]})})]}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Status"})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:J(qe),className:"space-y-6",children:[pe&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"New Status"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:he.map(t=>{const h=t.icon,I=N===t.value,j=a.status===t.value;return e.jsxs("label",{className:`
                        relative flex cursor-pointer rounded-lg border p-4 focus:outline-none transition-colors
                        ${I?`border-current ${t.color} ${t.bgColor}`:j?"border-gray-400 bg-gray-50":"border-gray-300 bg-white hover:bg-gray-50"}
                        ${j?"opacity-75":""}
                      `,children:[e.jsx("input",{type:"radio",value:t.value,checked:N===t.value,onChange:p=>M(p.target.value),className:"sr-only",disabled:j}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:`h-5 w-5 mr-3 ${I?t.color:"text-gray-400"}`}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:`font-medium ${I?t.color:"text-gray-900"}`,children:[t.label,j&&e.jsx("span",{className:"ml-2 text-xs",children:"(Current)"})]}),e.jsx("div",{className:"text-gray-500",children:t.description})]})]})}),I&&!j&&e.jsx("div",{className:`flex-shrink-0 ${t.color}`,children:e.jsx(oe,{className:"h-5 w-5"})})]},t.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Status Update Notes"}),e.jsx("textarea",v({rows:3,className:"form-input",placeholder:"Optional: Add custom notes (leave empty to auto-generate detailed message)..."},b("notes")))]}),((m==null?void 0:m.role)==="technician"||(m==null?void 0:m.role)==="admin")&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Work Notes"}),e.jsx("textarea",v({rows:3,className:"form-input",placeholder:"Technical details about work performed..."},b("work_notes")))]}),N==="assigned"&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:a.status==="open"?"Assign to Technician *":"Re-assign to Technician (optional)"}),e.jsxs("select",{className:`form-input ${a.status==="open"&&!_?"border-red-500":""}`,value:_,onChange:t=>K(t.target.value),disabled:Ce,children:[e.jsx("option",{value:"",children:a.assigned_technician_id?"Keep current technician":"Select a technician..."}),(Ae=(be=de==null?void 0:de.data)==null?void 0:be.technicians)==null?void 0:Ae.map(t=>e.jsxs("option",{value:t.id,children:[t.full_name||t.user_full_name," (",t.employee_id||t.employee_code,") - ",t.skill_level]},t.id))]}),a.status==="open"&&!_&&e.jsx("p",{className:"form-error",children:"Technician selection is required for first assignment"})]}),N==="completed"&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Resolution Notes"}),e.jsx("textarea",v({rows:3,className:"form-input",placeholder:"Optional: Add custom resolution notes (leave empty to auto-generate summary)..."},b("resolution_notes")))]}),N==="completed"&&e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Completion Details"}),a.type==="installation"&&e.jsxs("div",{className:"space-y-4 bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Installation Completion Fields"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Lokasi ODP *"}),e.jsxs("select",G(v({className:`form-input ${s.odp_location?"border-red-500":""}`},b("odp_location",{required:"Lokasi ODP is required"})),{disabled:T,children:[e.jsx("option",{value:"",children:T?"Loading ODP data...":z?"Error loading ODP":!c||c.length===0?"No active ODP available":"Pilih ODP..."}),c==null?void 0:c.map(t=>e.jsxs("option",{value:t.name,children:[t.name," - ",t.location]},t.id))]})),T&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"â³ Loading ODP list..."}),z&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["âš ï¸ Error: ",z.message||"Failed to load ODP data"]}),!T&&!z&&(c==null?void 0:c.length)===0&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"âš ï¸ No active ODP found. Please add ODP in Master Data first."}),s.odp_location&&e.jsx("p",{className:"form-error",children:s.odp_location.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Jarak ODP (meter) *"}),e.jsx("input",v({type:"number",className:`form-input ${s.odp_distance?"border-red-500":""}`},b("odp_distance",{required:"Jarak ODP is required"}))),s.odp_distance&&e.jsx("p",{className:"form-error",children:s.odp_distance.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Redaman Terakhir (dB) *"}),e.jsx("input",v({type:"number",step:"0.01",className:`form-input ${s.final_attenuation?"border-red-500":""}`},b("final_attenuation",{required:"Redaman Terakhir is required"}))),s.final_attenuation&&e.jsx("p",{className:"form-error",children:s.final_attenuation.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Nama WiFi *"}),e.jsx("input",v({type:"text",className:`form-input ${s.wifi_name?"border-red-500":""}`},b("wifi_name",{required:"Nama WiFi is required"}))),s.wifi_name&&e.jsx("p",{className:"form-error",children:s.wifi_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Password WiFi *"}),e.jsx("input",v({type:"text",className:`form-input ${s.wifi_password?"border-red-500":""}`},b("wifi_password",{required:"Password WiFi is required"}))),s.wifi_password&&e.jsx("p",{className:"form-error",children:s.wifi_password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Tanggal Aktif *"}),e.jsx("input",v({type:"datetime-local",className:`form-input ${s.activation_date?"border-red-500":""}`},b("activation_date",{required:"Tanggal Aktif is required"}))),s.activation_date&&e.jsx("p",{className:"form-error",children:s.activation_date.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"form-label",children:"Foto OTDR *"}),e.jsx("input",{type:"file",id:"otdr-photo-input",accept:"image/*",className:"hidden",ref:b("otdr_photo").ref,name:"otdr_photo",onChange:t=>{var I;const h=(I=t.target.files)==null?void 0:I[0];if(console.log("ðŸ“ OTDR Photo selected:",h==null?void 0:h.name),h){ee(h);const j=new FileReader;j.onloadend=()=>{console.log("âœ… OTDR Preview generated"),H(j.result)},j.readAsDataURL(h),r("otdr_photo",t.target.files)}}}),E?e.jsxs("div",{className:"border-2 border-green-500 bg-green-50 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:E,alt:"OTDR Preview",className:"w-full h-48 object-cover"}),e.jsx("button",{type:"button",onClick:()=>window.open(E,"_blank"),className:"absolute top-2 right-2 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 transition-colors",title:"Preview full size",children:e.jsxs("svg",{className:"h-5 w-5 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),e.jsxs("div",{className:"p-3 bg-white border-t-2 border-green-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-sm font-semibold text-green-700 truncate",title:D==null?void 0:D.name,children:D==null?void 0:D.name})]}),e.jsx("button",{type:"button",onClick:()=>{r("otdr_photo",null),H(null),ee(null)},className:"ml-2 text-red-600 hover:text-red-700 flex-shrink-0",title:"Remove file",children:e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Size: ",((D==null?void 0:D.size)/1024).toFixed(1)," KB"]})]})]}):e.jsxs("button",{type:"button",onClick:()=>{console.log("ðŸŽ¯ Triggering OTDR file picker..."),document.getElementById("otdr-photo-input").click()},className:`w-full flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed rounded-lg transition-all ${s.otdr_photo?"border-red-500 bg-red-50 hover:bg-red-100":"border-gray-300 bg-gray-50 hover:bg-gray-100 hover:border-blue-500"}`,children:[e.jsx($e,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Klik untuk pilih Foto OTDR"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"form-label",children:"Foto Redaman Terakhir *"}),e.jsx("input",{type:"file",id:"attenuation-photo-input",accept:"image/*",className:"hidden",ref:b("attenuation_photo").ref,name:"attenuation_photo",onChange:t=>{var I;const h=(I=t.target.files)==null?void 0:I[0];if(console.log("ðŸ“ Attenuation Photo selected:",h==null?void 0:h.name),h){ve(h);const j=new FileReader;j.onloadend=()=>{console.log("âœ… Attenuation Preview generated"),w(j.result)},j.readAsDataURL(h),r("attenuation_photo",t.target.files)}}}),d?e.jsxs("div",{className:"border-2 border-green-500 bg-green-50 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:d,alt:"Attenuation Preview",className:"w-full h-48 object-cover"}),e.jsx("button",{type:"button",onClick:()=>window.open(d,"_blank"),className:"absolute top-2 right-2 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 transition-colors",title:"Preview full size",children:e.jsxs("svg",{className:"h-5 w-5 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),e.jsxs("div",{className:"p-3 bg-white border-t-2 border-green-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-sm font-semibold text-green-700 truncate",title:$==null?void 0:$.name,children:$==null?void 0:$.name})]}),e.jsx("button",{type:"button",onClick:()=>{r("attenuation_photo",null),w(null),ve(null)},className:"ml-2 text-red-600 hover:text-red-700 flex-shrink-0",title:"Remove file",children:e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Size: ",(($==null?void 0:$.size)/1024).toFixed(1)," KB"]})]})]}):e.jsxs("button",{type:"button",onClick:()=>{console.log("ðŸŽ¯ Triggering Attenuation file picker..."),document.getElementById("attenuation-photo-input").click()},className:`w-full flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed rounded-lg transition-all ${s.attenuation_photo?"border-red-500 bg-red-50 hover:bg-red-100":"border-gray-300 bg-gray-50 hover:bg-gray-100 hover:border-blue-500"}`,children:[e.jsx($e,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Klik untuk pilih Foto Redaman"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"form-label",children:"Foto SN Modem *"}),e.jsx("input",{type:"file",id:"modem-sn-photo-input",accept:"image/*",className:"hidden",ref:b("modem_sn_photo").ref,name:"modem_sn_photo",onChange:t=>{var I;const h=(I=t.target.files)==null?void 0:I[0];if(console.log("ðŸ“ Modem SN Photo selected:",h==null?void 0:h.name),h){_e(h);const j=new FileReader;j.onloadend=()=>{console.log("âœ… Modem SN Preview generated"),P(j.result)},j.readAsDataURL(h),r("modem_sn_photo",t.target.files)}}}),k?e.jsxs("div",{className:"border-2 border-green-500 bg-green-50 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:k,alt:"Modem SN Preview",className:"w-full h-48 object-cover"}),e.jsx("button",{type:"button",onClick:()=>window.open(k,"_blank"),className:"absolute top-2 right-2 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 transition-colors",title:"Preview full size",children:e.jsxs("svg",{className:"h-5 w-5 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),e.jsxs("div",{className:"p-3 bg-white border-t-2 border-green-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-sm font-semibold text-green-700 truncate",title:B==null?void 0:B.name,children:B==null?void 0:B.name})]}),e.jsx("button",{type:"button",onClick:()=>{r("modem_sn_photo",null),P(null),_e(null)},className:"ml-2 text-red-600 hover:text-red-700 flex-shrink-0",title:"Remove file",children:e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Size: ",((B==null?void 0:B.size)/1024).toFixed(1)," KB"]})]})]}):e.jsxs("button",{type:"button",onClick:()=>{console.log("ðŸŽ¯ Triggering Modem SN file picker..."),document.getElementById("modem-sn-photo-input").click()},className:`w-full flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed rounded-lg transition-all ${s.modem_sn_photo?"border-red-500 bg-red-50 hover:bg-red-100":"border-gray-300 bg-gray-50 hover:bg-gray-100 hover:border-blue-500"}`,children:[e.jsx($e,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Klik untuk pilih Foto SN Modem"})]})]})]})]}),(a.type==="repair"||a.type==="maintenance")&&e.jsxs("div",{className:"space-y-4 bg-orange-50 p-4 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium text-orange-900",children:[a.type==="repair"?"Repair":"Maintenance"," Completion Fields"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Lokasi ODP *"}),e.jsxs("select",G(v({className:`form-input ${s.odp_location?"border-red-500":""}`},b("odp_location",{required:"Lokasi ODP is required"})),{disabled:T,children:[e.jsx("option",{value:"",children:T?"Loading ODP data...":z?"Error loading ODP":!c||c.length===0?"No active ODP available":"Pilih ODP..."}),c==null?void 0:c.map(t=>e.jsxs("option",{value:t.name,children:[t.name," - ",t.location]},t.id))]})),T&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"â³ Loading ODP list..."}),z&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["âš ï¸ Error: ",z.message||"Failed to load ODP data"]}),!T&&!z&&(c==null?void 0:c.length)===0&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"âš ï¸ No active ODP found. Please add ODP in Master Data first."}),s.odp_location&&e.jsx("p",{className:"form-error",children:s.odp_location.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Redaman Terakhir (dB) *"}),e.jsx("input",v({type:"number",step:"0.01",className:`form-input ${s.final_attenuation?"border-red-500":""}`},b("final_attenuation",{required:"Redaman Terakhir is required"}))),s.final_attenuation&&e.jsx("p",{className:"form-error",children:s.final_attenuation.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Foto Redaman Terakhir (Optional)"}),e.jsx("input",{type:"file",id:"maintenance-attenuation-photo-input",accept:"image/*",className:"hidden",ref:b("attenuation_photo").ref,name:"attenuation_photo",onChange:t=>{var I;const h=(I=t.target.files)==null?void 0:I[0];if(console.log("ðŸ“ Maintenance Attenuation Photo selected:",h==null?void 0:h.name),h){ve(h);const j=new FileReader;j.onloadend=()=>{console.log("âœ… Maintenance Attenuation Preview generated"),w(j.result)},j.readAsDataURL(h),r("attenuation_photo",t.target.files)}}}),d?e.jsxs("div",{className:"border-2 border-green-500 bg-green-50 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:d,alt:"Attenuation Preview",className:"w-full h-48 object-cover"}),e.jsx("button",{type:"button",onClick:()=>window.open(d,"_blank"),className:"absolute top-2 right-2 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 transition-colors",title:"Preview full size",children:e.jsxs("svg",{className:"h-5 w-5 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),e.jsxs("div",{className:"p-3 bg-white border-t-2 border-green-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("svg",{className:"h-5 w-5 text-green-600 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("p",{className:"text-sm font-semibold text-green-700 truncate",title:$==null?void 0:$.name,children:$==null?void 0:$.name})]}),e.jsx("button",{type:"button",onClick:()=>{r("attenuation_photo",null),w(null),ve(null)},className:"ml-2 text-red-600 hover:text-red-700 flex-shrink-0",title:"Remove file",children:e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Size: ",(($==null?void 0:$.size)/1024).toFixed(1)," KB"]})]})]}):e.jsxs("button",{type:"button",onClick:()=>{console.log("ðŸŽ¯ Triggering Maintenance Attenuation file picker..."),document.getElementById("maintenance-attenuation-photo-input").click()},className:"w-full flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed rounded-lg transition-all border-gray-300 bg-gray-50 hover:bg-gray-100 hover:border-orange-500",children:[e.jsx($e,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Klik untuk pilih Foto Redaman (Optional)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Nama WiFi"}),e.jsx("input",v({type:"text",className:"form-input"},b("wifi_name")))]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Password WiFi"}),e.jsx("input",v({type:"text",className:"form-input"},b("wifi_password")))]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Tanggal Perbaikan *"}),e.jsx("input",v({type:"datetime-local",className:`form-input ${s.repair_date?"border-red-500":""}`},b("repair_date",{required:"Tanggal Perbaikan is required"}))),s.repair_date&&e.jsx("p",{className:"form-error",children:s.repair_date.message})]})]})]}),a.type==="upgrade"&&e.jsxs("div",{className:"space-y-4 bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Upgrade Completion Fields"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Paket Baru *"}),e.jsxs("select",G(v({className:`form-input ${s.new_package?"border-red-500":""}`},b("new_package",{required:"Paket baru is required"})),{disabled:u,children:[e.jsx("option",{value:"",children:u?"Loading packages...":"Pilih Paket Baru..."}),Q==null?void 0:Q.map(t=>{var h;return e.jsxs("option",{value:t.name||t.package_name,children:[t.name||t.package_name," - ",t.speed_mbps||t.speed," Mbps - Rp ",(h=t.price||t.monthly_price)==null?void 0:h.toLocaleString("id-ID")]},t.id)})]})),g&&e.jsxs("p",{className:"form-error",children:["Error loading packages: ",g.message]}),!u&&Q&&Q.length===0&&e.jsx("p",{className:"text-xs text-amber-600",children:"No active packages available"}),s.new_package&&e.jsx("p",{className:"form-error",children:s.new_package.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Catatan Upgrade"}),e.jsx("input",v({type:"text",className:"form-input",placeholder:"e.g., Dari 100 Mbps ke 200 Mbps"},b("upgrade_notes")))]})]})]}),a.type==="downgrade"&&e.jsxs("div",{className:"space-y-4 bg-amber-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"Downgrade Completion Fields"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Paket Baru *"}),e.jsxs("select",G(v({className:`form-input ${s.new_package?"border-red-500":""}`},b("new_package",{required:"Paket baru is required"})),{disabled:u,children:[e.jsx("option",{value:"",children:u?"Loading packages...":"Pilih Paket Baru..."}),Q==null?void 0:Q.map(t=>{var h;return e.jsxs("option",{value:t.name||t.package_name,children:[t.name||t.package_name," - ",t.speed_mbps||t.speed," Mbps - Rp ",(h=t.price||t.monthly_price)==null?void 0:h.toLocaleString("id-ID")]},t.id)})]})),g&&e.jsxs("p",{className:"form-error",children:["Error loading packages: ",g.message]}),!u&&Q&&Q.length===0&&e.jsx("p",{className:"text-xs text-amber-600",children:"No active packages available"}),s.new_package&&e.jsx("p",{className:"form-error",children:s.new_package.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Catatan Downgrade"}),e.jsx("input",v({type:"text",className:"form-input",placeholder:"e.g., Dari 200 Mbps ke 100 Mbps"},b("downgrade_notes")))]})]})]}),a.type==="wifi_setup"&&e.jsxs("div",{className:"space-y-4 bg-purple-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-purple-900",children:"WiFi Setup Completion Fields"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Nama WiFi *"}),e.jsx("input",v({type:"text",className:`form-input ${s.wifi_name?"border-red-500":""}`},b("wifi_name",{required:"Nama WiFi is required"}))),s.wifi_name&&e.jsx("p",{className:"form-error",children:s.wifi_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Password WiFi *"}),e.jsx("input",v({type:"text",className:`form-input ${s.wifi_password?"border-red-500":""}`},b("wifi_password",{required:"Password WiFi is required"}))),s.wifi_password&&e.jsx("p",{className:"form-error",children:s.wifi_password.message})]})]})]})]}),N==="completed"&&(m==null?void 0:m.role)!=="technician"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Customer Rating"}),e.jsxs("select",G(v({className:"form-input"},b("customer_rating")),{children:[e.jsx("option",{value:"",children:"No rating"}),e.jsx("option",{value:"5",children:"â­â­â­â­â­ Excellent"}),e.jsx("option",{value:"4",children:"â­â­â­â­ Good"}),e.jsx("option",{value:"3",children:"â­â­â­ Average"}),e.jsx("option",{value:"2",children:"â­â­ Poor"}),e.jsx("option",{value:"1",children:"â­ Very Poor"})]}))]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Customer Feedback"}),e.jsx("textarea",v({rows:2,className:"form-input",placeholder:"Customer comments about the service..."},b("customer_feedback")))]})]}),e.jsx("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:e.jsx("button",{type:"submit",disabled:i||!pe&&N===a.status,className:"btn-primary",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Be,{size:"sm",className:"mr-2"}),"Updating..."]}):"Update Status"})})]})})]})},Js=({team:a=[],leadId:l})=>{var S;if(!a||a.length===0)return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx(re,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Belum ada teknisi assigned"})]});const i=[...a].sort((m,N)=>{const M={lead:1,member:2,support:3};return(M[m.role]||99)-(M[N.role]||99)}),y=m=>{const N={lead:{bg:"bg-yellow-100",text:"text-yellow-800",icon:Se,label:"LEAD"},member:{bg:"bg-blue-100",text:"text-blue-800",icon:re,label:"MEMBER"},support:{bg:"bg-purple-100",text:"text-purple-800",icon:re,label:"SUPPORT"}};return N[m]||N.member};return e.jsxs("div",{className:"space-y-3",children:[i.map((m,N)=>{const M=y(m.role),_=M.icon,K=m.role==="lead";return e.jsx("div",{className:`border rounded-lg p-4 ${K?"border-yellow-300 bg-yellow-50":"border-gray-200 bg-white"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${K?"bg-yellow-200":"bg-blue-100"}`,children:e.jsx(_,{className:`h-6 w-6 ${K?"text-yellow-700":"text-blue-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:m.full_name}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${M.bg} ${M.text}`,children:[K&&e.jsx(Se,{className:"h-3 w-3 mr-1 fill-current"}),M.label]})]}),m.specialization&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2 flex items-center",children:[e.jsx(Briefcase,{className:"h-3 w-3 mr-1"}),m.specialization]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm",children:[m.phone&&e.jsxs("a",{href:`https://wa.me/${m.phone.replace(/^0/,"62")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-green-600 hover:text-green-700",children:[e.jsx(Ms,{className:"h-3 w-3 mr-1"}),m.phone]}),m.email&&e.jsxs("a",{href:`mailto:${m.email}`,className:"flex items-center text-blue-600 hover:text-blue-700",children:[e.jsx(Es,{className:"h-3 w-3 mr-1"}),m.email]})]}),m.assigned_at&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Assigned: ",new Date(m.assigned_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),m.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2 italic",children:["ðŸ“ ",m.notes]})]})]})})},m.id||N)}),a.length>1&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"ðŸ‘¥ Tim:"})," ",a.length," teknisi â€¢"," ",e.jsx("strong",{children:"Lead:"})," ",((S=a.find(m=>m.role==="lead"))==null?void 0:S.full_name)||"TBA"]})})]})},Hs=()=>{var z,Q;const{id:a}=bs(),{user:l}=Je(),i=Ue(),[y,S]=A.useState("details"),[m,N]=A.useState(null),{data:M,isLoading:_,error:K}=ge(["ticket",a],()=>le.getTicket(a),{enabled:!!a}),{data:b}=ge(["my-technician-profile",l==null?void 0:l.id],()=>F(void 0,null,function*(){var E,H;if((l==null?void 0:l.role)!=="technician")return null;const g=yield(yield fetch(`/api/technicians?user_id=${l.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();return((H=(E=g==null?void 0:g.data)==null?void 0:E.technicians)==null?void 0:H[0])||null}),{enabled:!!l&&l.role==="technician",staleTime:3e5}),J=Re(u=>le.updateTicketStatus(a,u),{onSuccess:()=>{i.invalidateQueries(["ticket",a]),i.invalidateQueries(["tickets"]),L.success("Ticket status updated successfully!")},onError:u=>{var g,E;L.error(((E=(g=u.response)==null?void 0:g.data)==null?void 0:E.message)||"Failed to update ticket status")}}),s=(z=M==null?void 0:M.data)==null?void 0:z.ticket,Z=u=>{const g={open:{class:"badge-info",label:"Open",icon:xe},assigned:{class:"badge-warning",label:"Assigned",icon:re},in_progress:{class:"badge-warning",label:"In Progress",icon:xe},completed:{class:"badge-success",label:"Completed",icon:oe},cancelled:{class:"badge-gray",label:"Cancelled",icon:Ke},on_hold:{class:"badge-gray",label:"On Hold",icon:xe}},E=g[u]||g.open,H=E.icon;return e.jsxs("span",{className:`badge ${E.class} inline-flex items-center`,children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),E.label]})},ae=u=>{const g={low:{class:"badge-gray",label:"Low"},normal:{class:"badge-info",label:"Normal"},high:{class:"badge-warning",label:"High"},critical:{class:"badge-danger",label:"Critical"}},E=g[u]||g.normal;return e.jsx("span",{className:`badge ${E.class}`,children:E.label})},r=u=>u?new Date(u).toLocaleString():"Not set",c=(u,g)=>{if(!u||!g)return null;const E=new Date(u),d=new Date(g)-E,w=Math.floor(d/(1e3*60*60)),k=Math.floor(d%(1e3*60*60)/(1e3*60));return`${w}h ${k}m`};if(_)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Be,{size:"lg"})});if(K||!s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(is,{to:"/tickets",label:"Back to Tickets"})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center py-12",children:[e.jsx(Ke,{className:"h-12 w-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ticket Not Found"}),e.jsx("p",{className:"text-gray-500",children:"The ticket you're looking for doesn't exist or you don't have permission to view it."})]})})]});const T=[{id:"details",label:"Details",icon:Ee},{id:"status",label:"Update Status",icon:xe},{id:"history",label:"History",icon:We}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(is,{to:"/tickets",label:"Back to Tickets"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Qe,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"px-3 py-1 bg-blue-50 text-blue-700 rounded-lg text-lg font-mono font-semibold border border-blue-200",children:s.ticket_number})]}),e.jsx("p",{className:"text-gray-600",children:s.title})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[Z(s.status),ae(s.priority)]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.customer_numeric_id&&e.jsx(Ye,{to:`/customers/${s.customer_numeric_id}`,className:"card hover:shadow-lg transition-shadow cursor-pointer",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-8 w-8 text-blue-600 bg-blue-100 rounded-lg p-2 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Customer"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.customer_name}),s.customer_code&&e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:s.customer_code})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(xe,{className:"h-8 w-8 text-green-600 bg-green-100 rounded-lg p-2 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Created"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:new Date(s.created_at).toLocaleDateString()})]})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(We,{className:"h-8 w-8 text-orange-600 bg-orange-100 rounded-lg p-2 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"SLA Due"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.sla_due_date?new Date(s.sla_due_date).toLocaleDateString():"Not set"})]})]})})}),s.team&&s.team.length>0||s.assigned_technician_id?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-8 w-8 text-purple-600 bg-purple-100 rounded-lg p-2 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.team&&s.team.length>1?"Technician Team":"Technician"}),s.team&&s.team.length>1&&e.jsxs("p",{className:"text-xs text-gray-500",children:[s.team.length," teknisi assigned"]})]})]})}),s.team&&s.team.length>0?e.jsx(Js,{team:s.team,leadId:s.assigned_technician_id}):e.jsxs(Ye,{to:`/technicians/${s.assigned_technician_id}`,className:"hover:bg-gray-50 p-2 rounded block",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.technician_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.employee_id})]})]})}):e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-8 w-8 text-purple-600 bg-purple-100 rounded-lg p-2 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Technician"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Unassigned"})]})]})})})]}),!["completed","cancelled"].includes(s.status)&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quick Actions:"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.status==="open"&&(l==null?void 0:l.role)==="technician"&&b&&e.jsxs("button",{onClick:()=>F(void 0,null,function*(){var u,g;try{yield le.assignTicket(a,b.id),L.success("Ticket assigned to you successfully!"),i.invalidateQueries(["ticket",a]),i.invalidateQueries(["tickets"])}catch(E){L.error(((g=(u=E.response)==null?void 0:u.data)==null?void 0:g.message)||"Failed to assign ticket")}}),disabled:J.isLoading,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 text-sm font-medium inline-flex items-center gap-2 transition-colors",children:[e.jsx(re,{className:"h-4 w-4"}),"Assign to Me"]}),s.status==="assigned"&&e.jsxs("button",{onClick:()=>{J.mutate({status:"in_progress",notes:"Started working on ticket"})},disabled:J.isLoading,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 text-sm font-medium inline-flex items-center gap-2 transition-colors",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Start Progress"]}),s.status==="in_progress"&&e.jsxs("button",{onClick:()=>{N("completed"),S("status"),window.scrollTo({top:0,behavior:"smooth"})},disabled:J.isLoading,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 text-sm font-medium inline-flex items-center gap-2 transition-colors",children:[e.jsx(oe,{className:"h-4 w-4"}),"Complete Ticket"]}),["open","assigned","in_progress"].includes(s.status)&&e.jsxs("button",{onClick:()=>{J.mutate({status:"on_hold",notes:"Put on hold via quick action"})},disabled:J.isLoading,className:"px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:bg-gray-400 text-sm font-medium inline-flex items-center gap-2 transition-colors",children:[e.jsx(xe,{className:"h-4 w-4"}),"Put On Hold"]}),s.status!=="cancelled"&&e.jsxs("button",{onClick:()=>{window.confirm("Are you sure you want to cancel this ticket?")&&J.mutate({status:"cancelled",notes:"Cancelled via quick action"})},disabled:J.isLoading,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 text-sm font-medium inline-flex items-center gap-2 transition-colors",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Cancel"]})]})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:T.map(u=>{const g=u.icon;return e.jsxs("button",{onClick:()=>S(u.id),className:`
                  flex items-center py-2 px-1 border-b-2 font-medium text-sm
                  ${y===u.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),u.label]},u.id)})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[y==="details"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ticket Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Type"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.service_type_name||s.type})]}),(s.category_name||s.category)&&s.category!=="Not specified"&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Category"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.category_name||s.category})]}),s.scheduled_date&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Scheduled Date"}),e.jsx("dd",{className:"text-sm text-gray-900",children:r(s.scheduled_date)})]}),s.estimated_duration&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Estimated Duration"}),e.jsxs("dd",{className:"text-sm text-gray-900",children:[s.estimated_duration," minutes"]})]}),s.started_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Started At"}),e.jsx("dd",{className:"text-sm text-gray-900",children:r(s.started_at)})]}),s.completed_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Completed At"}),e.jsx("dd",{className:"text-sm text-gray-900",children:r(s.completed_at)})]}),s.started_at&&s.completed_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Actual Duration"}),e.jsx("dd",{className:"text-sm text-gray-900",children:c(s.started_at,s.completed_at)})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Description"})}),e.jsx("div",{className:"card-body",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap leading-relaxed",children:s.description})})]}),s.work_notes&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Work Notes"})}),e.jsx("div",{className:"card-body",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.work_notes})})]}),s.resolution_notes&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Resolution"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.resolution_notes}),s.customer_rating&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Customer Rating:"}),e.jsxs("div",{className:"flex items-center",children:["â­".repeat(s.customer_rating),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",s.customer_rating,"/5)"]})]})]}),s.customer_feedback&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Feedback:"}),e.jsxs("p",{className:"text-sm text-gray-900 italic",children:['"',s.customer_feedback,'"']})]})]})]})]}),s.completion_data&&s.status==="completed"&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Completion Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.completion_data.odp_location&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Lokasi ODP"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.completion_data.odp_location})]}),s.completion_data.odp_distance&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Jarak ODP"}),e.jsxs("dd",{className:"text-sm text-gray-900",children:[s.completion_data.odp_distance," meter"]})]}),s.completion_data.final_attenuation&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Redaman Terakhir"}),e.jsxs("dd",{className:"text-sm text-gray-900",children:[s.completion_data.final_attenuation," dB"]})]}),s.completion_data.wifi_name&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Nama WiFi"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.completion_data.wifi_name})]}),s.completion_data.wifi_password&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Password WiFi"}),e.jsx("dd",{className:"text-sm text-gray-900 font-mono",children:s.completion_data.wifi_password})]}),s.completion_data.activation_date&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Tanggal Aktif"}),e.jsx("dd",{className:"text-sm text-gray-900",children:r(s.completion_data.activation_date)})]}),s.completion_data.repair_date&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"Tanggal Perbaikan"}),e.jsx("dd",{className:"text-sm text-gray-900",children:r(s.completion_data.repair_date)})]}),s.completion_data.new_category&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-600",children:"New Category"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.completion_data.new_category})]})]}),(s.completion_data.otdr_photo||s.completion_data.attenuation_photo||s.completion_data.modem_sn_photo)&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Foto Dokumentasi"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.completion_data.otdr_photo&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Foto OTDR"}),e.jsxs("a",{href:`${"https://portal.aglis.biz.id/api".replace("/api","")}${s.completion_data.otdr_photo.url}`,target:"_blank",rel:"noopener noreferrer",className:"block border border-gray-300 rounded-lg overflow-hidden hover:border-blue-500 transition-colors",children:[e.jsx("img",{src:`${"https://portal.aglis.biz.id/api".replace("/api","")}${s.completion_data.otdr_photo.url}`,alt:"OTDR Photo",className:"w-full h-32 object-cover",onError:u=>console.error("Failed to load OTDR photo:",s.completion_data.otdr_photo.url)}),e.jsx("div",{className:"p-2 bg-gray-50",children:e.jsx("p",{className:"text-xs text-gray-600 truncate",children:s.completion_data.otdr_photo.filename})})]})]}),s.completion_data.attenuation_photo&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Foto Redaman"}),e.jsxs("a",{href:`${"https://portal.aglis.biz.id/api".replace("/api","")}${s.completion_data.attenuation_photo.url}`,target:"_blank",rel:"noopener noreferrer",className:"block border border-gray-300 rounded-lg overflow-hidden hover:border-blue-500 transition-colors",children:[e.jsx("img",{src:`${"https://portal.aglis.biz.id/api".replace("/api","")}${s.completion_data.attenuation_photo.url}`,alt:"Attenuation Photo",className:"w-full h-32 object-cover",onError:u=>console.error("Failed to load Attenuation photo:",s.completion_data.attenuation_photo.url)}),e.jsx("div",{className:"p-2 bg-gray-50",children:e.jsx("p",{className:"text-xs text-gray-600 truncate",children:s.completion_data.attenuation_photo.filename})})]})]}),s.completion_data.modem_sn_photo&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Foto SN Modem"}),e.jsxs("a",{href:`${"https://portal.aglis.biz.id/api".replace("/api","")}${s.completion_data.modem_sn_photo.url}`,target:"_blank",rel:"noopener noreferrer",className:"block border border-gray-300 rounded-lg overflow-hidden hover:border-blue-500 transition-colors",children:[e.jsx("img",{src:`${"https://portal.aglis.biz.id/api".replace("/api","")}${s.completion_data.modem_sn_photo.url}`,alt:"Modem SN Photo",className:"w-full h-32 object-cover",onError:u=>console.error("Failed to load Modem SN photo:",s.completion_data.modem_sn_photo.url)}),e.jsx("div",{className:"p-2 bg-gray-50",children:e.jsx("p",{className:"text-xs text-gray-600 truncate",children:s.completion_data.modem_sn_photo.filename})})]})]})]})]})]})]})]}),y==="status"&&e.jsx(Gs,{ticket:s,onUpdate:J.mutate,isLoading:J.isLoading,preSelectedStatus:m,onStatusPreSelected:()=>N(null)}),y==="history"&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Status History"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[((Q=s.status_history)==null?void 0:Q.length)||0," changes"]})]})}),e.jsx("div",{className:"card-body",children:s.status_history&&s.status_history.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:s.status_history.map((u,g)=>{const E={open:{icon:Ee,color:"blue",bg:"bg-blue-100",border:"border-blue-200"},assigned:{icon:re,color:"indigo",bg:"bg-indigo-100",border:"border-indigo-200"},in_progress:{icon:Ge,color:"yellow",bg:"bg-yellow-100",border:"border-yellow-200"},on_hold:{icon:xe,color:"purple",bg:"bg-purple-100",border:"border-purple-200"},completed:{icon:oe,color:"green",bg:"bg-green-100",border:"border-green-200"},cancelled:{icon:Fe,color:"red",bg:"bg-red-100",border:"border-red-200"}},H=E[u.new_status]||E.open,d=H.icon,w=s.status_history[g+1],k=w?c(u.created_at,w.created_at):null;return e.jsxs("div",{className:"relative flex items-start space-x-4",children:[e.jsx("div",{className:"relative flex-shrink-0 z-10",children:e.jsx("div",{className:`h-10 w-10 ${H.bg} rounded-full flex items-center justify-center border-2 ${H.border} shadow-sm`,children:e.jsx(d,{className:`h-5 w-5 text-${H.color}-600`})})}),e.jsxs("div",{className:"flex-1 min-w-0 bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[u.old_status&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:u.old_status.replace("_"," ")}),e.jsx("span",{className:"text-gray-400",children:"â†’"})]}),Z(u.new_status),k&&e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded",children:["Duration: ",k]})]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["#",g+1]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"font-medium",children:u.changed_by_name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:r(u.created_at)})]})]}),u.technician_name&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-blue-50 rounded border-l-2 border-blue-400",children:[e.jsx(re,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-900",children:[e.jsx("span",{className:"font-medium",children:"Assigned to:"})," ",u.technician_name,e.jsxs("span",{className:"text-xs text-blue-600 ml-1",children:["(",u.technician_employee_id,")"]})]})]}),u.notes&&e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded border-l-2 border-gray-300",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap leading-relaxed",children:u.notes})]})})]})]},u.id)})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No status history available"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Status changes will appear here"})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[s.package_name&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Package Information"})}),e.jsxs("div",{className:"card-body space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Is,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.package_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.service_type})]})]}),s.bandwidth_down&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-t border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Bandwidth"}),e.jsxs("span",{className:"text-sm font-medium",children:[e.jsxs("span",{className:"text-blue-600",children:["â†‘ ",s.bandwidth_up||s.bandwidth_down]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"/"}),e.jsxs("span",{className:"text-green-600",children:["â†“ ",s.bandwidth_down]}),e.jsx("span",{className:"text-gray-900 ml-1",children:"Mbps"})]})]}),s.monthly_price&&e.jsxs("div",{className:"flex justify-between items-center py-2 border-t border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Monthly Price"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["Rp ",parseInt(s.monthly_price).toLocaleString("id-ID")]})]})]})]}),s.equipment_needed&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Equipment Needed"})}),e.jsx("div",{className:"card-body",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:s.equipment_needed})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Attachments"})}),e.jsx("div",{className:"card-body",children:s.attachments&&s.attachments.length>0?e.jsx("div",{className:"space-y-2",children:s.attachments.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:u.original_filename})]}),e.jsx("button",{className:"text-blue-600 hover:text-blue-800",children:e.jsx(cs,{className:"h-4 w-4"})})]},u.id))}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx($e,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No attachments"})]})})]})]})]})]})},na=Object.freeze(Object.defineProperty({__proto__:null,default:Hs},Symbol.toStringTag,{value:"Module"}));export{ta as T,na as a,Qs as o,ds as t};
//# sourceMappingURL=tickets-BIuwhSVH.js.map
