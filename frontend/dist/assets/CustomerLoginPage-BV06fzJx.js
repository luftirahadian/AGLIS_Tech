var f=(h,b,n)=>new Promise((r,g)=>{var i=s=>{try{a(n.next(s))}catch(d){g(d)}},c=s=>{try{a(n.throw(s))}catch(d){g(d)}},a=s=>s.done?r(s.value):Promise.resolve(s.value).then(i,c);a((n=n.apply(h,b)).next())});import{j as e,a as y}from"./notifications-Dggueh-l.js";import{u as w,r as p}from"./react-vendor-BQ7pSkNi.js";import{n as N,p as S,aI as k,aU as P,z as x}from"./ui-vendor-CO1ReX4_.js";import"./react-query-B7OIdD7u.js";import"./charts-CREYXqqm.js";const K=()=>{const h=w(),[b,n]=p.useState("phone"),[r,g]=p.useState(""),[i,c]=p.useState(""),[a,s]=p.useState(!1),d=l=>f(void 0,null,function*(){var m,u;l.preventDefault(),s(!0),console.log("üîµ handleRequestOTP called, phone:",r);try{console.log("üîµ Sending request to /customer-portal/request-otp");const t=yield y.post("/customer-portal/request-otp",{phone:r});console.log("üîµ Full response:",t),console.log("üîµ response.success:",t.success),console.log("üîµ response.data:",t.data),t.success?(console.log("üîµ Success! Showing toast and changing step to OTP"),x.success("Kode OTP telah dikirim ke WhatsApp Anda!"),n("otp"),console.log("üîµ Step changed to: otp")):console.log("‚ùå response.success is false or undefined")}catch(t){console.error("‚ùå Error:",t),x.error(((u=(m=t.response)==null?void 0:m.data)==null?void 0:u.message)||"Gagal mengirim OTP")}finally{s(!1),console.log("üîµ Loading set to false")}}),v=l=>f(void 0,null,function*(){var m,u,t,j;l.preventDefault(),s(!0),console.log("üü¢ handleVerifyOTP called, phone:",r,"otp:",i);try{console.log("üü¢ Sending verify request");const o=yield y.post("/customer-portal/verify-otp",{phone:r,otp:i});console.log("üü¢ Verify response:",o),o.success?(console.log("üü¢ Login SUCCESS! Token:",((u=(m=o.data)==null?void 0:m.token)==null?void 0:u.substring(0,20))+"..."),localStorage.setItem("customerToken",o.data.token),localStorage.setItem("customerData",JSON.stringify(o.data.customer)),x.success("Login berhasil!"),console.log("üü¢ Navigating to /customer/dashboard"),h("/customer/dashboard")):console.log("‚ùå response.success is false")}catch(o){console.error("‚ùå Verify error:",o),x.error(((j=(t=o.response)==null?void 0:t.data)==null?void 0:j.message)||"Kode OTP salah atau expired"),c("")}finally{s(!1),console.log("üü¢ Loading set to false")}});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-600 to-green-600 rounded-2xl mb-4",children:e.jsx(N,{className:"h-10 w-10 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"AGLIS Customer Portal"}),e.jsx("p",{className:"text-gray-600",children:"Login dengan nomor WhatsApp Anda"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[b==="phone"?e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nomor WhatsApp"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"tel",value:r,onChange:l=>g(l.target.value),placeholder:"08123456789",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Gunakan nomor WhatsApp yang terdaftar sebagai customer"})]}),e.jsx("button",{type:"submit",disabled:a||!r,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-green-600 text-white rounded-lg hover:from-blue-700 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Mengirim OTP..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-5 w-5"}),e.jsx("span",{children:"Kirim Kode OTP"})]})})]}):e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-3",children:e.jsx(k,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Masukkan Kode OTP"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Kode telah dikirim ke WhatsApp ",r.replace(/(\d{4})\d+(\d{3})/,"$1****$2")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kode OTP (6 digit)"}),e.jsx("input",{type:"text",value:i,onChange:l=>c(l.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"w-full px-4 py-3 text-center text-2xl tracking-widest border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:6,autoFocus:!0,required:!0})]}),e.jsx("button",{type:"submit",disabled:a||i.length!==6,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-green-600 text-white rounded-lg hover:from-blue-700 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Memverifikasi..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-5 w-5"}),e.jsx("span",{children:"Login"})]})}),e.jsx("button",{type:"button",onClick:()=>{n("phone"),c("")},className:"w-full text-sm text-gray-600 hover:text-gray-900",children:"‚Üê Kembali ke input nomor"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:["Butuh bantuan?"," ",e.jsx("a",{href:"https://wa.me/628179380800",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Hubungi Customer Service"})]})})]}),e.jsx("div",{className:"mt-6 text-center text-sm text-gray-600",children:e.jsx("p",{children:"¬© 2025 AGLIS Net. All rights reserved."})})]})})};export{K as default};
//# sourceMappingURL=CustomerLoginPage-BV06fzJx.js.map
