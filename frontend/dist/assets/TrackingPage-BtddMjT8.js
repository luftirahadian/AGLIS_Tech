import{j as e}from"./notifications-C-A1jlty.js";import{e as I,r as h}from"./react-vendor-BQ7pSkNi.js";import{b as C}from"./react-query-B7OIdD7u.js";import{r as T}from"./registrationService-DfHnWxZz.js";import{s as d}from"./customers-Bkp7alR1.js";import{N as f,S as y,b as p,U as k,m as M,p as v,a7 as L,r as $,q as R,g as b,C as c,a as U,aR as W,ao as B}from"./ui-vendor-ng1X_mIA.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";import"./forms-Dmkgx8TD.js";const z=()=>{const{registrationNumber:j}=I(),[m,N]=h.useState(j||""),[i,w]=h.useState(j||""),{data:a,isLoading:o,error:_,refetch:x}=C(["track-registration",i],()=>T.trackStatus(i),{enabled:!!i,retry:!1,select:s=>s.data}),S=s=>{s.preventDefault(),m.trim()&&(w(m.trim()),x())};h.useEffect(()=>{if(!i||!a)return;d.connect();const s=l=>{console.log("ðŸ“¡ [TrackingPage] Registration update received:",l),(l.registration_number===i||l.registration_number===a.registration_number||l.email===i||l.email===a.email)&&(console.log("âœ… [TrackingPage] Update is for current registration, refetching..."),x())};return d.on("registration_updated",s),d.on("registration_status_changed",s),console.log("ðŸ”Œ [TrackingPage] Socket listeners setup for:",i),()=>{console.log("ðŸ”Œ [TrackingPage] Removing socket listeners"),d.off("registration_updated",s),d.off("registration_status_changed",s)}},[i,a,x]);const P=s=>{const l={pending_verification:{label:"Menunggu Verifikasi",icon:f,color:"yellow",description:"Data Anda sedang dalam proses verifikasi oleh tim kami"},verified:{label:"Terverifikasi",icon:B,color:"blue",description:"Data Anda telah diverifikasi. Menunggu jadwal survey"},survey_scheduled:{label:"Survey Dijadwalkan",icon:b,color:"indigo",description:"Survey lokasi telah dijadwalkan"},survey_completed:{label:"Survey Selesai",icon:W,color:"purple",description:"Survey lokasi telah selesai. Menunggu persetujuan"},approved:{label:"Disetujui",icon:c,color:"green",description:"Pendaftaran Anda telah disetujui! Instalasi akan segera dijadwalkan"},customer_created:{label:"Customer Telah Dibuat",icon:c,color:"green",description:"Selamat! Anda telah terdaftar sebagai customer. Instalasi akan segera dijadwalkan"},rejected:{label:"Ditolak",icon:p,color:"red",description:"Pendaftaran Anda ditolak"},cancelled:{label:"Dibatalkan",icon:p,color:"gray",description:"Pendaftaran dibatalkan"}};return l[s]||l.pending_verification},D=(s,l)=>{const n=["pending_verification","verified","survey_scheduled","survey_completed","approved","customer_created"],u=n.indexOf(s),g=n.indexOf(l);return s==="rejected"||s==="cancelled"?g<=u?"completed":"pending":g<u?"completed":g===u?"current":"pending"},r=s=>({pending_verification:{title:"Langkah Selanjutnya",items:["Tim kami akan melakukan verifikasi data (1-2 hari kerja)","Pastikan nomor WhatsApp Anda aktif","Anda akan dihubungi untuk jadwal survey lokasi"],color:"blue"},verified:{title:"Menunggu Jadwal Survey",items:["Tim akan menghubungi Anda untuk jadwal survey","Pastikan lokasi mudah diakses","Siapkan denah lokasi jika diperlukan"],color:"blue"},survey_scheduled:{title:"Persiapan Survey",items:["Pastikan ada yang bisa menerima tim survey","Siapkan akses ke lokasi instalasi","Berikan informasi teknis lokasi jika ada"],color:"indigo"},survey_completed:{title:"Menunggu Persetujuan",items:["Survey lokasi telah selesai dilakukan","Tim sedang review hasil survey","Anda akan dihubungi untuk hasil persetujuan"],color:"purple"},approved:{title:"Selamat! Pendaftaran Disetujui",items:["Tim kami akan segera menghubungi untuk jadwal instalasi","Pastikan nomor WhatsApp Anda aktif","Proses pembuatan account customer sedang berlangsung"],color:"green"},customer_created:{title:"Menunggu Jadwal Instalasi",items:["Selamat! Anda sudah terdaftar sebagai customer","Tim instalasi akan menghubungi untuk jadwal","Pastikan nomor WhatsApp aktif dan lokasi siap diakses"],color:"green"}})[s],t=a?P(a.status):null,A=(t==null?void 0:t.icon)||f;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:"/aglis-logo.svg",alt:"AGLIS Net",className:"h-12 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"AGLIS"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Lacak Status Pendaftaran"})]})]})})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Cek Status Pendaftaran"}),e.jsxs("form",{onSubmit:S,className:"flex gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:m,onChange:s=>N(s.target.value),placeholder:"Masukkan nomor registrasi atau email",className:"form-input w-full"})}),e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors inline-flex items-center",children:[e.jsx(y,{className:"h-5 w-5 mr-2"}),"Cari"]})]})]}),o&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Mencari data..."})]}),_&&i&&!o&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center",children:[e.jsx(p,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Data Tidak Ditemukan"}),e.jsx("p",{className:"text-gray-600",children:"Pendaftaran dengan nomor/email tersebut tidak ditemukan."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Pastikan Anda memasukkan nomor registrasi atau email yang benar."})]}),a&&!o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:`
                px-8 py-6 border-b-4
                ${t.color==="green"?"bg-green-50 border-green-500":t.color==="yellow"?"bg-yellow-50 border-yellow-500":t.color==="blue"?"bg-blue-50 border-blue-500":t.color==="red"?"bg-red-50 border-red-500":"bg-gray-50 border-gray-500"}
              `,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`
                      p-3 rounded-full
                      ${t.color==="green"?"bg-green-500":t.color==="yellow"?"bg-yellow-500":t.color==="blue"?"bg-blue-500":t.color==="red"?"bg-red-500":"bg-gray-500"}
                    `,children:e.jsx(A,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status Pendaftaran"}),e.jsx("p",{className:`
                        text-2xl font-bold
                        ${t.color==="green"?"text-green-700":t.color==="yellow"?"text-yellow-700":t.color==="blue"?"text-blue-700":t.color==="red"?"text-red-700":"text-gray-700"}
                      `,children:t.label}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nomor Registrasi"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:a.registration_number})]})]})}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(k,{className:"h-5 w-5 mr-2 text-blue-600"}),"Informasi Pribadi"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nama"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.full_name})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(v,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"WhatsApp"}),e.jsxs("p",{className:"font-medium text-green-600 flex items-center",children:[a.phone,e.jsx(L,{className:"h-4 w-4 ml-1"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2 text-blue-600"}),"Paket yang Dipilih"]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6 border border-blue-200",children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:a.package_name}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:[new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a.monthly_price),"/bulan"]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2 text-blue-600"}),"Alamat Instalasi"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-gray-900",children:a.address||"Belum tersedia"}),a.city&&e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:a.city})]})]}),a.status==="survey_scheduled"&&a.survey_scheduled_date&&e.jsx("div",{className:"bg-indigo-50 border-l-4 border-indigo-500 p-6 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(b,{className:"h-6 w-6 text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-indigo-900 mb-2",children:"ðŸ“… Survey Telah Dijadwalkan"}),e.jsx("p",{className:"text-indigo-800 text-lg font-semibold",children:new Date(a.survey_scheduled_date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("p",{className:"text-indigo-700 text-sm mt-2",children:"Mohon siapkan akses lokasi untuk tim survey kami"})]})]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(b,{className:"h-5 w-5 mr-2 text-blue-600"}),"Timeline"]}),e.jsx("div",{className:"space-y-4",children:[{status:"pending_verification",label:"Pendaftaran Diterima",date:a.created_at},{status:"verified",label:"Data Diverifikasi",date:a.verified_at},{status:"survey_scheduled",label:"Survey Dijadwalkan",date:a.survey_scheduled_date},{status:"survey_completed",label:"Survey Selesai",date:null},{status:"approved",label:"Disetujui",date:a.approved_at},{status:"customer_created",label:"Customer Dibuat",date:null}].map((s,l)=>{const n=D(a.status,s.status);return e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`
                            w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0
                            ${n==="completed"?"bg-green-500 text-white":n==="current"?"bg-blue-600 text-white ring-4 ring-blue-100":"bg-gray-200 text-gray-400"}
                          `,children:n==="completed"?e.jsx(c,{className:"h-6 w-6"}):e.jsx("div",{className:"w-3 h-3 bg-current rounded-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-medium ${n==="current"?"text-blue-600":"text-gray-900"}`,children:s.label}),s.date&&e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.date).toLocaleString("id-ID")})]})]},l)})})]}),a.status==="rejected"&&a.rejection_reason&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(U,{className:"h-6 w-6 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-900 mb-2",children:"Alasan Penolakan"}),e.jsx("p",{className:"text-red-800",children:a.rejection_reason})]})]})}),r(a.status)&&e.jsxs("div",{className:`
                    border rounded-lg p-6
                    ${r(a.status).color==="green"?"bg-green-50 border-green-200":r(a.status).color==="blue"?"bg-blue-50 border-blue-200":r(a.status).color==="indigo"?"bg-indigo-50 border-indigo-200":r(a.status).color==="purple"?"bg-purple-50 border-purple-200":"bg-gray-50 border-gray-200"}
                  `,children:[e.jsxs("h4",{className:`
                      font-semibold mb-3 flex items-center
                      ${r(a.status).color==="green"?"text-green-900":r(a.status).color==="blue"?"text-blue-900":r(a.status).color==="indigo"?"text-indigo-900":r(a.status).color==="purple"?"text-purple-900":"text-gray-900"}
                    `,children:[e.jsx(c,{className:"h-5 w-5 mr-2"}),r(a.status).title]}),e.jsx("ul",{className:`
                      space-y-2
                      ${r(a.status).color==="green"?"text-green-800":r(a.status).color==="blue"?"text-blue-800":r(a.status).color==="indigo"?"text-indigo-800":r(a.status).color==="purple"?"text-purple-800":"text-gray-800"}
                    `,children:r(a.status).items.map((s,l)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(c,{className:"h-5 w-5 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:s})]},l))})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Butuh Bantuan?"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("a",{href:"https://wa.me/6281316003245",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-3 p-6 border border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors w-full max-w-sm",children:[e.jsx(v,{className:"h-6 w-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"WhatsApp"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Chat dengan kami"})]})]})})]})]}),!i&&!o&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center",children:[e.jsx(y,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Lacak Pendaftaran Anda"}),e.jsx("p",{className:"text-gray-600",children:"Masukkan nomor registrasi atau email untuk melihat status pendaftaran"})]})]})]})};export{z as default};
//# sourceMappingURL=TrackingPage-BtddMjT8.js.map
