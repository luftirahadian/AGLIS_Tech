var W=Object.defineProperty;var _=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var M=(o,t,l)=>t in o?W(o,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[t]=l,d=(o,t)=>{for(var l in t||(t={}))G.call(t,l)&&M(o,l,t[l]);if(_)for(var l of _(t))K.call(t,l)&&M(o,l,t[l]);return o};import{j as e}from"./notifications-BKoDXu8u.js";import{r as x}from"./react-vendor-BQ7pSkNi.js";import{u as z}from"./forms-Dmkgx8TD.js";import{a as O,b as J,u as F}from"./react-query-B7OIdD7u.js";import{u as X,L as Y,g as y}from"./customers-DE4GlQu6.js";import{U as v,aL as T,m as D,o as ee,a6 as se,t as re,aG as V,aw as P,E as S,z as m}from"./ui-vendor-DLnrzDYx.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";const xe=()=>{var L,U;const{user:o,setUser:t}=X(),l=O(),[u,C]=x.useState("profile"),[p,k]=x.useState(!1),[b,E]=x.useState(!1),[g,A]=x.useState(!1),{data:i,isLoading:$}=J("profile",y.getProfile,{onError:r=>{var a,n;m.error(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to load profile")}}),{register:w,handleSubmit:I,formState:{errors:h},reset:q}=z({defaultValues:{full_name:"",email:"",phone:""}}),{register:f,handleSubmit:Q,formState:{errors:c},reset:R,watch:Z}=z({defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}});x.useEffect(()=>{var r;if((r=i==null?void 0:i.data)!=null&&r.user){const a=i.data.user;q({full_name:a.full_name||"",email:a.email||"",phone:a.phone||""})}},[i,q]);const j=F(r=>y.updateProfile(r),{onSuccess:r=>{var a;m.success("Profile updated successfully!"),l.invalidateQueries("profile"),(a=r.data)!=null&&a.user&&t(d(d({},o),r.data.user))},onError:r=>{var a,n;m.error(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to update profile")}}),N=F(r=>y.changePassword(r),{onSuccess:()=>{m.success("Password changed successfully!"),R(),k(!1),E(!1),A(!1)},onError:r=>{var a,n;m.error(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to change password")}}),B=r=>{j.mutate(r)},H=r=>{if(r.newPassword!==r.confirmPassword){m.error("New password and confirmation do not match");return}N.mutate({currentPassword:r.currentPassword,newPassword:r.newPassword})};if($)return e.jsx("div",{className:"flex justify-center items-center min-h-96",children:e.jsx(Y,{})});const s=(L=i==null?void 0:i.data)==null?void 0:L.user;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),e.jsx("p",{className:"text-gray-600",children:"Manage your account settings and preferences"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-100",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-3xl font-bold shadow-lg",children:(U=s==null?void 0:s.full_name)==null?void 0:U.charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s==null?void 0:s.full_name}),e.jsxs("p",{className:"text-gray-600",children:["@",s==null?void 0:s.username]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-sm font-semibold rounded-full border ${(s==null?void 0:s.role)==="admin"?"bg-purple-100 text-purple-800 border-purple-200":(s==null?void 0:s.role)==="supervisor"?"bg-blue-100 text-blue-800 border-blue-200":(s==null?void 0:s.role)==="technician"?"bg-green-100 text-green-800 border-green-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:(s==null?void 0:s.role)==="admin"?"Admin":(s==null?void 0:s.role)==="supervisor"?"Supervisor":(s==null?void 0:s.role)==="technician"?"Technician":"Customer Service"})})]})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>C("profile"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="profile"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-5 w-5 mr-2"}),"Edit Profile"]})}),e.jsx("button",{onClick:()=>C("password"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="password"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Change Password"]})})]})}),e.jsxs("div",{className:"max-w-3xl",children:[u==="profile"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(v,{className:"h-5 w-5 mr-2 text-blue-600"}),"Personal Information"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Update your personal details and contact information"})]}),e.jsxs("form",{onSubmit:I(B),className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5 border border-gray-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-4 w-4 mr-2 text-gray-400"}),"Full Name ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),e.jsx("input",d({type:"text",className:"input-field",placeholder:"Enter your full name"},w("full_name",{required:"Full name is required"}))),h.full_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.full_name.message})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5 border border-gray-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-4 w-4 mr-2 text-gray-400"}),"Email Address ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),e.jsx("input",d({type:"email",className:"input-field",placeholder:"email@example.com"},w("email",{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email format"}}))),h.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.email.message})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5 border border-gray-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2 text-gray-400"}),"Phone Number"]})}),e.jsx("input",d({type:"text",className:"input-field",placeholder:"08123456789"},w("phone")))]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-5 border border-blue-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2 text-blue-600"}),"Username (Cannot be changed)"]})}),e.jsx("input",{type:"text",className:"input-field bg-gray-100 cursor-not-allowed",value:(s==null?void 0:s.username)||"",disabled:!0})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:e.jsx("button",{type:"submit",disabled:j.isLoading,className:"btn-primary",children:j.isLoading?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})})]})]}),u==="password"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(V,{className:"h-5 w-5 mr-2 text-blue-600"}),"Change Password"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Update your password to keep your account secure"})]}),e.jsxs("form",{onSubmit:Q(H),className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5 border border-gray-200",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Current Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",d({type:p?"text":"password",className:"input-field pr-10",placeholder:"Enter current password"},f("currentPassword",{required:"Current password is required"}))),e.jsx("button",{type:"button",onClick:()=>k(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:p?e.jsx(P,{className:"h-5 w-5"}):e.jsx(S,{className:"h-5 w-5"})})]}),c.currentPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.currentPassword.message})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5 border border-gray-200",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",d({type:b?"text":"password",className:"input-field pr-10",placeholder:"Enter new password (min 6 characters)"},f("newPassword",{required:"New password is required",minLength:{value:6,message:"Password must be at least 6 characters"}}))),e.jsx("button",{type:"button",onClick:()=>E(!b),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:b?e.jsx(P,{className:"h-5 w-5"}):e.jsx(S,{className:"h-5 w-5"})})]}),c.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.newPassword.message})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5 border border-gray-200",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Confirm New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",d({type:g?"text":"password",className:"input-field pr-10",placeholder:"Re-enter new password"},f("confirmPassword",{required:"Please confirm your password",validate:r=>r===Z("newPassword")||"Passwords do not match"}))),e.jsx("button",{type:"button",onClick:()=>A(!g),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:g?e.jsx(P,{className:"h-5 w-5"}):e.jsx(S,{className:"h-5 w-5"})})]}),c.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.confirmPassword.message})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(V,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Password Security Tips:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Use at least 6 characters"}),e.jsx("li",{children:"Include uppercase and lowercase letters"}),e.jsx("li",{children:"Add numbers and special characters"}),e.jsx("li",{children:"Don't reuse old passwords"})]})]})]})}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:e.jsx("button",{type:"submit",disabled:N.isLoading,className:"btn-primary bg-green-600 hover:bg-green-700",children:N.isLoading?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Changing Password..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Change Password"]})})})]})]})]})]})};export{xe as default};
//# sourceMappingURL=ProfilePage-SfbIBY0q.js.map
