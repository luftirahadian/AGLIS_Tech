var me=Object.defineProperty,xe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var G=(t,l,r)=>l in t?me(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,m=(t,l)=>{for(var r in l||(l={}))ue.call(l,r)&&G(t,r,l[r]);if(U)for(var r of U(l))ge.call(l,r)&&G(t,r,l[r]);return t},M=(t,l)=>xe(t,he(l));import{j as e}from"./notifications-DWMisRkI.js";import{r as x}from"./react-vendor-BQ7pSkNi.js";import{b as F,u as V,a as pe}from"./react-query-B7OIdD7u.js";import{c as P,b as X,L as be,K as A}from"./customers-B56UMpVp.js";import{u as je}from"./forms-Dmkgx8TD.js";import{X as ye,z as D,P as R,aC as w,S as ve,a5 as fe,T as Ne,Q as we,V as _e,W as Se,Y as Ce,Z as ke}from"./ui-vendor-r_Nxhu34.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";const Te=({category:t,onClose:l,onSuccess:r})=>{const h=!!t,{register:d,handleSubmit:I,formState:{errors:o,isSubmitting:u},reset:_}=je({defaultValues:t||{service_type_code:"",category_code:"",category_name:"",description:"",estimated_duration:120,sla_multiplier:1,requires_checklist:!1,is_active:!0,display_order:0}}),{data:g}=F("service-types",()=>X.getAll(!0),{refetchOnWindowFocus:!1});x.useEffect(()=>{t&&_(t)},[t,_]);const p=V(c=>h?P.update(t.id,c):P.create(c),{onSuccess:()=>{D.success(h?"Category berhasil diupdate":"Category berhasil ditambahkan"),r()},onError:c=>{var j,S;D.error(((S=(j=c.response)==null?void 0:j.data)==null?void 0:S.message)||"Terjadi kesalahan")}}),E=c=>{p.mutate(c)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:h?"Edit Service Category":"Tambah Service Category Baru"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ye,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:I(E),className:"p-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Service Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",M(m({className:"input-field"},d("service_type_code",{required:"Service type wajib dipilih"})),{disabled:h,children:[e.jsx("option",{value:"",children:"Pilih Service Type..."}),g==null?void 0:g.map(c=>e.jsx("option",{value:c.type_code,children:c.type_name},c.type_code))]})),o.service_type_code&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.service_type_code.message})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Informasi Dasar"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Category Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",M(m({type:"text",className:"input-field",placeholder:"e.g., fiber_installation"},d("category_code",{required:"Category code wajib diisi",pattern:{value:/^[a-z_]+$/,message:"Gunakan lowercase dan underscore"}})),{disabled:h})),o.category_code&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.category_code.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Category Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",m({type:"text",className:"input-field",placeholder:"e.g., Fiber Installation"},d("category_name",{required:"Category name wajib diisi",minLength:{value:3,message:"Minimal 3 karakter"}}))),o.category_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.category_name.message})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",m({className:"input-field",rows:"3",placeholder:"Deskripsi category"},d("description")))]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Konfigurasi"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Estimated Duration (minutes) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",m({type:"number",className:"input-field",min:"1"},d("estimated_duration",{required:"Duration wajib diisi",min:{value:1,message:"Minimal 1 menit"},valueAsNumber:!0}))),o.estimated_duration&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.estimated_duration.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SLA Multiplier"}),e.jsx("input",m({type:"number",className:"input-field",step:"0.1",min:"0.1",max:"10"},d("sla_multiplier",{min:{value:.1,message:"Minimal 0.1"},max:{value:10,message:"Maksimal 10"},valueAsNumber:!0}))),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Default: 1.0"}),o.sla_multiplier&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.sla_multiplier.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Order"}),e.jsx("input",m({type:"number",className:"input-field",min:"0"},d("display_order",{min:{value:0,message:"Minimal 0"},valueAsNumber:!0})))]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",m({type:"checkbox",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},d("is_active"))),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Category aktif dan dapat digunakan"}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",m({type:"checkbox",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},d("requires_checklist"))),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Requires Checklist"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Category memerlukan checklist khusus"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",disabled:u,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:u,children:u?"Menyimpan...":h?"Update Category":"Tambah Category"})]})]})]})})},Fe=()=>{const[t,l]=x.useState(""),[r,h]=x.useState("all"),[d,I]=x.useState("all"),[o,u]=x.useState(!1),[_,g]=x.useState(null),[p,E]=x.useState("display_order"),[c,j]=x.useState("asc"),[S,Q]=x.useState({}),[C,Y]=x.useState(10),k=pe(),{data:O}=F("service-types-filter",()=>X.getAll({page:1,limit:100}),{refetchOnWindowFocus:!1}),Z=(O==null?void 0:O.data)||[],{data:q,isLoading:H}=F(["service-categories-all",r,d,t,p,c],()=>P.getAll({service_type_code:r!=="all"?r:void 0,active_only:d==="active"?"true":d==="inactive"?"false":void 0,search:t||void 0,page:1,limit:1e3,sort_by:p,sort_order:c}),{refetchOnWindowFocus:!1}),y=(q==null?void 0:q.data)||[],J=y.length,ee=y.filter(s=>s.is_active).length,se=y.filter(s=>!s.is_active).length,te=[...new Set(y.map(s=>s.service_type_code))].length,z=y.reduce((s,a)=>(s[a.service_type_code]||(s[a.service_type_code]={type_name:a.service_type_name,categories:[]}),s[a.service_type_code].categories.push(a),s),{}),ae=V(s=>P.delete(s),{onSuccess:()=>{D.success("Category berhasil dihapus"),k.invalidateQueries("service-categories"),k.invalidateQueries("service-categories-all")},onError:s=>{var a,n;D.error(((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"Gagal menghapus category")}}),W=()=>{g(null),u(!0)},ie=s=>{g(s),u(!0)},le=(s,a)=>{window.confirm(`Apakah Anda yakin ingin menghapus category "${a}"?`)&&ae.mutate(s)},B=()=>{u(!1),g(null)},re=()=>{k.invalidateQueries("service-categories"),k.invalidateQueries("service-categories-all"),B()},v=s=>{p===s?j(c==="asc"?"desc":"asc"):(E(s),j("asc"))},f=s=>p!==s?e.jsx(Se,{className:"h-4 w-4 text-gray-400"}):c==="asc"?e.jsx(Ce,{className:"h-4 w-4"}):e.jsx(ke,{className:"h-4 w-4"}),ce=s=>{l(s.target.value)},K=(s,a)=>{s==="serviceType"?h(a):s==="status"&&I(a)},ne=s=>S[s]||1,N=(s,a)=>{Q(n=>M(m({},n),{[s]:a}))};return H?e.jsx("div",{className:"flex justify-center items-center min-h-96",children:e.jsx(be,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Service Categories Management"}),e.jsx("p",{className:"text-gray-600",children:"Kelola kategori layanan berdasarkan service type"})]}),e.jsxs("button",{onClick:W,className:"btn-primary",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Tambah Category"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(A,{icon:w,title:"Total Categories",value:J,color:"blue"}),e.jsx(A,{icon:w,title:"Active",value:ee,color:"green"}),e.jsx(A,{icon:w,title:"Inactive",value:se,color:"red"}),e.jsx(A,{icon:w,title:"Service Types",value:te,color:"purple"})]}),e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"h-4 w-4 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",className:"form-input pl-10",placeholder:"Cari category...",value:t,onChange:ce})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Service Type"}),e.jsxs("select",{className:"form-input",value:r,onChange:s=>K("serviceType",s.target.value),children:[e.jsx("option",{value:"all",children:"Semua Service Type"}),Z.map(s=>e.jsx("option",{value:s.type_code,children:s.type_name},s.type_code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"form-input",value:d,onChange:s=>K("status",s.target.value),children:[e.jsx("option",{value:"all",children:"Semua Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rows Per Table"}),e.jsxs("select",{className:"form-input",value:C,onChange:s=>{Y(parseInt(s.target.value)),Q({})},children:[e.jsx("option",{value:"5",children:"5 rows"}),e.jsx("option",{value:"10",children:"10 rows"}),e.jsx("option",{value:"25",children:"25 rows"}),e.jsx("option",{value:"50",children:"50 rows"})]})]})]})}),Object.keys(z).length===0?e.jsxs("div",{className:"bg-white shadow rounded-lg p-12 text-center",children:[e.jsx(w,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak ada category"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Mulai dengan menambahkan category pertama"}),e.jsxs("button",{onClick:W,className:"btn-primary",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Tambah Category"]})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(z).map(([s,a])=>{const n=ne(s),T=a.categories.length,b=Math.ceil(T/C),L=(n-1)*C,$=L+C,de=a.categories.slice(L,$);return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[a.type_name,e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",T," categories)"]})]})}),e.jsxs("div",{className:"card-body p-0",children:[e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"table w-full",style:{tableLayout:"fixed",minWidth:"900px"},children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>v("display_order"),style:{width:"50px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"#"}),f("display_order")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>v("category_code"),style:{width:"150px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Code"}),f("category_code")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>v("category_name"),style:{width:"170px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Category Name"}),f("category_name")]})}),e.jsx("th",{className:"table-header-cell",style:{width:"200px"},children:"Description"}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>v("estimated_duration"),style:{width:"100px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Duration"}),f("estimated_duration")]})}),e.jsx("th",{className:"table-header-cell",style:{width:"70px"},children:"SLA"}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>v("is_active"),style:{width:"90px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status"}),f("is_active")]})}),e.jsx("th",{className:"table-header-cell text-center",style:{width:"100px"},children:"Actions"})]})}),e.jsx("tbody",{className:"table-body",children:de.map(i=>e.jsxs("tr",{children:[e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:i.display_order})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-sm font-mono text-gray-900",children:i.category_code})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:i.category_name})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-sm text-gray-900 truncate",title:i.description,style:{maxWidth:"200px"},children:i.description||"-"})}),e.jsx("td",{className:"table-cell whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[i.estimated_duration," min"]})}),e.jsx("td",{className:"table-cell whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:["×",i.sla_multiplier]})}),e.jsx("td",{className:"table-cell whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${i.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:i.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"table-cell text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>ie(i),className:"inline-flex items-center justify-center w-8 h-8 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-md transition-colors",title:"Edit Category",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>le(i.id,i.category_name),className:"inline-flex items-center justify-center w-8 h-8 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors",title:"Delete Category",children:e.jsx(Ne,{className:"h-4 w-4"})})]})})]},i.id))})]})}),b>1&&e.jsxs("div",{className:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>N(s,Math.max(1,n-1)),disabled:n===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>N(s,Math.min(b,n+1)),disabled:n===b,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:L+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min($,T)})," of"," ",e.jsx("span",{className:"font-medium",children:T})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>N(s,Math.max(1,n-1)),disabled:n===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(we,{className:"h-5 w-5"})}),Array.from({length:b},(i,oe)=>oe+1).map(i=>e.jsx("button",{onClick:()=>N(s,i),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${n===i?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:i},i)),e.jsx("button",{onClick:()=>N(s,Math.min(b,n+1)),disabled:n===b,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(_e,{className:"h-5 w-5"})})]})})]})]})]})]},s)})}),o&&e.jsx(Te,{category:_,onClose:B,onSuccess:re})]})};export{Fe as default};
//# sourceMappingURL=ServiceCategoriesPage-C5Pw70gH.js.map
