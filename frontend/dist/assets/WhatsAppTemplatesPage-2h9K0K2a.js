var K=Object.defineProperty,Y=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var q=(l,a,r)=>a in l?K(l,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[a]=r,x=(l,a)=>{for(var r in a||(a={}))G.call(a,r)&&q(l,r,a[r]);if(I)for(var r of I(a))V.call(a,r)&&q(l,r,a[r]);return l},g=(l,a)=>Y(l,B(a));var O=(l,a,r)=>new Promise((u,f)=>{var w=d=>{try{j(r.next(d))}catch(i){f(i)}},p=d=>{try{j(r.throw(d))}catch(i){f(i)}},j=d=>d.done?u(d.value):Promise.resolve(d.value).then(w,p);j((r=r.apply(l,a)).next())});import{j as e,a as N}from"./notifications-ZCsIKyPs.js";import{r as y}from"./react-vendor-BQ7pSkNi.js";import{a as H,b as X,u as C}from"./react-query-B7OIdD7u.js";import{o as U,P as z,S as Z,l as ee,E as se,a6 as te,T as ae,z as h}from"./ui-vendor-DY8BSMik.js";import"./charts-CREYXqqm.js";const de=()=>{var M,P,$;const l=H(),[a,r]=y.useState(""),[u,f]=y.useState("all"),[w,p]=y.useState(!1),[j,d]=y.useState(!1),[i,k]=y.useState(null),[n,m]=y.useState({code:"",name:"",category:"ticket",description:"",template:"",variables:"{}",is_active:!0}),{data:o,isLoading:S,error:b,isError:A}=X(["whatsapp-templates",u,a],()=>O(void 0,null,function*(){const s=new URLSearchParams;u!=="all"&&s.append("category",u),a&&s.append("search",a),console.log("Fetching templates with params:",s.toString());const t=yield N.get(`/whatsapp-templates?${s.toString()}`);return console.log("Templates response:",t.data),t.data}),{staleTime:6e4,onError:s=>{var t,c;console.error("Error fetching templates:",s),h.error("Failed to load templates: "+(((c=(t=s.response)==null?void 0:t.data)==null?void 0:c.message)||s.message))}}),T=Array.isArray(o)?o:(o==null?void 0:o.data)||[];console.log("Templates data:",o),console.log("Templates array:",T);const E=C(s=>N.post("/whatsapp-templates",s),{onSuccess:()=>{h.success("Template created successfully!"),l.invalidateQueries(["whatsapp-templates"]),p(!1),v()},onError:s=>{var t,c;h.error(((c=(t=s.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to create template")}}),L=C(({id:s,data:t})=>N.put(`/whatsapp-templates/${s}`,t),{onSuccess:()=>{h.success("Template updated successfully!"),l.invalidateQueries(["whatsapp-templates"]),p(!1),v()},onError:s=>{var t,c;h.error(((c=(t=s.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to update template")}}),Q=C(s=>N.delete(`/whatsapp-templates/${s}`),{onSuccess:()=>{h.success("Template deleted successfully!"),l.invalidateQueries(["whatsapp-templates"])},onError:s=>{var t,c;h.error(((c=(t=s.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to delete template")}}),v=()=>{m({code:"",name:"",category:"ticket",description:"",template:"",variables:"{}",is_active:!0}),k(null)},R=s=>{k(s),m({code:s.code,name:s.name,category:s.category,description:s.description||"",template:s.template,variables:JSON.stringify(s.variables||{},null,2),is_active:s.is_active}),p(!0)},W=s=>{s.preventDefault();const t=g(x({},n),{variables:JSON.parse(n.variables)});i?L.mutate({id:i.id,data:t}):E.mutate(t)},D=s=>{window.confirm("Are you sure you want to delete this template?")&&Q.mutate(s)},J=s=>{k(s),d(!0)},_=[{value:"all",label:"All Categories",color:"gray"},{value:"ticket",label:"Ticket",color:"blue"},{value:"payment",label:"Payment",color:"green"},{value:"customer",label:"Customer",color:"purple"},{value:"team",label:"Team",color:"orange"},{value:"marketing",label:"Marketing",color:"pink"}],F=s=>{const t=_.find(c=>c.value===s);return(t==null?void 0:t.color)||"gray"};return S?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading templates..."})]}):A?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"h-16 w-16 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Failed to Load Templates"}),e.jsx("p",{className:"text-gray-600 mb-4",children:((P=(M=b==null?void 0:b.response)==null?void 0:M.data)==null?void 0:P.message)||(b==null?void 0:b.message)||"Unknown error"}),e.jsx("button",{onClick:()=>l.invalidateQueries(["whatsapp-templates"]),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(U,{className:"h-7 w-7 mr-3 text-green-600"}),"WhatsApp Message Templates"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola template pesan WhatsApp untuk notifikasi otomatis"})]}),e.jsxs("button",{onClick:()=>{v(),p(!0)},className:"flex items-center px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors shadow-sm",children:[e.jsx(z,{className:"h-5 w-5 mr-2"}),"Tambah Template"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search templates...",value:a,onChange:s=>r(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-gray-500"}),_.map(s=>e.jsx("button",{onClick:()=>f(s.value),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${u===s.value?`bg-${s.color}-100 text-${s.color}-700 border border-${s.color}-300`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.label},s.value))]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:`px-3 py-1 text-xs font-semibold rounded-full bg-${F(s.category)}-100 text-${F(s.category)}-700`,children:s.category}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.is_active?"Active":"Inactive"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s.description||"No description"}),e.jsx("div",{className:"bg-gray-50 rounded p-3 mb-4",children:e.jsx("pre",{className:"text-xs text-gray-700 font-mono whitespace-pre-wrap line-clamp-4",children:s.template})}),e.jsxs("div",{className:"text-xs text-gray-500 mb-4",children:[e.jsxs("div",{children:["Code: ",e.jsx("span",{className:"font-mono font-semibold",children:s.code})]}),s.usage_count>0&&e.jsxs("div",{children:["Used: ",s.usage_count," times"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>J(s),className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Preview"]}),e.jsx("button",{onClick:()=>R(s),className:"flex items-center justify-center px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>D(s.id),className:"flex items-center justify-center px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:e.jsx(ae,{className:"h-4 w-4"})})]})]},s.id))}),T.length===0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx(U,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No templates found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:u!=="all"||a?"No templates match your filters. Try clearing filters or create a new template.":"Create your first WhatsApp message template"}),e.jsxs("div",{className:"bg-gray-50 border border-gray-300 rounded p-3 mb-4 text-left text-xs font-mono",children:[e.jsx("div",{children:e.jsx("strong",{children:"Debug Info:"})}),e.jsxs("div",{children:["Category Filter: ",u]}),e.jsxs("div",{children:["Search Term: ",a||"(empty)"]}),e.jsxs("div",{children:["Response Success: ",Array.isArray(o)||o!=null&&o.success?"Yes":"No"]}),e.jsxs("div",{children:["Data Array Length: ",Array.isArray(o)?o.length:(($=o==null?void 0:o.data)==null?void 0:$.length)||0]}),e.jsxs("div",{children:["Is Loading: ",S?"Yes":"No"]}),e.jsxs("div",{children:["Has Error: ",A?"Yes":"No"]})]}),e.jsxs("button",{onClick:()=>{f("all"),r(""),p(!0)},className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(z,{className:"h-5 w-5 mr-2"}),"Create Template"]})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:i?"Edit Template":"Create New Template"})}),e.jsxs("form",{onSubmit:W,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Code *"}),e.jsx("input",{type:"text",value:n.code,onChange:s=>m(g(x({},n),{code:s.target.value.toUpperCase().replace(/\s/g,"_")})),placeholder:"TICKET_ASSIGNMENT",required:!0,disabled:!!i,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent disabled:bg-gray-100 font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),e.jsxs("select",{value:n.category,onChange:s=>m(g(x({},n),{category:s.target.value})),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"ticket",children:"Ticket"}),e.jsx("option",{value:"payment",children:"Payment"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"team",children:"Team"}),e.jsx("option",{value:"marketing",children:"Marketing"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Name *"}),e.jsx("input",{type:"text",value:n.name,onChange:s=>m(g(x({},n),{name:s.target.value})),placeholder:"Ticket Assignment - Teknisi",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("input",{type:"text",value:n.description,onChange:s=>m(g(x({},n),{description:s.target.value})),placeholder:"Notifikasi assignment tiket ke teknisi",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message Template *"}),e.jsx("textarea",{value:n.template,onChange:s=>m(g(x({},n),{template:s.target.value})),placeholder:`📩 *TIKET BARU*

Ticket: #{{ticketNumber}}
Customer: {{customerName}}`,required:!0,rows:12,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Use ","{{variableName}}"," for dynamic content. Example: ","{{customerName}}, {{ticketNumber}}"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Variables (JSON)"}),e.jsx("textarea",{value:n.variables,onChange:s=>m(g(x({},n),{variables:s.target.value})),placeholder:'{"customerName": "Bapak Rizki", "ticketNumber": "TKT001"}',rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent font-mono text-xs"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JSON object dengan example values untuk testing"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:n.is_active,onChange:s=>m(g(x({},n),{is_active:s.target.checked})),className:"h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Active (template akan digunakan oleh sistem)"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>{p(!1),v()},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:E.isLoading||L.isLoading,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:i?"Update Template":"Create Template"})]})]})]})}),j&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Template Preview"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i.name})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mx-auto max-w-sm bg-gradient-to-b from-green-50 to-green-100 rounded-3xl p-4 shadow-lg",children:e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-inner",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold",children:"A"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"AGLIS Net"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Online"})]})]}),e.jsx("div",{className:"bg-green-100 rounded-lg rounded-tl-none p-3 mb-2",children:e.jsx("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-sans",children:i.template})}),e.jsx("div",{className:"text-right text-xs text-gray-500",children:new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})})]})}),i.variables&&Object.keys(i.variables).length>0&&e.jsxs("div",{className:"mt-6 bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2 text-sm",children:"Available Variables:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(i.variables).map(([s,t])=>e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-mono font-semibold text-green-600",children:`{{${s}}}`}),e.jsxs("span",{className:"text-gray-600",children:[" = ",t]})]},s))})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Close"})})]})})]})};export{de as default};
//# sourceMappingURL=WhatsAppTemplatesPage-2h9K0K2a.js.map
