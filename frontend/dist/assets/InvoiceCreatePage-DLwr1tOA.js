var q=Object.defineProperty,A=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var k=(n,t,r)=>t in n?q(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,i=(n,t)=>{for(var r in t||(t={}))L.call(t,r)&&k(n,r,t[r]);if(w)for(var r of w(t))E.call(t,r)&&k(n,r,t[r]);return n},o=(n,t)=>A(n,F(t));import{j as e}from"./notifications-DGuCqj8i.js";import{u as R,r as C}from"./react-vendor-BQ7pSkNi.js";import{b as I,u as O}from"./react-query-B7OIdD7u.js";import{r as B,P as $,T as z,t as M,aE as Q,z as v}from"./ui-vendor-DFmaqm_b.js";import{j as G,l as U,p as V}from"./customers-BMsGxBIX.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";import"./forms-Dmkgx8TD.js";const ae=()=>{var _;const n=R(),[t,r]=C.useState({customer_id:"",invoice_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],billing_period_start:"",billing_period_end:"",tax_percentage:11,discount_amount:0,discount_percentage:0,notes:"",internal_notes:"",invoice_type:"recurring",auto_send:!1}),[c,j]=C.useState([{item_type:"package",item_reference_id:"",description:"",quantity:1,unit_price:0,discount_amount:0,discount_percentage:0}]),{data:u}=I("customers-for-invoice",()=>U.getCustomers({limit:1e3,status:"active"})),{data:f}=I("packages-for-invoice",()=>V.getAll({is_active:!0})),S=((_=u==null?void 0:u.data)==null?void 0:_.customers)||(u==null?void 0:u.customers)||[],y=(f==null?void 0:f.data)||f||[],g=O(s=>G.create(s),{onSuccess:s=>{v.success("Invoice created successfully"),n(`/invoices/${s.data.id}`)},onError:s=>{var l,a;v.error(((a=(l=s.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to create invoice")}}),D=()=>{j([...c,{item_type:"package",item_reference_id:"",description:"",quantity:1,unit_price:0,discount_amount:0,discount_percentage:0}])},T=s=>{c.length>1&&j(c.filter((l,a)=>a!==s))},m=(s,l,a)=>{const d=[...c];if(d[s][l]=a,l==="item_reference_id"&&d[s].item_type==="package"){const x=y.find(h=>h.id===parseInt(a));x&&(d[s].description=`${x.package_name} - ${x.package_type}`,d[s].unit_price=x.monthly_price||0)}j(d)},b=(()=>{let s=0;c.forEach(h=>{const P=h.quantity*h.unit_price-(h.discount_amount||0);s+=P});const l=t.discount_amount||s*(t.discount_percentage/100),a=s-l,d=a*(t.tax_percentage/100),x=a+d;return{subtotal:s,discount:l,subtotalAfterDiscount:a,tax:d,total:x}})(),p=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),N=(s,l=!1)=>{if(s.preventDefault(),!t.customer_id){v.error("Please select a customer");return}if(c.length===0||!c[0].description){v.error("Please add at least one line item");return}const a=o(i({},t),{line_items:c,auto_send:l});g.mutate(a)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>n("/invoices"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{children:"Back to Invoices"})]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Create New Invoice"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Generate an invoice for customer billing"})]}),e.jsx("form",{onSubmit:N,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer *"}),e.jsxs("select",{value:t.customer_id,onChange:s=>r(o(i({},t),{customer_id:s.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Customer"}),S.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.email]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Type"}),e.jsxs("select",{value:t.invoice_type,onChange:s=>r(o(i({},t),{invoice_type:s.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"recurring",children:"Recurring"}),e.jsx("option",{value:"one_time",children:"One Time"}),e.jsx("option",{value:"installation",children:"Installation"}),e.jsx("option",{value:"additional",children:"Additional"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Date *"}),e.jsx("input",{type:"date",value:t.invoice_date,onChange:s=>r(o(i({},t),{invoice_date:s.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date *"}),e.jsx("input",{type:"date",value:t.due_date,onChange:s=>r(o(i({},t),{due_date:s.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Billing Period Start"}),e.jsx("input",{type:"date",value:t.billing_period_start,onChange:s=>r(o(i({},t),{billing_period_start:s.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Billing Period End"}),e.jsx("input",{type:"date",value:t.billing_period_end,onChange:s=>r(o(i({},t),{billing_period_end:s.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Line Items"}),e.jsxs("button",{type:"button",onClick:D,className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-1 text-sm",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Item"})]})]}),e.jsx("div",{className:"space-y-4",children:c.map((s,l)=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Type"}),e.jsxs("select",{value:s.item_type,onChange:a=>m(l,"item_type",a.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"package",children:"Package"}),e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"equipment",children:"Equipment"}),e.jsx("option",{value:"installation",children:"Installation"}),e.jsx("option",{value:"addon",children:"Add-on"}),e.jsx("option",{value:"other",children:"Other"})]})]}),s.item_type==="package"&&e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Package"}),e.jsxs("select",{value:s.item_reference_id,onChange:a=>m(l,"item_reference_id",a.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),y.map(a=>e.jsx("option",{value:a.id,children:a.package_name},a.id))]})]}),e.jsxs("div",{className:s.item_type==="package"?"col-span-6":"col-span-9",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx("input",{type:"text",value:s.description,onChange:a=>m(l,"description",a.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Item description",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Qty"}),e.jsx("input",{type:"number",step:"0.01",value:s.quantity,onChange:a=>m(l,"quantity",parseFloat(a.target.value)||1),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0.01"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Unit Price"}),e.jsx("input",{type:"number",step:"0.01",value:s.unit_price,onChange:a=>m(l,"unit_price",parseFloat(a.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Discount"}),e.jsx("input",{type:"number",step:"0.01",value:s.discount_amount,onChange:a=>m(l,"discount_amount",parseFloat(a.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Total"}),e.jsx("div",{className:"px-2 py-1 text-sm font-semibold text-gray-900 bg-gray-50 rounded border border-gray-200",children:p(s.quantity*s.unit_price-(s.discount_amount||0))})]}),e.jsx("div",{className:"col-span-1 flex items-end",children:c.length>1&&e.jsx("button",{type:"button",onClick:()=>T(l),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Remove",children:e.jsx(z,{className:"h-4 w-4"})})})]})},l))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Customer Visible)"}),e.jsx("textarea",{value:t.notes,onChange:s=>r(o(i({},t),{notes:s.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",placeholder:"Add any notes for the customer..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Internal Notes (Private)"}),e.jsx("textarea",{value:t.internal_notes,onChange:s=>r(o(i({},t),{internal_notes:s.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"2",placeholder:"Internal notes (not visible to customer)..."})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg shadow-lg p-6 text-white sticky top-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Invoice Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-blue-100",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:p(b.subtotal)})]}),b.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-200",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{className:"font-medium",children:["-",p(b.discount)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-blue-100",children:["Tax (",t.tax_percentage,"%):"]}),e.jsx("span",{className:"font-medium",children:p(b.tax)})]}),e.jsxs("div",{className:"border-t border-blue-500 pt-3 flex justify-between",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Total:"}),e.jsx("span",{className:"text-2xl font-bold",children:p(b.total)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Tax & Discount"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",value:t.tax_percentage,onChange:s=>r(o(i({},t),{tax_percentage:parseFloat(s.target.value)||0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Amount (Rp)"}),e.jsx("input",{type:"number",step:"0.01",value:t.discount_amount,onChange:s=>r(o(i({},t),{discount_amount:parseFloat(s.target.value)||0,discount_percentage:0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0"})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:"OR"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",value:t.discount_percentage,onChange:s=>r(o(i({},t),{discount_percentage:parseFloat(s.target.value)||0,discount_amount:0})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0",max:"100"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"submit",disabled:g.isLoading,className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center space-x-2 font-semibold",children:[e.jsx(M,{className:"h-5 w-5"}),e.jsx("span",{children:g.isLoading?"Creating...":"Save as Draft"})]}),e.jsxs("button",{type:"button",onClick:s=>N(s,!0),disabled:g.isLoading,className:"w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center justify-center space-x-2 font-semibold",children:[e.jsx(Q,{className:"h-5 w-5"}),e.jsx("span",{children:g.isLoading?"Creating...":"Create & Send"})]}),e.jsx("button",{type:"button",onClick:()=>n("/invoices"),className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:"Cancel"})]})})]})]})})]})};export{ae as default};
//# sourceMappingURL=InvoiceCreatePage-DLwr1tOA.js.map
