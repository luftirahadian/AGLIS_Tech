import{j as e}from"./notifications-Dt-KZFDl.js";import{r as b}from"./react-vendor-BQ7pSkNi.js";import{a as Q,b as d}from"./react-query-B7OIdD7u.js";import{s as i}from"./customers-CPkOMPXe.js";import{a as o}from"./index-jR0O955e.js";import{R as H,x as M,C as U,N as W,$ as R,e as T,aa as X,ad as Y,aA as q}from"./ui-vendor-Ccu0xyBn.js";import{R as x,A as G,C as w,X as N,Y as k,T as h,a as u,f as _,P as z,d as J,e as V,B as Z,c as A,L as ee,b as $}from"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";import"./forms-Dmkgx8TD.js";const me=()=>{const l=Q(),[g,K]=b.useState("7days"),[a,I]=b.useState(!0),{data:p,isLoading:L}=d(["analytics-ticket-trend",g],()=>o.getTicketTrend(g),{refetchInterval:a?3e4:!1}),{data:c,isLoading:P}=d("analytics-status-distribution",()=>o.getStatusDistribution(),{refetchInterval:a?3e4:!1}),{data:j,isLoading:B}=d("analytics-tech-performance",()=>o.getTechnicianPerformance(),{refetchInterval:a?3e4:!1}),{data:f,isLoading:S}=d("analytics-revenue-trend",()=>o.getRevenueTrend(),{refetchInterval:a?6e4:!1}),{data:y,isLoading:se}=d("analytics-kpi",()=>o.getKPIMetrics(),{refetchInterval:a?3e4:!1});b.useEffect(()=>{const s=()=>{console.log("ðŸ“Š [Analytics] Ticket updated, refreshing charts..."),l.invalidateQueries(["analytics-ticket-trend"]),l.invalidateQueries("analytics-status-distribution"),l.invalidateQueries("analytics-kpi")},n=()=>{console.log("ðŸ“Š [Analytics] Payment received, refreshing revenue..."),l.invalidateQueries("analytics-revenue-trend"),l.invalidateQueries("analytics-kpi")};return i.on("ticket_created",s),i.on("ticket_updated",s),i.on("ticket_completed",s),i.on("payment_received",n),console.log("ðŸ“Š [Analytics] Socket.IO listeners registered"),()=>{i.off("ticket_created",s),i.off("ticket_updated",s),i.off("ticket_completed",s),i.off("payment_received",n)}},[l]);const r={primary:"#3B82F6",success:"#10B981",warning:"#F59E0B"},C=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#14B8A6"],m=({icon:s,label:n,value:F,change:D,trend:v,color:E="blue"})=>{const O={blue:"from-blue-500 to-blue-600",green:"from-green-500 to-green-600",yellow:"from-yellow-500 to-yellow-600",red:"from-red-500 to-red-600",purple:"from-purple-500 to-purple-600"};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg bg-gradient-to-r ${O[E]}`,children:e.jsx(s,{className:"h-6 w-6 text-white"})}),v&&e.jsxs("div",{className:`flex items-center text-sm font-medium ${v==="up"?"text-green-600":"text-red-600"}`,children:[v==="up"?e.jsx(T,{className:"h-4 w-4 mr-1"}):e.jsx(q,{className:"h-4 w-4 mr-1"}),D]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:F}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:n})]})]})},t=(y==null?void 0:y.data)||{};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ðŸ“Š Analytics Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time performance metrics & insights"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:s=>I(s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Auto-refresh"}),e.jsx(H,{className:`h-4 w-4 ${a?"text-green-500 animate-spin-slow":"text-gray-400"}`})]}),e.jsxs("select",{value:g,onChange:s=>K(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"today",children:"Hari Ini"}),e.jsx("option",{value:"7days",children:"7 Hari"}),e.jsx("option",{value:"30days",children:"30 Hari"}),e.jsx("option",{value:"90days",children:"90 Hari"}),e.jsx("option",{value:"year",children:"Tahun Ini"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(m,{icon:M,label:"Total Tickets",value:t.total_tickets||0,change:`+${t.ticket_growth||0}%`,trend:"up",color:"blue"}),e.jsx(m,{icon:U,label:"Completion Rate",value:`${t.completion_rate||0}%`,change:`+${t.completion_growth||0}%`,trend:t.completion_growth>0?"up":"down",color:"green"}),e.jsx(m,{icon:W,label:"Avg Response Time",value:`${t.avg_response_time||0}h`,change:`-${t.response_improvement||0}%`,trend:"up",color:"purple"}),e.jsx(m,{icon:R,label:"Revenue (This Month)",value:`Rp ${((t.monthly_revenue||0)/1e6).toFixed(1)}M`,change:`+${t.revenue_growth||0}%`,trend:"up",color:"yellow"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(T,{className:"h-5 w-5 mr-2 text-blue-600"}),"Ticket Trend"]}),L?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsx(x,{width:"100%",height:300,children:e.jsxs(G,{data:(p==null?void 0:p.data)||[],children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"date"}),e.jsx(k,{}),e.jsx(h,{}),e.jsx(u,{}),e.jsx(_,{type:"monotone",dataKey:"tickets",stroke:r.primary,fill:r.primary,fillOpacity:.3,name:"Tickets"}),e.jsx(_,{type:"monotone",dataKey:"completed",stroke:r.success,fill:r.success,fillOpacity:.3,name:"Completed"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(X,{className:"h-5 w-5 mr-2 text-purple-600"}),"Status Distribution"]}),P?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):e.jsx(x,{width:"100%",height:300,children:e.jsxs(z,{children:[e.jsx(J,{data:(c==null?void 0:c.data)||[],dataKey:"count",nameKey:"status",cx:"50%",cy:"50%",outerRadius:100,label:s=>`${s.status}: ${s.count}`,children:((c==null?void 0:c.data)||[]).map((s,n)=>e.jsx(V,{fill:C[n%C.length]},`cell-${n}`))}),e.jsx(h,{}),e.jsx(u,{})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2 text-yellow-600"}),"Technician Performance"]}),B?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-600"})}):e.jsx(x,{width:"100%",height:300,children:e.jsxs(Z,{data:(j==null?void 0:j.data)||[],children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name"}),e.jsx(k,{}),e.jsx(h,{}),e.jsx(u,{}),e.jsx(A,{dataKey:"completed",fill:r.success,name:"Completed"}),e.jsx(A,{dataKey:"pending",fill:r.warning,name:"Pending"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2 text-green-600"}),"Revenue Trend"]}),S?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):e.jsx(x,{width:"100%",height:300,children:e.jsxs(ee,{data:(f==null?void 0:f.data)||[],children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"month"}),e.jsx(k,{}),e.jsx(h,{formatter:s=>`Rp ${(s/1e6).toFixed(2)}M`}),e.jsx(u,{}),e.jsx($,{type:"monotone",dataKey:"revenue",stroke:r.success,strokeWidth:2,name:"Revenue"}),e.jsx($,{type:"monotone",dataKey:"target",stroke:r.warning,strokeWidth:2,strokeDasharray:"5 5",name:"Target"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-500",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${a?"bg-green-500 animate-pulse":"bg-gray-400"}`}),a?"Live updates active":"Auto-refresh disabled"]})]})};export{me as default};
//# sourceMappingURL=AnalyticsDashboard-ifXMZiI7.js.map
