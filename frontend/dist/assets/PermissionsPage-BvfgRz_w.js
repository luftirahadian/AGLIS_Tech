var U=Object.defineProperty,q=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var A=(l,i,a)=>i in l?U(l,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[i]=a,M=(l,i)=>{for(var a in i||(i={}))H.call(i,a)&&A(l,a,i[a]);if(R)for(var a of R(i))Y.call(i,a)&&A(l,a,i[a]);return l},L=(l,i)=>q(l,F(i));import{j as e}from"./notifications-Dggueh-l.js";import{r as j}from"./react-vendor-BQ7pSkNi.js";import{a as _,b as G,u as W}from"./react-query-B7OIdD7u.js";import{p as T}from"./index-BNIkI5NK.js";import{u as X,L as J}from"./customers-oGdRQcbr.js";import{A as f,a7 as v,R as K,aI as Z,C as E,u as ee,b as se,z as N}from"./ui-vendor-CO1ReX4_.js";import"./charts-CREYXqqm.js";import"./forms-Dmkgx8TD.js";import"./socket-BFcXWKeu.js";const xe=()=>{var k,S,P;const{user:l}=X(),i=_(),[a,y]=j.useState("supervisor"),[o,m]=j.useState({}),[w,x]=j.useState(!1),$=(l==null?void 0:l.role)==="admin",{data:c,isLoading:h,refetch:z}=G("permissionMatrix",T.getPermissionMatrix,{onError:s=>{var r,t;N.error(((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to load permissions")}}),u=W(({role:s,permissions:r})=>T.updateRolePermissions(s,r),{onSuccess:()=>{N.success("Permissions updated successfully!"),m({}),x(!1),i.invalidateQueries("permissionMatrix")},onError:s=>{var r,t;N.error(((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to update permissions")}}),d=((k=c==null?void 0:c.data)==null?void 0:k.permissions)||[],g=((S=c==null?void 0:c.data)==null?void 0:S.matrix)||{},O=d.reduce((s,r)=>(s[r.resource]||(s[r.resource]=[]),s[r.resource].push(r),s),{}),C=s=>{var r;return o[s]!==void 0?o[s]:((r=g[a])==null?void 0:r[s])||!1},B=s=>{const r=C(s);m(L(M({},o),{[s]:!r})),x(!0)},I=()=>{const s=Object.entries(o).map(([r,t])=>({permissionId:d.find(b=>b.name===r).id,granted:t}));u.mutate({role:a,permissions:s})},V=()=>{m({}),x(!1)};if(!$)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96",children:[e.jsx(f,{className:"h-24 w-24 text-red-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have permission to manage permissions."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Required role: Admin"})]});if(h)return e.jsx("div",{className:"flex justify-center items-center min-h-96",children:e.jsx(J,{})});const p=[{value:"supervisor",label:"Supervisor",color:"blue"},{value:"manager",label:"Manager",color:"purple"},{value:"noc",label:"NOC",color:"indigo"},{value:"technician",label:"Technician",color:"green"},{value:"customer_service",label:"Customer Service",color:"yellow"}],D={dashboard:"Dashboard",analytics:"Analytics",tickets:"Tickets",customers:"Customers",registrations:"Registrations",technicians:"Technicians",inventory:"Inventory",users:"Users",permissions:"Permissions",reports:"Reports"},Q={view:"View",create:"Create",edit:"Edit",delete:"Delete",assign:"Assign",close:"Close",verify:"Verify",approve:"Approve",reject:"Reject",schedule:"Schedule",transactions:"Transactions",reset_password:"Reset Password",manage:"Manage",export:"Export"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(v,{className:"h-8 w-8 mr-3 text-purple-600"}),"Permission Management"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure role-based access control for the system"})]}),e.jsxs("button",{onClick:()=>z(),disabled:h,className:"btn-secondary",children:[e.jsx(K,{className:`h-4 w-4 mr-2 ${h?"animate-spin":""}`}),"Refresh"]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Z,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"About Permissions:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Admin"})," role always has full access to all features"]}),e.jsx("li",{children:"Customize permissions for Supervisor, Technician, and Customer Service roles"}),e.jsx("li",{children:"Changes take effect immediately after saving"}),e.jsx("li",{children:"Be careful when revoking permissions - it may affect user workflows"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Role to Manage"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:p.map(s=>e.jsx("button",{onClick:()=>{w?window.confirm("You have unsaved changes. Are you sure you want to switch roles?")&&(y(s.value),m({}),x(!1)):y(s.value)},className:`p-4 rounded-lg border-2 transition-all ${a===s.value?`border-${s.color}-500 bg-${s.color}-50`:"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.label}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Object.values(g[s.value]||{}).filter(Boolean).length," permissions"]})]}),a===s.value&&e.jsx(E,{className:`h-6 w-6 text-${s.color}-600`})]})},s.value))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Permissions for ",(P=p.find(s=>s.value===a))==null?void 0:P.label]}),w&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-orange-600 font-medium flex items-center",children:[e.jsx(f,{className:"h-4 w-4 mr-1"}),"Unsaved changes"]}),e.jsx("button",{onClick:V,className:"btn-secondary text-sm",children:"Reset"}),e.jsx("button",{onClick:I,disabled:u.isLoading,className:"btn-primary text-sm",children:u.isLoading?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]}),e.jsx("div",{className:"p-6 space-y-6",children:Object.entries(O).map(([s,r])=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5 border border-gray-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(v,{className:"h-5 w-5 mr-2 text-blue-600"}),D[s]||s]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:r.map(t=>{const n=C(t.name),b=o[t.name]!==void 0;return e.jsxs("div",{className:`flex items-center justify-between p-3 bg-white rounded-lg border-2 transition-all ${b?"border-orange-300 bg-orange-50":n?"border-green-200 hover:border-green-300":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"flex items-center flex-1",children:e.jsxs("label",{className:"flex items-center cursor-pointer flex-1",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>B(t.name),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 cursor-pointer"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Q[t.action]||t.action}),e.jsx("p",{className:"text-xs text-gray-500",children:t.description})]})]})}),n?e.jsx(E,{className:"h-5 w-5 text-green-600 flex-shrink-0 ml-2"}):e.jsx(se,{className:"h-5 w-5 text-gray-300 flex-shrink-0 ml-2"})]},t.id)})})]},s))})]}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-6 border border-purple-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(v,{className:"h-6 w-6 text-purple-600 mt-1 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Permission Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[p.map(s=>{const r=g[s.value]||{},t=Object.values(r).filter(Boolean).length,n=d.length;return e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:s.label}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:[t,e.jsxs("span",{className:"text-sm text-gray-500",children:["/",n]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Math.round(t/n*100),"% access"]})]},s.value)}),e.jsxs("div",{className:"bg-purple-100 rounded-lg p-4 border border-purple-300",children:[e.jsx("p",{className:"text-xs text-purple-700 font-medium",children:"Admin"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[d.length,e.jsxs("span",{className:"text-sm text-purple-600",children:["/",d.length]})]}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"100% access (always)"})]})]})]})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(f,{className:"h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Admin role cannot be modified and always has full access"}),e.jsx("li",{children:"Removing critical permissions may prevent users from doing their jobs"}),e.jsx("li",{children:"Test permission changes with a test account before applying to all users"}),e.jsx("li",{children:"Permission changes take effect immediately - active users may need to refresh"})]})]})]})})]})};export{xe as default};
//# sourceMappingURL=PermissionsPage-BvfgRz_w.js.map
