var m=(l,i,n)=>new Promise((d,h)=>{var x=t=>{try{a(n.next(t))}catch(c){h(c)}},y=t=>{try{a(n.throw(t))}catch(c){h(c)}},a=t=>t.done?d(t.value):Promise.resolve(t.value).then(x,y);a((n=n.apply(l,i)).next())});import{j as e,a as p}from"./notifications-BhPKxeX5.js";import{r as Q}from"./react-vendor-BQ7pSkNi.js";import{a as R,b,u as f}from"./react-query-B7OIdD7u.js";import{R as k,an as N,N as q,e as L,aC as S,T as v,aD as T,x as _,z as u}from"./ui-vendor-ng1X_mIA.js";import"./charts-CREYXqqm.js";const z=()=>{const l=R(),[i,n]=Q.useState(!1),{data:d,isLoading:h}=b("performance-query-stats",()=>m(void 0,null,function*(){return(yield p.get("/performance/query-stats")).data}),{refetchInterval:i?5e3:!1,refetchOnWindowFocus:!1}),{data:x,isLoading:y}=b("performance-cache-stats",()=>m(void 0,null,function*(){return(yield p.get("/performance/cache-stats")).data}),{refetchInterval:i?5e3:!1,refetchOnWindowFocus:!1}),a=(d==null?void 0:d.data)||[],t=(x==null?void 0:x.data)||{},c=f(()=>m(void 0,null,function*(){return(yield p.post("/performance/cache-clear")).data}),{onSuccess:()=>{l.invalidateQueries("performance-cache-stats"),u.success("Cache cleared successfully")},onError:s=>{var r,o;u.error(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to clear cache")}}),g=f(()=>m(void 0,null,function*(){return(yield p.post("/performance/reset-stats")).data}),{onSuccess:()=>{l.invalidateQueries("performance-query-stats"),u.success("Query stats reset successfully")},onError:s=>{var r,o;u.error(((o=(r=s.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to reset stats")}}),w=a.filter(s=>s.duration_ms>500),C=a.length>0?a.reduce((s,r)=>s+r.duration_ms,0)/a.length:0,j=s=>s<1e3?`${Math.round(s)}ms`:`${(s/1e3).toFixed(2)}s`;return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Performance Monitoring"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor system performance and optimize"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:s=>n(s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Auto Refresh (5s)"})]}),e.jsxs("button",{onClick:()=>{l.invalidateQueries("performance-query-stats"),l.invalidateQueries("performance-cache-stats")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Queries"}),e.jsx(N,{className:"h-5 w-5 text-blue-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.length}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Tracked queries"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Avg Query Time"}),e.jsx(q,{className:"h-5 w-5 text-green-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:j(C)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Average duration"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Slow Queries"}),e.jsx(L,{className:"h-5 w-5 text-orange-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:w.length}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"> 500ms"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Cache Status"}),e.jsx(S,{className:"h-5 w-5 text-purple-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t.enabled?"Active":"Inactive"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[t.total_keys||0," cached keys"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Cache Management"}),e.jsxs("button",{onClick:()=>c.mutate(),disabled:c.isLoading,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center space-x-2",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{children:c.isLoading?"Clearing...":"Clear All Cache"})]})]}),t.enabled?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Cache Keys"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:t.total_keys||0})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Status"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:"Online"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-purple-900",children:"Backend"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700",children:"Redis"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"ðŸ’¡ Cached endpoints: /api/packages, /api/pricelist, /api/equipment, /api/odp, /api/service-types, /api/service-categories"})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"Redis cache is not enabled or not connected"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Queries"}),e.jsxs("button",{onClick:()=>g.mutate(),disabled:g.isLoading,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 flex items-center space-x-2",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{children:g.isLoading?"Resetting...":"Reset Stats"})]})]}),h?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading query stats..."})]}):a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(N,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"No query statistics available"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Time"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Query"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-gray-700",children:"Duration"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-gray-700",children:"Rows"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Route"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"User"})]})}),e.jsx("tbody",{children:a.slice(0,20).map((s,r)=>e.jsxs("tr",{className:`border-b border-gray-100 ${s.duration_ms>500?"bg-red-50":s.duration_ms>200?"bg-yellow-50":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"py-3 px-4 text-xs text-gray-600",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsxs("td",{className:"py-3 px-4 text-xs font-mono text-gray-900 max-w-md truncate",children:[s.query.substring(0,100),"..."]}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`text-sm font-semibold ${s.duration_ms>500?"text-red-600":s.duration_ms>200?"text-orange-600":"text-green-600"}`,children:j(s.duration_ms)})}),e.jsx("td",{className:"py-3 px-4 text-sm text-center text-gray-900",children:s.rows||"-"}),e.jsx("td",{className:"py-3 px-4 text-xs text-gray-600",children:s.route}),e.jsx("td",{className:"py-3 px-4 text-xs text-gray-600",children:s.user})]},r))})]})})]})]})};export{z as default};
//# sourceMappingURL=PerformanceDashboard-CXX5tcIJ.js.map
