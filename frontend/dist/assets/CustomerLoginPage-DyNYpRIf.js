var b=(h,g,o)=>new Promise((a,u)=>{var l=t=>{try{r(o.next(t))}catch(c){u(c)}},i=t=>{try{r(o.throw(t))}catch(c){u(c)}},r=t=>t.done?a(t.value):Promise.resolve(t.value).then(l,i);r((o=o.apply(h,g)).next())});import{j as e,a as f}from"./notifications-Dggueh-l.js";import{u as N,r as x}from"./react-vendor-BQ7pSkNi.js";import{n as j,p as v,aI as w,aU as S,z as p}from"./ui-vendor-CO1ReX4_.js";import"./react-query-B7OIdD7u.js";import"./charts-CREYXqqm.js";const K=()=>{const h=N(),[g,o]=x.useState("phone"),[a,u]=x.useState(""),[l,i]=x.useState(""),[r,t]=x.useState(!1),c=n=>b(void 0,null,function*(){var d,m;n.preventDefault(),t(!0),console.log("üîµ handleRequestOTP called, phone:",a);try{console.log("üîµ Sending request to /customer-portal/request-otp");const s=yield f.post("/customer-portal/request-otp",{phone:a});console.log("üîµ Full response:",s),console.log("üîµ response.success:",s.success),console.log("üîµ response.data:",s.data),s.success?(console.log("üîµ Success! Showing toast and changing step to OTP"),p.success("Kode OTP telah dikirim ke WhatsApp Anda!"),o("otp"),console.log("üîµ Step changed to: otp")):console.log("‚ùå response.success is false or undefined")}catch(s){console.error("‚ùå Error:",s),p.error(((m=(d=s.response)==null?void 0:d.data)==null?void 0:m.message)||"Gagal mengirim OTP")}finally{t(!1),console.log("üîµ Loading set to false")}}),y=n=>b(void 0,null,function*(){var d,m;n.preventDefault(),t(!0);try{const s=yield f.post("/customer-portal/verify-otp",{phone:a,otp:l});s.data.success&&(localStorage.setItem("customerToken",s.data.data.token),localStorage.setItem("customerData",JSON.stringify(s.data.data.customer)),p.success("Login berhasil!"),h("/customer/dashboard"))}catch(s){p.error(((m=(d=s.response)==null?void 0:d.data)==null?void 0:m.message)||"Kode OTP salah atau expired"),i("")}finally{t(!1)}});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-600 to-green-600 rounded-2xl mb-4",children:e.jsx(j,{className:"h-10 w-10 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"AGLIS Customer Portal"}),e.jsx("p",{className:"text-gray-600",children:"Login dengan nomor WhatsApp Anda"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[g==="phone"?e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nomor WhatsApp"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"tel",value:a,onChange:n=>u(n.target.value),placeholder:"08123456789",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Gunakan nomor WhatsApp yang terdaftar sebagai customer"})]}),e.jsx("button",{type:"submit",disabled:r||!a,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-green-600 text-white rounded-lg hover:from-blue-700 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Mengirim OTP..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-5 w-5"}),e.jsx("span",{children:"Kirim Kode OTP"})]})})]}):e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-3",children:e.jsx(w,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Masukkan Kode OTP"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Kode telah dikirim ke WhatsApp ",a.replace(/(\d{4})\d+(\d{3})/,"$1****$2")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kode OTP (6 digit)"}),e.jsx("input",{type:"text",value:l,onChange:n=>i(n.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"w-full px-4 py-3 text-center text-2xl tracking-widest border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:6,autoFocus:!0,required:!0})]}),e.jsx("button",{type:"submit",disabled:r||l.length!==6,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-green-600 text-white rounded-lg hover:from-blue-700 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Memverifikasi..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("span",{children:"Login"})]})}),e.jsx("button",{type:"button",onClick:()=>{o("phone"),i("")},className:"w-full text-sm text-gray-600 hover:text-gray-900",children:"‚Üê Kembali ke input nomor"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:["Butuh bantuan?"," ",e.jsx("a",{href:"https://wa.me/628179380800",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Hubungi Customer Service"})]})})]}),e.jsx("div",{className:"mt-6 text-center text-sm text-gray-600",children:e.jsx("p",{children:"¬© 2025 AGLIS Net. All rights reserved."})})]})})};export{K as default};
//# sourceMappingURL=CustomerLoginPage-DyNYpRIf.js.map
