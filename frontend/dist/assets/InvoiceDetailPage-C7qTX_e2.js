var R=Object.defineProperty,A=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var _=(a,r,i)=>r in a?R(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,o=(a,r)=>{for(var i in r||(r={}))B.call(r,i)&&_(a,i,r[i]);if(v)for(var i of v(r))E.call(r,i)&&_(a,i,r[i]);return a},x=(a,r)=>A(a,M(r));import{j as e}from"./notifications-ZCsIKyPs.js";import{e as L,u as O,r as w}from"./react-vendor-BQ7pSkNi.js";import{a as $,b as q,u as y}from"./react-query-B7OIdD7u.js";import{F as Q,s as z,a6 as U,aE as V,P as G,aT as H,T as W,a as J,C as K,a2 as X,z as m}from"./ui-vendor-DY8BSMik.js";import{j,k as Y}from"./customers-CxiUKGDL.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";import"./forms-Dmkgx8TD.js";const de=()=>{var N;const{id:a}=L(),r=O(),i=$(),[P,g]=w.useState(!1),[n,u]=w.useState({amount:"",payment_method:"bank_transfer",payment_channel:"",payment_date:new Date().toISOString().split("T")[0],reference_number:"",notes:""}),{data:b,isLoading:C}=q(["invoice",a],()=>j.getById(a),{enabled:!!a}),s=(b==null?void 0:b.data)||null,D=y(()=>j.markAsSent(a),{onSuccess:()=>{i.invalidateQueries(["invoice",a]),m.success("Invoice sent successfully")},onError:t=>{var d,c;m.error(((c=(d=t.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to send invoice")}}),S=y(()=>j.delete(a),{onSuccess:()=>{m.success("Invoice deleted successfully"),r("/invoices")},onError:t=>{var d,c;m.error(((c=(d=t.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to delete invoice")}}),p=y(t=>Y.create(x(o({},t),{invoice_id:parseInt(a),customer_id:s.customer_id,auto_verify:!0})),{onSuccess:()=>{i.invalidateQueries(["invoice",a]),g(!1),u({amount:"",payment_method:"bank_transfer",payment_channel:"",payment_date:new Date().toISOString().split("T")[0],reference_number:"",notes:""}),m.success("Payment recorded successfully")},onError:t=>{var d,c;m.error(((c=(d=t.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to record payment")}}),l=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),h=t=>t?new Date(t).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}):"-",k=t=>{const d={draft:{bg:"bg-gray-100",text:"text-gray-800",label:"Draft"},sent:{bg:"bg-blue-100",text:"text-blue-800",label:"Sent"},viewed:{bg:"bg-purple-100",text:"text-purple-800",label:"Viewed"},paid:{bg:"bg-green-100",text:"text-green-800",label:"Paid"},partial:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Partially Paid"},overdue:{bg:"bg-red-100",text:"text-red-800",label:"Overdue"},cancelled:{bg:"bg-gray-100",text:"text-gray-600",label:"Cancelled"}},c=d[t]||d.draft;return e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-semibold ${c.bg} ${c.text}`,children:c.label})},I=t=>{if(t.preventDefault(),!n.amount||parseFloat(n.amount)<=0){m.error("Please enter a valid amount");return}if(parseFloat(n.amount)>s.outstanding_amount){m.error("Payment amount cannot exceed outstanding amount");return}p.mutate(x(o({},n),{amount:parseFloat(n.amount)}))},T=()=>{window.confirm(`Are you sure you want to delete invoice ${s.invoice_number}?`)&&S.mutate()},F=()=>{window.confirm(`Send invoice ${s.invoice_number} to customer?`)&&D.mutate()};if(C)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading invoice..."})]})});if(!s)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Invoice not found"}),e.jsx("button",{onClick:()=>r("/invoices"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Invoices"})]})});const f=new Date(s.due_date)<new Date&&s.status!=="paid";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>r("/invoices"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{children:"Back to Invoices"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.invoice_number}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Created on ",h(s.created_at)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[k(s.status),e.jsxs("div",{className:"flex space-x-2",children:[s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>r(`/invoices/${a}/edit`),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center space-x-2",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Send"})]})]}),s.status!=="paid"&&s.outstanding_amount>0&&e.jsxs("button",{onClick:()=>g(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:"Record Payment"})]}),e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",title:"Print",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("button",{onClick:T,className:"px-4 py-2 border border-red-300 rounded-lg text-red-700 hover:bg-red-50",title:"Delete",children:e.jsx(W,{className:"h-4 w-4"})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Bill To:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.customer_name}),s.customer_email&&e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_email}),s.customer_phone&&e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_phone}),s.customer_address&&e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_address})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Invoice Details:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Invoice Date:"}),e.jsx("span",{className:"font-medium",children:h(s.invoice_date)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Due Date:"}),e.jsx("span",{className:`font-medium ${f?"text-red-600":""}`,children:h(s.due_date)})]}),s.billing_period_start&&s.billing_period_end&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Billing Period:"}),e.jsxs("span",{className:"font-medium",children:[h(s.billing_period_start)," - ",h(s.billing_period_end)]})]}),s.sent_at&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Sent:"}),e.jsx("span",{className:"font-medium",children:h(s.sent_at)})]})]})]})]}),f&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start space-x-2",children:[e.jsx(J,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-900",children:"Invoice Overdue"}),e.jsxs("p",{className:"text-sm text-red-700",children:["This invoice is ",Math.floor((new Date-new Date(s.due_date))/(1e3*60*60*24))," days overdue"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Line Items"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase",children:"Qty"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-gray-700 uppercase",children:"Unit Price"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-gray-700 uppercase",children:"Discount"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-gray-700 uppercase",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:(N=s.line_items)==null?void 0:N.map((t,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.description}),t.item_type&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 capitalize",children:t.item_type.replace("_"," ")})]})}),e.jsx("td",{className:"px-6 py-4 text-center text-sm text-gray-900",children:t.quantity}),e.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-900",children:l(t.unit_price)}),e.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-900",children:t.discount_amount>0?l(t.discount_amount):"-"}),e.jsx("td",{className:"px-6 py-4 text-right font-semibold text-gray-900",children:l(t.line_total)})]},d))})]})}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-2 max-w-sm ml-auto",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:l(s.subtotal)})]}),s.discount_amount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{className:"font-medium",children:["-",l(s.discount_amount)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Tax (",s.tax_percentage,"%):"]}),e.jsx("span",{className:"font-medium",children:l(s.tax_amount)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t border-gray-300 pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:l(s.total_amount)})]}),s.paid_amount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Paid:"}),e.jsxs("span",{className:"font-medium",children:["-",l(s.paid_amount)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-orange-600 border-t border-gray-300 pt-2",children:[e.jsx("span",{children:"Outstanding:"}),e.jsx("span",{children:l(s.outstanding_amount)})]})]})]})})]}),(s.notes||s.payment_terms)&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Information"}),s.notes&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})]}),s.payment_terms&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Payment Terms:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.payment_terms})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg shadow-lg p-6 text-white",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Invoice Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-blue-100",children:"Total Amount:"}),e.jsx("span",{className:"text-2xl font-bold",children:l(s.total_amount)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-blue-100",children:"Paid:"}),e.jsx("span",{className:"text-xl font-semibold",children:l(s.paid_amount)})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-blue-500",children:[e.jsx("span",{className:"text-blue-100",children:"Outstanding:"}),e.jsx("span",{className:"text-2xl font-bold",children:l(s.outstanding_amount)})]})]}),s.status==="paid"&&e.jsxs("div",{className:"mt-4 p-3 bg-green-500 bg-opacity-30 rounded-lg flex items-center space-x-2",children:[e.jsx(K,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Fully Paid"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment History"})}),s.payments&&s.payments.length>0?e.jsx("div",{className:"divide-y divide-gray-200",children:s.payments.map(t=>e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:l(t.amount)}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.payment_method.replace("_"," ").toUpperCase(),t.payment_channel&&` - ${t.payment_channel}`]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:h(t.payment_date)}),t.reference_number&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Ref: ",t.reference_number]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.status})]})},t.id))}):e.jsxs("div",{className:"px-6 py-8 text-center text-gray-500",children:[e.jsx(X,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"No payments recorded"})]})]})]})]}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Record Payment"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Outstanding: ",l(s.outstanding_amount)]})]}),e.jsxs("form",{onSubmit:I,className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Amount *"}),e.jsx("input",{type:"number",step:"0.01",value:n.amount,onChange:t=>u(x(o({},n),{amount:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method *"}),e.jsxs("select",{value:n.payment_method,onChange:t=>u(x(o({},n),{payment_method:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"debit_card",children:"Debit Card"}),e.jsx("option",{value:"e_wallet",children:"E-Wallet"}),e.jsx("option",{value:"virtual_account",children:"Virtual Account"}),e.jsx("option",{value:"qris",children:"QRIS"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Channel"}),e.jsx("input",{type:"text",value:n.payment_channel,onChange:t=>u(x(o({},n),{payment_channel:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., BCA, Mandiri, GoPay"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Date *"}),e.jsx("input",{type:"date",value:n.payment_date,onChange:t=>u(x(o({},n),{payment_date:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number"}),e.jsx("input",{type:"text",value:n.reference_number,onChange:t=>u(x(o({},n),{reference_number:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Transaction/Receipt number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:n.notes,onChange:t=>u(x(o({},n),{notes:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",placeholder:"Additional payment notes..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",disabled:p.isLoading,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",disabled:p.isLoading,children:p.isLoading?"Recording...":"Record Payment"})]})]})]})})]})};export{de as default};
//# sourceMappingURL=InvoiceDetailPage-C7qTX_e2.js.map
