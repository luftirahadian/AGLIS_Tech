var O=Object.defineProperty,R=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var P=(a,t,n)=>t in a?O(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,m=(a,t)=>{for(var n in t||(t={}))K.call(t,n)&&P(a,n,t[n]);if(L)for(var n of L(t))Z.call(t,n)&&P(a,n,t[n]);return a},u=(a,t)=>R(a,H(t));var p=(a,t,n)=>new Promise((i,f)=>{var y=g=>{try{j(n.next(g))}catch(c){f(c)}},C=g=>{try{j(n.throw(g))}catch(c){f(c)}},j=g=>g.done?i(g.value):Promise.resolve(g.value).then(y,C);j((n=n.apply(a,t)).next())});import{a as b,j as e}from"./notifications-ZCsIKyPs.js";import{r as h}from"./react-vendor-BQ7pSkNi.js";import{a as X,b as J,u as _}from"./react-query-B7OIdD7u.js";import{n as k,P as V,C as Y,b as ee,aE as z,c as se,T as ae,X as te,a as re,z as x}from"./ui-vendor-DY8BSMik.js";import{L as ne}from"./customers-CxiUKGDL.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";import"./forms-Dmkgx8TD.js";const v={getAll:(...t)=>p(void 0,[...t],function*(a={}){const n=new URLSearchParams(a).toString();return b.get(`/whatsapp-groups?${n}`)}),getById:a=>p(void 0,null,function*(){return b.get(`/whatsapp-groups/${a}`)}),create:a=>p(void 0,null,function*(){return b.post("/whatsapp-groups",a)}),update:(a,t)=>p(void 0,null,function*(){return b.put(`/whatsapp-groups/${a}`,t)}),delete:a=>p(void 0,null,function*(){return b.delete(`/whatsapp-groups/${a}`)}),testSend:(a,t)=>p(void 0,null,function*(){return b.post(`/whatsapp-groups/${a}/test`,{message:t})}),getLogs:(a,t=50)=>p(void 0,null,function*(){return b.get(`/whatsapp-groups/${a}/logs?limit=${t}`)})},pe=()=>{var W;const a=X(),[t,n]=h.useState(!1),[i,f]=h.useState(null),[y,C]=h.useState("all"),[j,g]=h.useState(!1),[c,D]=h.useState(null),[N,w]=h.useState(""),[r,d]=h.useState({name:"",description:"",category:"technicians",work_zone:"",phone_number:"",group_chat_id:"",notification_types:["ticket_assigned","new_ticket","sla_warning"],priority_filter:"normal",is_active:!0});h.useEffect(()=>{t&&i?d({name:i.name||"",description:i.description||"",category:i.category||"technicians",work_zone:i.work_zone||"",phone_number:i.phone_number||"",group_chat_id:i.group_chat_id||"",notification_types:i.notification_types||[],priority_filter:i.priority_filter||"normal",is_active:i.is_active!==void 0?i.is_active:!0}):t&&!i&&d({name:"",description:"",category:"technicians",work_zone:"",phone_number:"",group_chat_id:"",notification_types:["ticket_assigned","new_ticket","sla_warning"],priority_filter:"normal",is_active:!0})},[t,i]);const{data:S,isLoading:$}=J(["whatsapp-groups",y],()=>v.getAll(y!=="all"?{category:y}:{}),{onError:s=>{var l,o;x.error(((o=(l=s.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to load WhatsApp groups")}}),E=((W=S==null?void 0:S.data)==null?void 0:W.groups)||[],A=_(s=>v.create(s),{onSuccess:()=>{x.success("WhatsApp group created successfully!"),a.invalidateQueries(["whatsapp-groups"]),n(!1)},onError:s=>{var l,o;x.error(((o=(l=s.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to create group")}}),T=_(({id:s,data:l})=>v.update(s,l),{onSuccess:()=>{x.success("WhatsApp group updated successfully!"),a.invalidateQueries(["whatsapp-groups"]),n(!1)},onError:s=>{var l,o;x.error(((o=(l=s.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to update group")}}),F=_(s=>v.delete(s),{onSuccess:()=>{x.success("WhatsApp group deleted successfully"),a.invalidateQueries(["whatsapp-groups"])},onError:s=>{var l,o;x.error(((o=(l=s.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to delete group")}}),M=_(({id:s,message:l})=>v.testSend(s,l),{onSuccess:()=>{x.success("Test message sent successfully! Check your WhatsApp group."),g(!1),w("")},onError:s=>{var l,o;x.error(((o=(l=s.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to send test message")}}),I=s=>{if(s.preventDefault(),!r.name||!r.category){x.error("Name and category are required");return}i?T.mutate({id:i.id,data:r}):A.mutate(r)},G=s=>{window.confirm(`Hapus WhatsApp group "${s.name}"?`)&&F.mutate(s.id)},B=s=>{D(s),w(`ðŸ§ª *TEST MESSAGE*

Halo ${s.name}!

Ini adalah test message dari AGLIS Management System.

Waktu: ${new Date().toLocaleString("id-ID")}

âœ… Jika Anda menerima pesan ini, grup sudah terkonfigurasi dengan benar!`),g(!0)},q=()=>{if(!N.trim()){x.error("Message cannot be empty");return}M.mutate({id:c.id,message:N})},Q=s=>({technicians:"bg-blue-100 text-blue-700",supervisors:"bg-purple-100 text-purple-700",managers:"bg-indigo-100 text-indigo-700",noc:"bg-orange-100 text-orange-700",customer_service:"bg-green-100 text-green-700",all:"bg-gray-100 text-gray-700"})[s]||"bg-gray-100 text-gray-700",U=[{value:"ticket_assigned",label:"Ticket Assigned"},{value:"new_ticket",label:"New Ticket"},{value:"ticket_completed",label:"Ticket Completed"},{value:"sla_warning",label:"SLA Warning"},{value:"urgent_alert",label:"Urgent Alert"},{value:"escalation",label:"Escalation"},{value:"daily_summary",label:"Daily Summary"},{value:"weekly_report",label:"Weekly Report"},{value:"system_alert",label:"System Alert"},{value:"performance_alert",label:"Performance Alert"},{value:"new_registration",label:"New Registration"},{value:"customer_complaint",label:"Customer Complaint"},{value:"payment_alert",label:"Payment Alert"},{value:"kpi_alert",label:"KPI Alert"},{value:"critical_incident",label:"Critical Incident"},{value:"outage",label:"Outage"}];return $?e.jsx(ne,{}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(k,{className:"h-7 w-7 mr-3 text-green-600"}),"WhatsApp Groups"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Kelola grup WhatsApp untuk notifikasi tim"})]}),e.jsxs("button",{onClick:()=>{f(null),n(!0)},className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-sm",children:[e.jsx(V,{className:"h-5 w-5 mr-2"}),"Tambah Group"]})]}),e.jsx("div",{className:"mt-4 flex gap-2 flex-wrap",children:["all","technicians","supervisors","managers","noc","customer_service"].map(s=>e.jsx("button",{onClick:()=>C(s),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${y===s?"bg-green-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:s==="all"?"Semua":s.replace("_"," ").charAt(0).toUpperCase()+s.slice(1).replace("_"," ")},s))})]}),E.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[e.jsx(k,{className:"h-16 w-16 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Belum ada WhatsApp group yang terdaftar"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(s=>{var l;return e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition-shadow p-5 border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(k,{className:"h-5 w-5 mr-2 text-green-600"}),s.name]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]}),e.jsxs("div",{className:"flex gap-1",children:[s.is_verified&&e.jsx(Y,{className:"h-5 w-5 text-green-600",title:"Verified"}),!s.is_active&&e.jsx(ee,{className:"h-5 w-5 text-red-600",title:"Inactive"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Q(s.category)}`,children:s.category.replace("_"," ")})]}),s.work_zone&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Work Zone:"}),e.jsx("span",{className:"font-medium text-gray-900 capitalize",children:s.work_zone})]}),s.phone_number&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsx("span",{className:"font-mono text-gray-900",children:s.phone_number})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Notification Types:"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[((l=s.notification_types)==null?void 0:l.length)||0," types"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>B(s),className:"flex-1 flex items-center justify-center px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors text-sm font-medium",disabled:!s.phone_number&&!s.group_chat_id,title:!s.phone_number&&!s.group_chat_id?"No phone/chat ID configured":"Send test message",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Test"]}),e.jsx("button",{onClick:()=>{f(s),n(!0)},className:"flex items-center px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm",title:"Edit group",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>G(s),className:"flex items-center px-3 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors text-sm",title:"Delete group",children:e.jsx(ae,{className:"h-4 w-4"})})]})]},s.id)})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(k,{className:"h-5 w-5 mr-2 text-green-600"}),i?"Edit WhatsApp Group":"Tambah WhatsApp Group"]}),e.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(te,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nama Group ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.name,onChange:s=>d(u(m({},r),{name:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Contoh: Teknisi Purwakarta",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi"}),e.jsx("textarea",{value:r.description,onChange:s=>d(u(m({},r),{description:s.target.value})),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Deskripsi singkat tentang group ini..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.category,onChange:s=>d(u(m({},r),{category:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[e.jsx("option",{value:"technicians",children:"Technicians"}),e.jsx("option",{value:"supervisors",children:"Supervisors"}),e.jsx("option",{value:"managers",children:"Managers"}),e.jsx("option",{value:"noc",children:"NOC"}),e.jsx("option",{value:"customer_service",children:"Customer Service"}),e.jsx("option",{value:"all",children:"All"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Work Zone"}),e.jsxs("select",{value:r.work_zone,onChange:s=>d(u(m({},r),{work_zone:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"All Zones"}),e.jsx("option",{value:"karawang",children:"Karawang"}),e.jsx("option",{value:"bekasi",children:"Bekasi"}),e.jsx("option",{value:"cikampek",children:"Cikampek"}),e.jsx("option",{value:"purwakarta",children:"Purwakarta"}),e.jsx("option",{value:"subang",children:"Subang"}),e.jsx("option",{value:"bandung",children:"Bandung"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"text",value:r.phone_number,onChange:s=>d(u(m({},r),{phone_number:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"628123456789"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: 628xxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Group Chat ID"}),e.jsx("input",{type:"text",value:r.group_chat_id,onChange:s=>d(u(m({},r),{group_chat_id:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Optional"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notification Types"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:U.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.notification_types.includes(s.value),onChange:l=>{l.target.checked?d(u(m({},r),{notification_types:[...r.notification_types,s.value]})):d(u(m({},r),{notification_types:r.notification_types.filter(o=>o!==s.value)}))},className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority Filter"}),e.jsxs("select",{value:r.priority_filter,onChange:s=>d(u(m({},r),{priority_filter:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum priority untuk notifikasi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("label",{className:"flex items-center space-x-2 mt-2",children:[e.jsx("input",{type:"checkbox",checked:r.is_active,onChange:s=>d(u(m({},r),{is_active:s.target.checked})),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Active"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:A.isLoading||T.isLoading,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:A.isLoading||T.isLoading?"Saving...":i?"Update":"Tambah"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-lg w-full p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(z,{className:"h-5 w-5 mr-2 text-green-600"}),"Test Send - ",c==null?void 0:c.name]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Message:"}),e.jsx("textarea",{value:N,onChange:s=>w(s.target.value),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 font-mono text-sm",placeholder:"Enter test message..."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx(re,{className:"h-4 w-4 inline mr-1"}),"Pesan akan dikirim ke: ",e.jsx("strong",{children:(c==null?void 0:c.phone_number)||(c==null?void 0:c.group_chat_id)||"-"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{g(!1),w("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Batal"}),e.jsx("button",{onClick:q,disabled:M.isLoading||!N.trim(),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:M.isLoading?"Sending...":"Send Test"})]})]})})]})};export{pe as default};
//# sourceMappingURL=WhatsAppGroupsPage-Bvqg7Vyq.js.map
