import{j as e}from"./notifications-Dt-KZFDl.js";import{u as V,r as g}from"./react-vendor-BQ7pSkNi.js";import{a as K,b as I,u as P}from"./react-query-B7OIdD7u.js";import{F as D,P as U,$ as G,C as $,N as O,a as F,S as H,E as Q,a6 as E,aF as A,T as M,z as l}from"./ui-vendor-Ccu0xyBn.js";import{s as x,j as y}from"./customers-CPkOMPXe.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";import"./forms-Dmkgx8TD.js";const ae=()=>{var _,C;const m=V(),r=K(),[c,o]=g.useState(1),[h,N]=g.useState(""),[b,f]=g.useState(""),[v,w]=g.useState(!1),{data:d,isLoading:T}=I(["invoices",c,h,b,v],()=>y.getAll({page:c,limit:20,search:h,status:b,overdue_only:v}),{keepPreviousData:!0}),{data:j}=I(["invoice-statistics"],()=>y.getStatistics()),k=((_=d==null?void 0:d.data)==null?void 0:_.invoices)||[],u=((C=d==null?void 0:d.data)==null?void 0:C.pagination)||{},n=(j==null?void 0:j.data)||{};g.useEffect(()=>{const t=a=>{console.log("ðŸ’° Invoice updated via Socket.IO:",a),r.invalidateQueries(["invoices"]),r.invalidateQueries(["invoice-statistics"]),a!=null&&a.invoice&&l.success(`Invoice ${a.invoice.invoice_number} telah diupdate!`,{icon:"ðŸ’°",duration:3e3})},s=a=>{console.log("ðŸ’° New invoice created:",a),r.invalidateQueries(["invoices"]),r.invalidateQueries(["invoice-statistics"]),a!=null&&a.invoice&&l.success(`Invoice baru: ${a.invoice.invoice_number}`,{icon:"âœ¨",duration:4e3})},i=a=>{console.log("ðŸ’µ Payment received:",a),r.invalidateQueries(["invoices"]),r.invalidateQueries(["invoice-statistics"]),a!=null&&a.payment&&l.success(`Pembayaran diterima: Rp ${(a.payment.amount||0).toLocaleString("id-ID")}`,{icon:"ðŸ’µ",duration:4e3})};return x.on("invoice_updated",t),x.on("invoice_created",s),x.on("payment_received",i),console.log("ðŸ’° [InvoicesPage] Socket.IO listeners registered"),()=>{x.off("invoice_updated",t),x.off("invoice_created",s),x.off("payment_received",i),console.log("ðŸ’° [InvoicesPage] Socket.IO listeners removed")}},[r]);const L=P(t=>y.delete(t),{onSuccess:()=>{r.invalidateQueries("invoices"),r.invalidateQueries("invoice-statistics"),l.success("Invoice deleted successfully")},onError:t=>{var s,i;l.error(((i=(s=t.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to delete invoice")}}),R=P(t=>y.markAsSent(t),{onSuccess:()=>{r.invalidateQueries("invoices"),l.success("Invoice marked as sent")},onError:t=>{var s,i;l.error(((i=(s=t.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to send invoice")}}),z=t=>{const s={draft:{bg:"bg-gray-100",text:"text-gray-800",icon:E},sent:{bg:"bg-blue-100",text:"text-blue-800",icon:A},viewed:{bg:"bg-purple-100",text:"text-purple-800",icon:Q},paid:{bg:"bg-green-100",text:"text-green-800",icon:$},partial:{bg:"bg-yellow-100",text:"text-yellow-800",icon:O},overdue:{bg:"bg-red-100",text:"text-red-800",icon:F},cancelled:{bg:"bg-gray-100",text:"text-gray-600",icon:M}},i=s[t]||s.draft,a=i.icon;return e.jsxs("span",{className:`inline-flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${i.bg} ${i.text}`,children:[e.jsx(a,{className:"h-3 w-3"}),e.jsx("span",{className:"capitalize",children:t})]})},p=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),S=t=>t?new Date(t).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-",q=t=>{window.confirm(`Delete invoice ${t.invoice_number}?`)&&L.mutate(t.id)},B=t=>{window.confirm(`Mark invoice ${t.invoice_number} as sent?`)&&R.mutate(t.id)};return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(D,{className:"h-7 w-7 text-blue-600"}),e.jsx("span",{children:"Invoices"})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage customer invoices and billing"})]}),e.jsxs("button",{onClick:()=>m("/invoices/new"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{children:"Create Invoice"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Billed"}),e.jsx(G,{className:"h-5 w-5 text-blue-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p(n.total_billed||0)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n.total_invoices||0," invoices"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Paid"}),e.jsx($,{className:"h-5 w-5 text-green-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p(n.total_paid||0)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n.paid_count||0," paid"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Outstanding"}),e.jsx(O,{className:"h-5 w-5 text-orange-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p(n.total_outstanding||0)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n.pending_count||0," pending"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Overdue"}),e.jsx(F,{className:"h-5 w-5 text-red-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.overdue_count||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Needs attention"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search invoices...",value:h,onChange:t=>{N(t.target.value),o(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("select",{value:b,onChange:t=>{f(t.target.value),o(1)},className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"viewed",children:"Viewed"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs("label",{className:"flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:t=>{w(t.target.checked),o(1)},className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Overdue Only"})]}),(h||b||v)&&e.jsx("button",{onClick:()=>{N(""),f(""),w(!1),o(1)},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Clear Filters"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[T?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading invoices..."})]}):k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No invoices found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Invoice #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Due Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Outstanding"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:k.map(t=>e.jsxs("tr",{onClick:()=>m(`/invoices/${t.id}`),className:"group cursor-pointer hover:bg-blue-50 hover:shadow-md hover:border-l-4 hover:border-l-blue-500 transition-all duration-200",title:"Klik untuk lihat detail invoice",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>m(`/invoices/${t.id}`),className:"text-blue-600 hover:text-blue-800 font-medium",children:t.invoice_number})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.customer_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.customer_email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:S(t.invoice_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:`text-sm ${new Date(t.due_date)<new Date&&t.status!=="paid"?"text-red-600 font-semibold":"text-gray-900"}`,children:S(t.due_date)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-gray-900",children:p(t.total_amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:`text-sm font-semibold ${t.outstanding_amount>0?"text-orange-600":"text-green-600"}`,children:p(t.outstanding_amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:z(t.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),m(`/invoices/${t.id}`)},className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"View",children:e.jsx(Q,{className:"h-4 w-4"})}),t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),m(`/invoices/${t.id}/edit`)},className:"p-1 text-gray-600 hover:bg-gray-50 rounded",title:"Edit",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),B(t)},className:"p-1 text-green-600 hover:bg-green-50 rounded",title:"Send",children:e.jsx(A,{className:"h-4 w-4"})})]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),q(t)},className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx(M,{className:"h-4 w-4"})})]})})]},t.id))})]})}),u.total_pages>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing page ",u.page," of ",u.total_pages,e.jsxs("span",{className:"ml-2 text-gray-500",children:["(",u.total," total invoices)"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>o(c-1),disabled:c===1,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>o(c+1),disabled:c===u.total_pages,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})]})]})};export{ae as default};
//# sourceMappingURL=InvoicesPage-CJk0hUQr.js.map
