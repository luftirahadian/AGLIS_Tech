var te=Object.defineProperty,ae=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var $=(t,a,l)=>a in t?te(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,d=(t,a)=>{for(var l in a||(a={}))ie.call(a,l)&&$(t,l,a[l]);if(Q)for(var l of Q(a))re.call(a,l)&&$(t,l,a[l]);return t},q=(t,a)=>ae(t,le(a));import{j as e}from"./notifications-DGuCqj8i.js";import{r as o}from"./react-vendor-BQ7pSkNi.js";import{u as B,a as ne,b as K}from"./react-query-B7OIdD7u.js";import{o as D}from"./tickets-CNvP3gyI.js";import{L as ce,K as A}from"./customers-IXR_7pB8.js";import{u as de}from"./forms-Dmkgx8TD.js";import{X as oe,z as _,P as z,p as S,S as me,a5 as xe,T as he,Q as ue,V as je,W as be,Y as ge,Z as pe}from"./ui-vendor-DFmaqm_b.js";import"./charts-CREYXqqm.js";import"./socket-BFcXWKeu.js";const fe=({odp:t,onClose:a,onSuccess:l})=>{const g=!!t,{register:c,handleSubmit:M,formState:{errors:r,isSubmitting:j},reset:O}=de({defaultValues:t||{name:"",location:"",area:"",latitude:"",longitude:"",total_ports:8,used_ports:0,status:"active",notes:""}});o.useEffect(()=>{t&&O(t)},[t,O]);const v=B(u=>g?D.update(t.id,u):D.create(u),{onSuccess:()=>{_.success(g?"ODP berhasil diupdate":"ODP berhasil ditambahkan"),l()},onError:u=>{var b,N;_.error(((N=(b=u.response)==null?void 0:b.data)==null?void 0:N.message)||"Terjadi kesalahan")}}),p=u=>{v.mutate(u)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:g?"Edit ODP":"Tambah ODP Baru"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(oe,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:M(p),className:"p-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Informasi Dasar"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nama ODP ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",d({type:"text",className:"input-field"},c("name",{required:"Nama ODP wajib diisi",minLength:{value:3,message:"Nama minimal 3 karakter"}}))),r.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Area"}),e.jsx("input",d({type:"text",className:"input-field",placeholder:"Contoh: Area A, Zona 1"},c("area")))]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Informasi Lokasi"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Lokasi ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",d({className:"input-field",rows:"2",placeholder:"Alamat lengkap lokasi ODP"},c("location",{required:"Lokasi wajib diisi"}))),r.location&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.location.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Latitude"}),e.jsx("input",d({type:"text",className:"input-field",placeholder:"-6.200000"},c("latitude",{pattern:{value:/^-?\d+\.?\d*$/,message:"Format latitude tidak valid"}}))),r.latitude&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.latitude.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Longitude"}),e.jsx("input",d({type:"text",className:"input-field",placeholder:"106.816666"},c("longitude",{pattern:{value:/^-?\d+\.?\d*$/,message:"Format longitude tidak valid"}}))),r.longitude&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.longitude.message})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Informasi Kapasitas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Total Ports ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",d({type:"number",className:"input-field",min:"1"},c("total_ports",{required:"Total ports wajib diisi",min:{value:1,message:"Minimal 1 port"},valueAsNumber:!0}))),r.total_ports&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.total_ports.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Used Ports"}),e.jsx("input",d({type:"number",className:"input-field",min:"0"},c("used_ports",{min:{value:0,message:"Tidak boleh negatif"},valueAsNumber:!0}))),r.used_ports&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.used_ports.message})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",q(d({className:"input-field"},c("status",{required:"Status wajib dipilih"})),{children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})),r.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.status.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan"}),e.jsx("textarea",d({className:"input-field",rows:"3",placeholder:"Catatan tambahan tentang ODP ini"},c("notes")))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:a,className:"btn-secondary",disabled:j,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:j,children:j?"Menyimpan...":g?"Update ODP":"Tambah ODP"})]})]})]})})},Ae=()=>{const[t,a]=o.useState(""),[l,g]=o.useState("all"),[c,M]=o.useState("all"),[r,j]=o.useState(!1),[O,v]=o.useState(null),[p,u]=o.useState("name"),[b,N]=o.useState("asc"),[i,m]=o.useState(1),[y,U]=o.useState(10),C=ne(),{data:f,isLoading:W}=K(["odps",l,c,t,p,b,i,y],()=>D.getAll({status:l!=="all"?l:void 0,area:c!=="all"?c:void 0,search:t||void 0,page:i,limit:y,sort_by:p,sort_order:b}),{refetchOnWindowFocus:!1,keepPreviousData:!0}),L=(f==null?void 0:f.data)||[],x=(f==null?void 0:f.pagination)||{},{data:F}=K("all-odps-stats",()=>D.getAll({page:1,limit:1e3}),{refetchOnWindowFocus:!1}),w=(F==null?void 0:F.data)||[],V=w.length,Z=w.filter(s=>s.status==="active").length,G=w.filter(s=>s.status==="full").length,X=w.filter(s=>s.status==="maintenance").length,Y=[...new Set(w.map(s=>s.area).filter(Boolean))],H=B(s=>D.delete(s),{onSuccess:()=>{_.success("ODP berhasil dihapus"),C.invalidateQueries("odps"),C.invalidateQueries("all-odps-stats")},onError:s=>{var n,h;_.error(((h=(n=s.response)==null?void 0:n.data)==null?void 0:h.message)||"Gagal menghapus ODP")}}),T=()=>{v(null),j(!0)},J=s=>{v(s),j(!0)},R=(s,n)=>{window.confirm(`Apakah Anda yakin ingin menghapus ODP "${n}"?`)&&H.mutate(s)},E=()=>{j(!1),v(null)},ee=()=>{C.invalidateQueries("odps"),C.invalidateQueries("all-odps-stats"),E()},k=s=>{p===s?N(b==="asc"?"desc":"asc"):(u(s),N("asc")),m(1)},P=s=>p!==s?e.jsx(be,{className:"h-4 w-4 text-gray-400"}):b==="asc"?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(pe,{className:"h-4 w-4"}),se=s=>{a(s.target.value),m(1)},I=(s,n)=>{s==="status"?g(n):s==="area"&&M(n),m(1)};return W&&i===1?e.jsx("div",{className:"flex justify-center items-center min-h-96",children:e.jsx(ce,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ODP Management"}),e.jsx("p",{className:"text-gray-600",children:"Kelola data Optical Distribution Point"})]}),e.jsxs("button",{onClick:T,className:"btn-primary",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Tambah ODP"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(A,{icon:S,title:"Total ODP",value:V,color:"blue"}),e.jsx(A,{icon:S,title:"Active",value:Z,color:"green"}),e.jsx(A,{icon:S,title:"Full",value:G,color:"red"}),e.jsx(A,{icon:S,title:"Maintenance",value:X,color:"yellow"})]}),e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"h-4 w-4 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",className:"form-input pl-10",placeholder:"Cari ODP...",value:t,onChange:se})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Area"}),e.jsxs("select",{className:"form-input",value:c,onChange:s=>I("area",s.target.value),children:[e.jsx("option",{value:"all",children:"Semua Area"}),Y.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"form-input",value:l,onChange:s=>I("status",s.target.value),children:[e.jsx("option",{value:"all",children:"Semua Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Capacity"}),e.jsx("select",{className:"form-input",value:"all",onChange:s=>{},children:e.jsx("option",{value:"all",children:"Semua Kapasitas"})})]})]})}),L.length===0?e.jsxs("div",{className:"bg-white shadow rounded-lg p-12 text-center",children:[e.jsx(S,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak ada ODP"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Mulai dengan menambahkan ODP pertama"}),e.jsxs("button",{onClick:T,className:"btn-primary",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Tambah ODP"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["All ODPs",e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",x.total||0," total)"]})]})}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",style:{tableLayout:"fixed",minWidth:"900px"},children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>k("name"),style:{width:"140px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Nama ODP"}),P("name")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>k("location"),style:{width:"230px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Lokasi"}),P("location")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>k("area"),style:{width:"130px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Area"}),P("area")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>k("used_ports"),style:{width:"120px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Kapasitas"}),P("used_ports")]})}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>k("status"),style:{width:"90px"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status"}),P("status")]})}),e.jsx("th",{className:"table-header-cell text-center",style:{width:"110px"},children:"Actions"})]})}),e.jsx("tbody",{className:"table-body",children:L.map(s=>{var n,h;return e.jsxs("tr",{children:[e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})}),e.jsxs("td",{className:"table-cell",children:[e.jsx("div",{className:"text-sm text-gray-900 truncate",title:s.location,children:s.location}),s.latitude&&s.longitude&&e.jsxs("div",{className:"text-xs text-gray-500 font-mono truncate",children:[parseFloat(s.latitude).toFixed(6),", ",parseFloat(s.longitude).toFixed(6)]})]}),e.jsx("td",{className:"table-cell whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.area||"-"})}),e.jsxs("td",{className:"table-cell",children:[e.jsxs("div",{className:"text-sm text-gray-900 mb-1",children:[s.used_ports||0," / ",s.total_ports||0," ports"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${s.used_ports/s.total_ports*100>=90?"bg-red-600":s.used_ports/s.total_ports*100>=70?"bg-yellow-600":"bg-green-600"}`,style:{width:`${s.used_ports/s.total_ports*100}%`}})})]}),e.jsx("td",{className:"table-cell whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${s.status==="active"?"bg-green-100 text-green-800":s.status==="full"?"bg-red-100 text-red-800":s.status==="maintenance"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:((n=s.status)==null?void 0:n.charAt(0).toUpperCase())+((h=s.status)==null?void 0:h.slice(1))})}),e.jsx("td",{className:"table-cell text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>J(s),className:"inline-flex items-center justify-center w-8 h-8 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-md transition-colors",title:"Edit ODP",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>R(s.id,s.name),className:"inline-flex items-center justify-center w-8 h-8 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors",title:"Delete ODP",children:e.jsx(he,{className:"h-4 w-4"})})]})})]},s.id)})})]})})})]}),e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 sm:px-6",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>m(Math.max(1,i-1)),disabled:i===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>m(Math.min(x.pages||1,i+1)),disabled:i===(x.pages||1),className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-700",children:"Show"}),e.jsxs("select",{value:y,onChange:s=>{U(parseInt(s.target.value)),m(1)},className:"form-input py-1 px-2 text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsx("span",{className:"text-sm text-gray-700",children:"rows"})]}),e.jsx("div",{className:"border-l border-gray-300 h-6"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(i-1)*y+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(i*y,x.total||0)})," ","of ",e.jsx("span",{className:"font-medium",children:x.total||0})," results"]})]}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>m(Math.max(1,i-1)),disabled:i===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ue,{className:"h-5 w-5"})}),Array.from({length:Math.min(x.pages||1,10)},(s,n)=>{const h=x.pages||1;return h<=10||i<=5?n+1:i>=h-4?h-9+n:i-5+n}).map(s=>e.jsx("button",{onClick:()=>m(s),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${i===s?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:s},s)),e.jsx("button",{onClick:()=>m(Math.min(x.pages||1,i+1)),disabled:i===(x.pages||1),className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(je,{className:"h-5 w-5"})})]})})]})]})})]}),r&&e.jsx(fe,{odp:O,onClose:E,onSuccess:ee})]})};export{Ae as default};
//# sourceMappingURL=ODPPage-CghUMtu2.js.map
