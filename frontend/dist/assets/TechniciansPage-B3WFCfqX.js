var q=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var U=(r,l,t)=>l in r?q(r,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[l]=t,g=(r,l)=>{for(var t in l||(l={}))G.call(l,t)&&U(r,t,l[t]);if(B)for(var t of B(l))H.call(l,t)&&U(r,t,l[t]);return r},y=(r,l)=>X(r,Y(l));import{j as e}from"./notifications-DWMisRkI.js";import{u as ee,r as m}from"./react-vendor-BQ7pSkNi.js";import{a as se,b as z,u as ae}from"./react-query-B7OIdD7u.js";import{t as f}from"./tickets-DdQly412.js";import{L as te,K as v}from"./customers-B56UMpVp.js";import{ab as le,I as ie,N as L,J,C as P,K as re,b as I,S as ne,U as ce,o as oe,m as de,p as xe,a7 as me,E as ue,Q as he,V as be,z as N,W as pe,Y as ve,Z as je,ad as ge,aB as ye,ak as fe}from"./ui-vendor-r_Nxhu34.js";import"./charts-CREYXqqm.js";import"./forms-Dmkgx8TD.js";import"./socket-BFcXWKeu.js";const Ue=()=>{var A,E;const r=ee(),l=se(),[t,w]=m.useState({search:"",employment_status:"",availability_status:"",skill_level:"",work_zone:"",specialization:""}),[i,d]=m.useState(1),[h,M]=m.useState("created_at"),[b,k]=m.useState("DESC"),[u,O]=m.useState(10),{data:x,isLoading:D,refetch:F}=z(["technicians",t,i,u,h,b],()=>f.getTechnicians(y(g({},t),{page:i,limit:u,sort_by:h,sort_order:b})),{keepPreviousData:!0}),{data:j}=z("technician-stats",()=>f.getTechnicianStats()),Q=ae(({id:s,status:a})=>f.updateAvailability(s,{availability_status:a}),{onSuccess:()=>{N.success("Status updated successfully"),F(),l.invalidateQueries("technician-stats")},onError:s=>{var a,n;N.error(((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to update status")}}),o=(s,a)=>{w(n=>y(g({},n),{[s]:a})),d(1)},_=()=>{r("/users?create=true&role=technician"),N.info('Create a user account with role "Technician"')},$=s=>{r(`/technicians/${s.id}`)},K=s=>{r(`/users?id=${s}`)},V=(s,a)=>{Q.mutate({id:s,status:a})},C=s=>{h===s?k(b==="ASC"?"DESC":"ASC"):(M(s),k("DESC")),d(1)},S=s=>h!==s?e.jsx(pe,{className:"h-4 w-4 text-gray-400"}):b==="ASC"?e.jsx(ve,{className:"h-4 w-4 text-blue-600"}):e.jsx(je,{className:"h-4 w-4 text-blue-600"}),W=s=>{const a={active:{color:"bg-green-100 text-green-800",icon:P,label:"Active"},inactive:{color:"bg-gray-100 text-gray-800",icon:fe,label:"Inactive"},suspended:{color:"bg-red-100 text-red-800",icon:ye,label:"Suspended"},terminated:{color:"bg-red-100 text-red-800",icon:I,label:"Terminated"}},n=a[s]||a.active,R=n.icon;return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${n.color}`,children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),n.label]})},Z=s=>{const a={junior:{color:"bg-blue-100 text-blue-800",label:"Junior"},senior:{color:"bg-purple-100 text-purple-800",label:"Senior"},expert:{color:"bg-orange-100 text-orange-800",label:"Expert"},specialist:{color:"bg-red-100 text-red-800",label:"Specialist"}},n=a[s]||a.junior;return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${n.color}`,children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),n.label]})},T=((A=x==null?void 0:x.data)==null?void 0:A.technicians)||[],c=((E=x==null?void 0:x.data)==null?void 0:E.pagination)||{},p=(j==null?void 0:j.data)||{};return m.useEffect(()=>{const s=()=>{l.invalidateQueries(["technicians"]),l.invalidateQueries("technician-stats")};return window.addEventListener("technician-created",s),window.addEventListener("technician-updated",s),window.addEventListener("technician-status-changed",s),()=>{window.removeEventListener("technician-created",s),window.removeEventListener("technician-updated",s),window.removeEventListener("technician-status-changed",s)}},[l]),D&&!x?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(te,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(le,{className:"h-7 w-7 text-blue-600"}),e.jsx("span",{children:"Technician Management"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Kelola teknisi lapangan dan monitor performa"})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 flex items-center space-x-3",children:[e.jsxs("div",{className:"hidden sm:flex items-center px-3 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(ie,{className:"h-4 w-4 text-blue-600 mr-2"}),e.jsx("span",{className:"text-xs text-blue-900",children:'Create technician via Users page with role="Technician"'})]}),e.jsxs("button",{onClick:_,className:"btn-primary flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Technician User"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(v,{icon:J,title:"Total Teknisi",value:p.total_technicians||0,color:"blue"}),e.jsx(v,{icon:P,title:"Available",value:p.available_technicians||0,color:"green",onClick:()=>{o("availability_status",t.availability_status==="available"?"":"available")}}),e.jsx(v,{icon:re,title:"Busy",value:p.busy_technicians||0,color:"yellow",onClick:()=>{o("availability_status",t.availability_status==="busy"?"":"busy")}}),e.jsx(v,{icon:I,title:"Offline",value:p.offline_technicians||0,color:"red",onClick:()=>{o("availability_status",t.availability_status==="offline"?"":"offline")}})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"h-4 w-4 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",className:"form-input pl-10",placeholder:"Cari teknisi...",value:t.search,onChange:s=>o("search",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Availability Status"}),e.jsxs("select",{className:"form-input",value:t.availability_status,onChange:s=>o("availability_status",s.target.value),children:[e.jsx("option",{value:"",children:"Semua Status"}),e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"busy",children:"Busy"}),e.jsx("option",{value:"break",children:"On Break"}),e.jsx("option",{value:"offline",children:"Offline"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employment Status"}),e.jsxs("select",{className:"form-input",value:t.employment_status,onChange:s=>o("employment_status",s.target.value),children:[e.jsx("option",{value:"",children:"Semua"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"terminated",children:"Terminated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Skill Level"}),e.jsxs("select",{className:"form-input",value:t.skill_level,onChange:s=>o("skill_level",s.target.value),children:[e.jsx("option",{value:"",children:"Semua Level"}),e.jsx("option",{value:"junior",children:"Junior"}),e.jsx("option",{value:"senior",children:"Senior"}),e.jsx("option",{value:"expert",children:"Expert"}),e.jsx("option",{value:"specialist",children:"Specialist"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Work Zone"}),e.jsxs("select",{className:"form-input",value:t.work_zone,onChange:s=>o("work_zone",s.target.value),children:[e.jsx("option",{value:"",children:"Semua Zone"}),e.jsx("option",{value:"Karawang",children:"Karawang"}),e.jsx("option",{value:"Jakarta_Pusat",children:"Jakarta Pusat"}),e.jsx("option",{value:"Jakarta_Selatan",children:"Jakarta Selatan"}),e.jsx("option",{value:"Jakarta_Utara",children:"Jakarta Utara"}),e.jsx("option",{value:"Jakarta_Timur",children:"Jakarta Timur"}),e.jsx("option",{value:"Jakarta_Barat",children:"Jakarta Barat"}),e.jsx("option",{value:"Bogor",children:"Bogor"}),e.jsx("option",{value:"Depok",children:"Depok"}),e.jsx("option",{value:"Tangerang",children:"Tangerang"}),e.jsx("option",{value:"Bekasi",children:"Bekasi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specialization"}),e.jsxs("select",{className:"form-input",value:t.specialization,onChange:s=>o("specialization",s.target.value),children:[e.jsx("option",{value:"",children:"Semua Spesialisasi"}),e.jsx("option",{value:"fiber_optic",children:"Fiber Optic"}),e.jsx("option",{value:"wireless",children:"Wireless"}),e.jsx("option",{value:"networking",children:"Networking"}),e.jsx("option",{value:"installation",children:"Installation"}),e.jsx("option",{value:"troubleshooting",children:"Troubleshooting"})]})]})]}),Object.values(t).some(s=>s)&&e.jsxs("div",{className:"mt-4 flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Active filters:"}),Object.entries(t).map(([s,a])=>a?e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-xs rounded-full flex items-center space-x-1",children:[e.jsxs("span",{children:[s,": ",a]}),e.jsx("button",{onClick:()=>o(s,""),className:"hover:text-blue-900",children:"Ã—"})]},s):null),e.jsx("button",{onClick:()=>{w({search:"",employment_status:"",availability_status:"",skill_level:"",work_zone:"",specialization:""}),d(1)},className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear all"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["All Technicians",e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",c.total||0," total)"]})]})}),e.jsx("div",{className:"card-body p-0",children:T.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No technicians found"}),e.jsx("p",{className:"mt-1 text-gray-500 mb-4",children:'Create a user account with role "Technician" to get started'}),e.jsxs("button",{onClick:_,className:"btn-primary",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Create Technician User"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>C("full_name"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Technician"}),S("full_name")]})}),e.jsx("th",{className:"table-header-cell",children:"User Account"}),e.jsx("th",{className:"table-header-cell",children:"Contact"}),e.jsx("th",{className:"table-header-cell",children:"Skills & Zone"}),e.jsx("th",{className:"table-header-cell",children:"Employment"}),e.jsx("th",{className:"table-header-cell cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>C("availability_status"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Availability"}),S("availability_status")]})}),e.jsx("th",{className:"table-header-cell",children:"Performance"}),e.jsx("th",{className:"table-header-cell text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"table-body",children:T.map(s=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(ce,{className:"h-5 w-5 text-blue-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.employee_id]})]})]})}),e.jsx("td",{className:"table-cell",children:s.username?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>K(s.user_id),className:"text-sm font-medium text-blue-600 hover:text-blue-800",children:["@",s.username]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["User ID: ",s.user_id]})]}):e.jsx("span",{className:"text-sm text-red-600",children:"No user account"})}),e.jsxs("td",{className:"table-cell",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(oe,{className:"h-3 w-3 mr-1 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(de,{className:"h-3 w-3 mr-1 text-gray-400"}),s.email]})]}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"space-y-2",children:[Z(s.skill_level),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),(a=s.work_zone)==null?void 0:a.replace("_"," ")]})]})}),e.jsx("td",{className:"table-cell",children:W(s.employment_status)}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:s.availability_status,onChange:n=>V(s.id,n.target.value),disabled:s.employment_status!=="active",className:`text-xs font-medium rounded-full px-2 py-1 border-0 focus:ring-2 focus:ring-blue-500 ${s.availability_status==="available"?"bg-green-100 text-green-800":s.availability_status==="busy"?"bg-yellow-100 text-yellow-800":s.availability_status==="break"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"} ${s.employment_status!=="active"?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"busy",children:"Busy"}),e.jsx("option",{value:"break",children:"Break"}),e.jsx("option",{value:"offline",children:"Offline"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Tickets: ",s.active_tickets||0,"/",s.max_daily_tickets||8]})]})}),e.jsxs("td",{className:"table-cell",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(me,{className:"h-4 w-4 mr-1 text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium",children:s.avg_customer_rating?parseFloat(s.avg_customer_rating).toFixed(1):"N/A"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Completed: ",s.total_tickets_completed||0]})]}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"flex justify-center space-x-2",children:e.jsx("button",{onClick:()=>$(s),className:"inline-flex items-center justify-center w-8 h-8 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-md transition-colors",title:"View Details",children:e.jsx(ue,{className:"h-4 w-4"})})})})]},s.id)})})]})}),c.total>0&&e.jsx("div",{className:"bg-white border-t border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>d(Math.max(1,i-1)),disabled:i===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>d(Math.min(c.pages,i+1)),disabled:i===c.pages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-700",children:"Show"}),e.jsxs("select",{value:u,onChange:s=>{O(parseInt(s.target.value)),d(1)},className:"form-input py-1 px-2 text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsx("span",{className:"text-sm text-gray-700",children:"rows"})]}),e.jsx("div",{className:"border-l border-gray-300 h-6"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(i-1)*u+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(i*u,c.total)})," ","of ",e.jsx("span",{className:"font-medium",children:c.total})," results"]})]}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>d(Math.max(1,i-1)),disabled:i===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(he,{className:"h-5 w-5"})}),Array.from({length:Math.min(c.pages,10)},(s,a)=>c.pages<=10||i<=5?a+1:i>=c.pages-4?c.pages-9+a:i-5+a).map(s=>e.jsx("button",{onClick:()=>d(s),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${i===s?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:s},s)),e.jsx("button",{onClick:()=>d(Math.min(c.pages,i+1)),disabled:i===c.pages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(be,{className:"h-5 w-5"})})]})})]})]})})]})})]})]})};export{Ue as default};
//# sourceMappingURL=TechniciansPage-B3WFCfqX.js.map
